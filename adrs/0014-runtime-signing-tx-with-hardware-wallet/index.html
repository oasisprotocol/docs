<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-adrs/0014-runtime-signing-tx-with-hardware-wallet" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">ADR 0014: Signing Runtime Transactions with Hardware Wallet | Oasis Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.oasis.io/adrs/0014-runtime-signing-tx-with-hardware-wallet"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="ADR 0014: Signing Runtime Transactions with Hardware Wallet | Oasis Documentation"><meta data-rh="true" name="description" content="Component"><meta data-rh="true" property="og:description" content="Component"><link data-rh="true" rel="icon" href="/img/favicon/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.oasis.io/adrs/0014-runtime-signing-tx-with-hardware-wallet"><link data-rh="true" rel="alternate" href="https://docs.oasis.io/adrs/0014-runtime-signing-tx-with-hardware-wallet" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.oasis.io/adrs/0014-runtime-signing-tx-with-hardware-wallet" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.551f8251.css">
<script src="/assets/js/runtime~main.4f6be8e5.js" defer="defer"></script>
<script src="/assets/js/main.9d193f4f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><link rel="preload" as="image" href="/img/logo_dark.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Oasis Docs" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo_dark.svg" alt="Oasis Docs" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/build/">Build</a><a class="navbar__item navbar__link" href="/general/">Learn</a><a class="navbar__item navbar__link" href="/get-involved/">Get Involved</a><a class="navbar__item navbar__link" href="/node/">Run Node</a><a class="navbar__item navbar__link" href="/core/">Develop Core</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/oasisprotocol" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" title="GitHub repository" aria-label="GitHub repository"></a><a href="https://oasis.net/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-www-link" title="Oasis website" aria-label="Oasis website"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/adrs"><span title="Architectural Decision Records" class="categoryLinkLabel_W154">Architectural Decision Records</span></a><button aria-label="Collapse sidebar category &#x27;Architectural Decision Records&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0001-tm-multi-root-apphash"><span title="ADR 0001: Multiple Roots Under the Tendermint Application Hash" class="linkLabel_WmDU">ADR 0001: Multiple Roots Under the Tendermint Application Hash</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0002-go-modules-compatible-git-tags"><span title="ADR 0002: Go Modules Compatible Git Tags" class="linkLabel_WmDU">ADR 0002: Go Modules Compatible Git Tags</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0003-consensus-runtime-token-transfer"><span title="ADR 0003: Consensus/Runtime Token Transfer" class="linkLabel_WmDU">ADR 0003: Consensus/Runtime Token Transfer</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0004-runtime-governance"><span title="ADR 0004: Runtime Governance" class="linkLabel_WmDU">ADR 0004: Runtime Governance</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0005-runtime-compute-slashing"><span title="ADR 0005: Runtime Compute Node Slashing" class="linkLabel_WmDU">ADR 0005: Runtime Compute Node Slashing</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0006-consensus-governance"><span title="ADR 0006: Consensus Governance" class="linkLabel_WmDU">ADR 0006: Consensus Governance</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0007-improved-random-beacon"><span title="ADR 0007: Improved Random Beacon" class="linkLabel_WmDU">ADR 0007: Improved Random Beacon</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0008-standard-account-key-generation"><span title="ADR 0008: Standard Account Key Generation" class="linkLabel_WmDU">ADR 0008: Standard Account Key Generation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0009-ed25519-semantics"><span title="ADR 0009: Ed25519 Signature Verification Semantics" class="linkLabel_WmDU">ADR 0009: Ed25519 Signature Verification Semantics</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0010-vrf-elections"><span title="ADR 0010: VRF-based Committee Elections" class="linkLabel_WmDU">ADR 0010: VRF-based Committee Elections</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0011-incoming-runtime-messages"><span title="ADR 0011: Incoming Runtime Messages" class="linkLabel_WmDU">ADR 0011: Incoming Runtime Messages</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0012-runtime-message-results"><span title="ADR 0012: Runtime Message Results" class="linkLabel_WmDU">ADR 0012: Runtime Message Results</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0013-runtime-upgrades"><span title="ADR 0013: Runtime Upgrade Improvements" class="linkLabel_WmDU">ADR 0013: Runtime Upgrade Improvements</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/adrs/0014-runtime-signing-tx-with-hardware-wallet"><span title="ADR 0014: Signing Runtime Transactions with Hardware Wallet" class="linkLabel_WmDU">ADR 0014: Signing Runtime Transactions with Hardware Wallet</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0015-vrf-per-block-entropy"><span title="ADR 0015: Randomized Paratime Proposer Selection" class="linkLabel_WmDU">ADR 0015: Randomized Paratime Proposer Selection</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0016-consensus-parameters-change-proposal"><span title="ADR 0016: Consensus Parameters Change Proposal" class="linkLabel_WmDU">ADR 0016: Consensus Parameters Change Proposal</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0017-app-standards"><span title="ADR 0017: ParaTime Application Standard Proposal Process" class="linkLabel_WmDU">ADR 0017: ParaTime Application Standard Proposal Process</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0020-governance-delegator-votes"><span title="ADR 0020: Governance Support for Delegator Votes" class="linkLabel_WmDU">ADR 0020: Governance Support for Delegator Votes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0021-keymanager-ephemeral-secrets"><span title="ADR 0021: Forward-Secret Ephemeral Secrets" class="linkLabel_WmDU">ADR 0021: Forward-Secret Ephemeral Secrets</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0022-keymanager-master-secrets"><span title="ADR 0022: Forward-Secret Master Secrets" class="linkLabel_WmDU">ADR 0022: Forward-Secret Master Secrets</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0023-keymanager-secret-sharing"><span title="ADR 0023: Secret Sharing Schemes (CHURP)" class="linkLabel_WmDU">ADR 0023: Secret Sharing Schemes (CHURP)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0024-off-chain-runtime-logic"><span title="ADR 0024: Runtime Off-chain Logic (ROFL)" class="linkLabel_WmDU">ADR 0024: Runtime Off-chain Logic (ROFL)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/adrs/0025-bundle_hot_loading"><span title="ADR 0025: Hot-loading of Runtime Bundles" class="linkLabel_WmDU">ADR 0025: Hot-loading of Runtime Bundles</span></a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>ADR 0014: Signing Runtime Transactions with Hardware Wallet</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="component">Component<a href="#component" class="hash-link" aria-label="Direct link to Component" title="Direct link to Component" translate="no">​</a></h2>
<p>Oasis SDK</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="changelog">Changelog<a href="#changelog" class="hash-link" aria-label="Direct link to Changelog" title="Direct link to Changelog" translate="no">​</a></h2>
<ul>
<li class="">2023-02-24:<!-- -->
<ul>
<li class="">APDU: Define Oasis native and Ethereum-compatible address length.</li>
</ul>
</li>
<li class="">2023-02-09:<!-- -->
<ul>
<li class="">Encode <code>Meta.runtime_id</code> and <code>Meta.orig_to</code> as Base16.</li>
<li class="">Change <code>SIG</code> in <code>SIGN_RT_SECP256K1</code> to 65-byte encoded R,S,V format.</li>
</ul>
</li>
<li class="">2023-01-23:<!-- -->
<ul>
<li class="">Fix Deoxys-II field description in <a href="#signing-encrypted-runtime-transactions" class="">Signing encrypted runtime
transactions</a> section.</li>
<li class="">Rename <code>SIGN_PT_</code> instructions in APDUSPEC to <code>SIGN_RT_</code> for consistency
with oasis-core and oasis-sdk codebase.</li>
</ul>
</li>
<li class="">2023-01-03:<!-- -->
<ul>
<li class="">Add Sapphire runtime ID and consensus address on Mainnet.</li>
</ul>
</li>
<li class="">2022-12-13:<!-- -->
<ul>
<li class="">Fix Secp256k1 public key size.</li>
</ul>
</li>
<li class="">2022-10-12:<!-- -->
<ul>
<li class="">Add Sapphire runtime ID and consensus address on Testnet,</li>
<li class="">Remove redundant <code>sig_context</code> from <code>Meta</code>,</li>
<li class="">Require <code>tx.call.format</code> to be either <code>0</code> or <code>1</code>.</li>
</ul>
</li>
<li class="">2022-07-15: Initial public version</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="status">Status<a href="#status" class="hash-link" aria-label="Direct link to Status" title="Direct link to Status" translate="no">​</a></h2>
<p>Proposed</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="context">Context<a href="#context" class="hash-link" aria-label="Direct link to Context" title="Direct link to Context" translate="no">​</a></h2>
<p>This document proposes additions to APDU specification, guidelines for parsing
runtime transactions and general UI/UX for signing them on a hardware wallet:</p>
<ol>
<li class=""><a href="#apduspec-additions" class="">APDUSPEC additions</a></li>
<li class=""><a href="#changes-to-allowance-transaction" class="">Changes to Allowance transaction</a></li>
<li class=""><a href="#signing-general-runtime-transactions" class="">Signing general runtime transactions</a>,</li>
<li class=""><a href="#signing-smart-contract-runtime-transactions" class="">Signing smart contract runtime transactions</a>,</li>
<li class=""><a href="#signing-evm-runtime-transactions" class="">Signing EVM runtime transactions</a>.</li>
<li class=""><a href="#signing-encrypted-runtime-transactions" class="">Signing encrypted runtime transactions</a>,</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="test-vectors">Test vectors<a href="#test-vectors" class="hash-link" aria-label="Direct link to Test vectors" title="Direct link to Test vectors" translate="no">​</a></h3>
<p>Test vectors for all runtime transactions in this ADR can be generated by
using <a href="https://github.com/oasisprotocol/oasis-sdk/tree/main/tools/gen_runtime_vectors" target="_blank" rel="noopener noreferrer" class="">gen_runtime_vectors</a> tool as part of the Oasis SDK.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="runtime-transaction-format">Runtime transaction format<a href="#runtime-transaction-format" class="hash-link" aria-label="Direct link to Runtime transaction format" title="Direct link to Runtime transaction format" translate="no">​</a></h3>
<p>The format of the <a href="https://github.com/oasisprotocol/oasis-sdk/blob/c36a7ee194abf4ca28fdac0edbefe3843b39bf69/runtime-sdk/src/types/transaction.rs#L86-L96" target="_blank" rel="noopener noreferrer" class="">runtime transaction</a> to be signed by the
hardware wallet is the following:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/// Transaction.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[derive(Clone, Debug, cbor::Encode, cbor::Decode)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token type-definition class-name">Transaction</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token attribute attr-name" style="color:#00a4db">#[cbor(rename = </span><span class="token attribute attr-name string" style="color:#e3116c">&quot;v&quot;</span><span class="token attribute attr-name" style="color:#00a4db">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u16</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> call</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Call</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token attribute attr-name" style="color:#00a4db">#[cbor(rename = </span><span class="token attribute attr-name string" style="color:#e3116c">&quot;ai&quot;</span><span class="token attribute attr-name" style="color:#00a4db">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> auth_info</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">AuthInfo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>The transaction <strong>can be signed with <code>Secp256k1</code> (&quot;Ethereum&quot;), <code>Ed25519</code> key,
or <code>Sr25519</code> key!</strong> Information on this along with the gas fee is stored inside
<a href="https://github.com/oasisprotocol/oasis-sdk/blob/c36a7ee194abf4ca28fdac0edbefe3843b39bf69/runtime-sdk/src/types/transaction.rs#L159-L173" target="_blank" rel="noopener noreferrer" class=""><code>ai</code> field</a>.</p>
<p><code>call</code> is defined as <a href="https://github.com/oasisprotocol/oasis-sdk/blob/c36a7ee194abf4ca28fdac0edbefe3843b39bf69/runtime-sdk/src/types/transaction.rs#L129-L146" target="_blank" rel="noopener noreferrer" class="">follows</a>:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/// Method call.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token attribute attr-name" style="color:#00a4db">#[derive(Clone, Debug, cbor::Encode, cbor::Decode)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token type-definition class-name">Call</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">/// Call format.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token attribute attr-name" style="color:#00a4db">#[cbor(optional, default)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> format</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">CallFormat</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">/// Method name.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token attribute attr-name" style="color:#00a4db">#[cbor(optional, default, skip_serializing_if = </span><span class="token attribute attr-name string" style="color:#e3116c">&quot;String::is_empty&quot;</span><span class="token attribute attr-name" style="color:#00a4db">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> method</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">/// Method body.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> body</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">cbor</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">/// Read-only flag.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">///</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">/// A read-only call cannot make any changes to runtime state. Any attempt at modifying state</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">/// will result in the call failing.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token attribute attr-name" style="color:#00a4db">#[cbor(optional, default, rename = </span><span class="token attribute attr-name string" style="color:#e3116c">&quot;ro&quot;</span><span class="token attribute attr-name" style="color:#00a4db">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> read_only</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">bool</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>If <a href="https://github.com/oasisprotocol/oasis-sdk/blob/c36a7ee194abf4ca28fdac0edbefe3843b39bf69/runtime-sdk/src/types/transaction.rs#L113-L121" target="_blank" rel="noopener noreferrer" class=""><code>format</code></a> is:</p>
<ul>
<li class=""><code>0</code>, the transaction is unencrypted,</li>
<li class=""><code>1</code>, the transaction is encrypted,</li>
<li class="">any other, the transaction should be rejected with <code>unsupported call format</code>
error unless implemented outside the scope of this ADR.</li>
</ul>
<p><code>method</code> contains the name of the runtime module followed by <code>.</code> and the method
name. If <code>format</code> is <code>1</code>, <code>method</code> is empty.</p>
<p><code>body</code> contains a CBOR-encoded transaction. If <code>format</code> equals <code>1</code>, <code>body</code>
contains CBOR-encoded <a href="https://github.com/oasisprotocol/oasis-sdk/blob/c36a7ee194abf4ca28fdac0edbefe3843b39bf69/runtime-sdk/src/types/callformat.rs#L7-L16" target="_blank" rel="noopener noreferrer" class=""><code>CallEnvelopeX25519DeoxysII</code></a>
which contains the encrypted transaction body inside its <code>data</code> field.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="decision">Decision<a href="#decision" class="hash-link" aria-label="Direct link to Decision" title="Direct link to Decision" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="apduspec-additions">APDUSPEC additions<a href="#apduspec-additions" class="hash-link" aria-label="Direct link to APDUSPEC additions" title="Direct link to APDUSPEC additions" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="get_addr_secp256k1">GET_ADDR_SECP256K1<a href="#get_addr_secp256k1" class="hash-link" aria-label="Direct link to GET_ADDR_SECP256K1" title="Direct link to GET_ADDR_SECP256K1" translate="no">​</a></h4>
<h5 class="anchor anchorTargetStickyNavbar_Vzrq" id="command">Command<a href="#command" class="hash-link" aria-label="Direct link to Command" title="Direct link to Command" translate="no">​</a></h5>
<table><thead><tr><th>Field</th><th>Type</th><th>Content</th><th>Expected</th></tr></thead><tbody><tr><td>CLA</td><td>byte (1)</td><td>Application Identifier</td><td>0x05</td></tr><tr><td>INS</td><td>byte (1)</td><td>Instruction ID</td><td>0x04</td></tr><tr><td>P1</td><td>byte (1)</td><td>Request User confirmation</td><td>No = 0</td></tr><tr><td>P2</td><td>byte (1)</td><td>Parameter 2</td><td>ignored</td></tr><tr><td>L</td><td>byte (1)</td><td>Bytes in payload</td><td>(depends)</td></tr><tr><td>Path[0]</td><td>byte (4)</td><td>Derivation Path Data</td><td>44</td></tr><tr><td>Path[1]</td><td>byte (4)</td><td>Derivation Path Data</td><td>60</td></tr><tr><td>Path[2]</td><td>byte (4)</td><td>Derivation Path Data</td><td>?</td></tr><tr><td>Path[3]</td><td>byte (4)</td><td>Derivation Path Data</td><td>?</td></tr><tr><td>Path[4]</td><td>byte (4)</td><td>Derivation Path Data</td><td>?</td></tr></tbody></table>
<p>The first three items in the derivation path are hardened.</p>
<h5 class="anchor anchorTargetStickyNavbar_Vzrq" id="response">Response<a href="#response" class="hash-link" aria-label="Direct link to Response" title="Direct link to Response" translate="no">​</a></h5>
<table><thead><tr><th>Field</th><th>Type</th><th>Content</th><th>Note</th></tr></thead><tbody><tr><td>PK</td><td>byte (33)</td><td>Public Key</td><td></td></tr><tr><td>ADDR</td><td>byte (40)</td><td>Lower-case hex addr</td><td></td></tr><tr><td>SW1-SW2</td><td>byte (2)</td><td>Return code</td><td>see list of return codes</td></tr></tbody></table>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="get_addr_sr25519">GET_ADDR_SR25519<a href="#get_addr_sr25519" class="hash-link" aria-label="Direct link to GET_ADDR_SR25519" title="Direct link to GET_ADDR_SR25519" translate="no">​</a></h4>
<h5 class="anchor anchorTargetStickyNavbar_Vzrq" id="command-1">Command<a href="#command-1" class="hash-link" aria-label="Direct link to Command" title="Direct link to Command" translate="no">​</a></h5>
<table><thead><tr><th>Field</th><th>Type</th><th>Content</th><th>Expected</th></tr></thead><tbody><tr><td>CLA</td><td>byte (1)</td><td>Application Identifier</td><td>0x05</td></tr><tr><td>INS</td><td>byte (1)</td><td>Instruction ID</td><td>0x03</td></tr><tr><td>P1</td><td>byte (1)</td><td>Request User confirmation</td><td>No = 0</td></tr><tr><td>P2</td><td>byte (1)</td><td>Parameter 2</td><td>ignored</td></tr><tr><td>L</td><td>byte (1)</td><td>Bytes in payload</td><td>(depends)</td></tr><tr><td>Path[0]</td><td>byte (4)</td><td>Derivation Path Data</td><td>44</td></tr><tr><td>Path[1]</td><td>byte (4)</td><td>Derivation Path Data</td><td>474</td></tr><tr><td>Path[2]</td><td>byte (4)</td><td>Derivation Path Data</td><td>?</td></tr><tr><td>Path[3]</td><td>byte (4)</td><td>Derivation Path Data</td><td>?</td></tr><tr><td>Path[4]</td><td>byte (4)</td><td>Derivation Path Data</td><td>?</td></tr></tbody></table>
<p>The first three items in the derivation path are hardened.</p>
<h5 class="anchor anchorTargetStickyNavbar_Vzrq" id="response-1">Response<a href="#response-1" class="hash-link" aria-label="Direct link to Response" title="Direct link to Response" translate="no">​</a></h5>
<table><thead><tr><th>Field</th><th>Type</th><th>Content</th><th>Note</th></tr></thead><tbody><tr><td>PK</td><td>byte (32)</td><td>Public Key</td><td></td></tr><tr><td>ADDR</td><td>byte (46)</td><td>Bech32 addr</td><td></td></tr><tr><td>SW1-SW2</td><td>byte (2)</td><td>Return code</td><td>see list of return codes</td></tr></tbody></table>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="sign_rt_ed25519">SIGN_RT_ED25519<a href="#sign_rt_ed25519" class="hash-link" aria-label="Direct link to SIGN_RT_ED25519" title="Direct link to SIGN_RT_ED25519" translate="no">​</a></h4>
<h5 class="anchor anchorTargetStickyNavbar_Vzrq" id="command-2">Command<a href="#command-2" class="hash-link" aria-label="Direct link to Command" title="Direct link to Command" translate="no">​</a></h5>
<table><thead><tr><th>Field</th><th>Type</th><th>Content</th><th>Expected</th></tr></thead><tbody><tr><td>CLA</td><td>byte (1)</td><td>Application Identifier</td><td>0x05</td></tr><tr><td>INS</td><td>byte (1)</td><td>Instruction ID</td><td>0x05</td></tr><tr><td>P1</td><td>byte (1)</td><td>Payload desc</td><td>0 = init</td></tr><tr><td></td><td></td><td></td><td>1 = add</td></tr><tr><td></td><td></td><td></td><td>2 = last</td></tr><tr><td>P2</td><td>byte (1)</td><td>----</td><td>not used</td></tr><tr><td>L</td><td>byte (1)</td><td>Bytes in payload</td><td>(depends)</td></tr></tbody></table>
<p>The first packet/chunk includes only the derivation path.</p>
<p>All other packets/chunks should contain message to sign.</p>
<p><em>First Packet</em></p>
<table><thead><tr><th>Field</th><th>Type</th><th>Content</th><th>Expected</th></tr></thead><tbody><tr><td>Path[0]</td><td>byte (4)</td><td>Derivation Path Data</td><td>44</td></tr><tr><td>Path[1]</td><td>byte (4)</td><td>Derivation Path Data</td><td>474</td></tr><tr><td>Path[2]</td><td>byte (4)</td><td>Derivation Path Data</td><td>?</td></tr><tr><td>Path[3]</td><td>byte (4)</td><td>Derivation Path Data</td><td>?</td></tr><tr><td>Path[4]</td><td>byte (4)</td><td>Derivation Path Data</td><td>?</td></tr></tbody></table>
<p><em>Other Chunks/Packets</em></p>
<table><thead><tr><th>Field</th><th>Type</th><th>Content</th><th>Expected</th></tr></thead><tbody><tr><td>Data</td><td>bytes...</td><td>Meta+Message</td><td></td></tr></tbody></table>
<p>Data is defined as:</p>
<table><thead><tr><th>Field</th><th>Type</th><th>Content</th><th>Expected</th></tr></thead><tbody><tr><td>Meta</td><td>bytes..</td><td>CBOR metadata</td><td></td></tr><tr><td>Message</td><td>bytes..</td><td>CBOR data to sign</td><td></td></tr></tbody></table>
<h5 class="anchor anchorTargetStickyNavbar_Vzrq" id="response-2">Response<a href="#response-2" class="hash-link" aria-label="Direct link to Response" title="Direct link to Response" translate="no">​</a></h5>
<table><thead><tr><th>Field</th><th>Type</th><th>Content</th><th>Note</th></tr></thead><tbody><tr><td>SIG</td><td>byte (64)</td><td>Signature</td><td></td></tr><tr><td>SW1-SW2</td><td>byte (2)</td><td>Return code</td><td>see list of return codes</td></tr></tbody></table>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="sign_rt_secp256k1">SIGN_RT_SECP256K1<a href="#sign_rt_secp256k1" class="hash-link" aria-label="Direct link to SIGN_RT_SECP256K1" title="Direct link to SIGN_RT_SECP256K1" translate="no">​</a></h4>
<h5 class="anchor anchorTargetStickyNavbar_Vzrq" id="command-3">Command<a href="#command-3" class="hash-link" aria-label="Direct link to Command" title="Direct link to Command" translate="no">​</a></h5>
<table><thead><tr><th>Field</th><th>Type</th><th>Content</th><th>Expected</th></tr></thead><tbody><tr><td>CLA</td><td>byte (1)</td><td>Application Identifier</td><td>0x05</td></tr><tr><td>INS</td><td>byte (1)</td><td>Instruction ID</td><td>0x07</td></tr><tr><td>P1</td><td>byte (1)</td><td>Payload desc</td><td>0 = init</td></tr><tr><td></td><td></td><td></td><td>1 = add</td></tr><tr><td></td><td></td><td></td><td>2 = last</td></tr><tr><td>P2</td><td>byte (1)</td><td>----</td><td>not used</td></tr><tr><td>L</td><td>byte (1)</td><td>Bytes in payload</td><td>(depends)</td></tr></tbody></table>
<p>The first packet/chunk includes only the derivation path.</p>
<p>All other packets/chunks should contain message to sign.</p>
<p><em>First Packet</em></p>
<table><thead><tr><th>Field</th><th>Type</th><th>Content</th><th>Expected</th></tr></thead><tbody><tr><td>Path[0]</td><td>byte (4)</td><td>Derivation Path Data</td><td>44</td></tr><tr><td>Path[1]</td><td>byte (4)</td><td>Derivation Path Data</td><td>60</td></tr><tr><td>Path[2]</td><td>byte (4)</td><td>Derivation Path Data</td><td>?</td></tr><tr><td>Path[3]</td><td>byte (4)</td><td>Derivation Path Data</td><td>?</td></tr><tr><td>Path[4]</td><td>byte (4)</td><td>Derivation Path Data</td><td>?</td></tr></tbody></table>
<p><em>Other Chunks/Packets</em></p>
<table><thead><tr><th>Field</th><th>Type</th><th>Content</th><th>Expected</th></tr></thead><tbody><tr><td>Data</td><td>bytes...</td><td>Meta+Message</td><td></td></tr></tbody></table>
<p>Data is defined as:</p>
<table><thead><tr><th>Field</th><th>Type</th><th>Content</th><th>Expected</th></tr></thead><tbody><tr><td>Meta</td><td>bytes..</td><td>CBOR metadata</td><td></td></tr><tr><td>Message</td><td>bytes..</td><td>CBOR data to sign</td><td></td></tr></tbody></table>
<h5 class="anchor anchorTargetStickyNavbar_Vzrq" id="response-3">Response<a href="#response-3" class="hash-link" aria-label="Direct link to Response" title="Direct link to Response" translate="no">​</a></h5>
<table><thead><tr><th>Field</th><th>Type</th><th>Content</th><th>Note</th></tr></thead><tbody><tr><td>SIG</td><td>byte (65)</td><td>Signature</td><td>R,S,V bigendian integers</td></tr><tr><td>SW1-SW2</td><td>byte (2)</td><td>Return code</td><td>see list of return codes</td></tr></tbody></table>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="sign_rt_sr25519">SIGN_RT_SR25519<a href="#sign_rt_sr25519" class="hash-link" aria-label="Direct link to SIGN_RT_SR25519" title="Direct link to SIGN_RT_SR25519" translate="no">​</a></h4>
<h5 class="anchor anchorTargetStickyNavbar_Vzrq" id="command-4">Command<a href="#command-4" class="hash-link" aria-label="Direct link to Command" title="Direct link to Command" translate="no">​</a></h5>
<table><thead><tr><th>Field</th><th>Type</th><th>Content</th><th>Expected</th></tr></thead><tbody><tr><td>CLA</td><td>byte (1)</td><td>Application Identifier</td><td>0x05</td></tr><tr><td>INS</td><td>byte (1)</td><td>Instruction ID</td><td>0x06</td></tr><tr><td>P1</td><td>byte (1)</td><td>Payload desc</td><td>0 = init</td></tr><tr><td></td><td></td><td></td><td>1 = add</td></tr><tr><td></td><td></td><td></td><td>2 = last</td></tr><tr><td>P2</td><td>byte (1)</td><td>----</td><td>not used</td></tr><tr><td>L</td><td>byte (1)</td><td>Bytes in payload</td><td>(depends)</td></tr></tbody></table>
<p>The first packet/chunk includes only the derivation path.</p>
<p>All other packets/chunks should contain message to sign.</p>
<p><em>First Packet</em></p>
<table><thead><tr><th>Field</th><th>Type</th><th>Content</th><th>Expected</th></tr></thead><tbody><tr><td>Path[0]</td><td>byte (4)</td><td>Derivation Path Data</td><td>44</td></tr><tr><td>Path[1]</td><td>byte (4)</td><td>Derivation Path Data</td><td>474</td></tr><tr><td>Path[2]</td><td>byte (4)</td><td>Derivation Path Data</td><td>?</td></tr><tr><td>Path[3]</td><td>byte (4)</td><td>Derivation Path Data</td><td>?</td></tr><tr><td>Path[4]</td><td>byte (4)</td><td>Derivation Path Data</td><td>?</td></tr></tbody></table>
<p><em>Other Chunks/Packets</em></p>
<table><thead><tr><th>Field</th><th>Type</th><th>Content</th><th>Expected</th></tr></thead><tbody><tr><td>Data</td><td>bytes...</td><td>Meta+Message</td><td></td></tr></tbody></table>
<p>Data is defined as:</p>
<table><thead><tr><th>Field</th><th>Type</th><th>Content</th><th>Expected</th></tr></thead><tbody><tr><td>Meta</td><td>bytes..</td><td>CBOR metadata</td><td></td></tr><tr><td>Message</td><td>bytes..</td><td>CBOR data to sign</td><td></td></tr></tbody></table>
<h5 class="anchor anchorTargetStickyNavbar_Vzrq" id="response-4">Response<a href="#response-4" class="hash-link" aria-label="Direct link to Response" title="Direct link to Response" translate="no">​</a></h5>
<table><thead><tr><th>Field</th><th>Type</th><th>Content</th><th>Note</th></tr></thead><tbody><tr><td>SIG</td><td>byte (64)</td><td>Signature</td><td></td></tr><tr><td>SW1-SW2</td><td>byte (2)</td><td>Return code</td><td>see list of return codes</td></tr></tbody></table>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="meta-parameter">Meta parameter<a href="#meta-parameter" class="hash-link" aria-label="Direct link to Meta parameter" title="Direct link to Meta parameter" translate="no">​</a></h4>
<p><code>Meta</code> is a CBOR-encoded string → string map with the following fields:</p>
<ul>
<li class=""><code>runtime_id</code>: Base16-encoded <a href="https://github.com/oasisprotocol/oasis-core/blob/ba9802c0c2ccce366bec65f8426a0f3413670aff/docs/runtime/identifiers.md" target="_blank" rel="noopener noreferrer" class="">runtime ID</a> (64-byte string)</li>
<li class=""><code>chain_context</code>: <a href="https://github.com/oasisprotocol/oasis-core/blob/ba9802c0c2ccce366bec65f8426a0f3413670aff/docs/consensus/genesis.md#genesis-documents-hash" target="_blank" rel="noopener noreferrer" class="">chain ID</a> (64-byte string)</li>
<li class=""><code>orig_to</code> (optional): Base16-encoded ethereum destination address (40-byte
string)</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="changes-to-allowance-transaction">Changes to Allowance transaction<a href="#changes-to-allowance-transaction" class="hash-link" aria-label="Direct link to Changes to Allowance transaction" title="Direct link to Changes to Allowance transaction" translate="no">​</a></h3>
<p><a href="https://github.com/oasisprotocol/oasis-core/blob/ba9802c0c2ccce366bec65f8426a0f3413670aff/docs/consensus/services/staking.md#allow" target="_blank" rel="noopener noreferrer" class=""><code>staking.Allow</code></a> transaction already exists on the consensus layer. We propose
the following improvement to the UI:</p>
<div class="language-ledger codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ledger codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">|     Type     &gt; | &lt;    To    &gt; | &lt;    Amount    &gt; | &lt;     Fee     &gt; | &lt; Gas limit &gt; | &lt;  Network  &gt; | &lt;             &gt; | &lt;              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   Allowance    |     &lt;TO&gt;     |  ROSE +-&lt;AMOUNT&gt; |    ROSE &lt;FEE&gt;   |  &lt;GAS LIMIT&gt;  |   &lt;NETWORK&gt;   |     APPROVE     |     REJECT     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                |              |                  |                 |               |               |                 |                |</span><br></span></code></pre></div></div>
<p><strong>IMPROVEMENT:</strong> The hardware wallet renders the
following literals in place of <code>TO</code> for specific <code>NETWORK</code> and addresses:</p>
<ul>
<li class="">Network: Mainnet, To: <code>oasis1qrnu9yhwzap7rqh6tdcdcpz0zf86hwhycchkhvt8</code> → <code>Cipher</code></li>
<li class="">Network: Testnet, To: <code>oasis1qqdn25n5a2jtet2s5amc7gmchsqqgs4j0qcg5k0t</code> → <code>Cipher</code></li>
<li class="">Network: Mainnet, To: <code>oasis1qzvlg0grjxwgjj58tx2xvmv26era6t2csqn22pte</code> → <code>Emerald</code></li>
<li class="">Network: Testnet, To: <code>oasis1qr629x0tg9gm5fyhedgs9lw5eh3d8ycdnsxf0run</code> → <code>Emerald</code></li>
<li class="">Network: Mainnet, To: <code>oasis1qrd3mnzhhgst26hsp96uf45yhq6zlax0cuzdgcfc</code> → <code>Sapphire</code></li>
<li class="">Network: Testnet, To: <code>oasis1qqczuf3x6glkgjuf0xgtcpjjw95r3crf7y2323xd</code> → <code>Sapphire</code></li>
</ul>
<p>For more information on how the addresses above are derived from the runtime ID
check the <a href="https://github.com/oasisprotocol/oasis-core/blob/ba9802c0c2ccce366bec65f8426a0f3413670aff/docs/consensus/services/staking.md#runtime-accounts" target="_blank" rel="noopener noreferrer" class="">runtime accounts</a> section.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="signing-general-runtime-transactions">Signing general runtime transactions<a href="#signing-general-runtime-transactions" class="hash-link" aria-label="Direct link to Signing general runtime transactions" title="Direct link to Signing general runtime transactions" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="deposit">Deposit<a href="#deposit" class="hash-link" aria-label="Direct link to Deposit" title="Direct link to Deposit" translate="no">​</a></h4>
<p>We propose the following UI for <a href="https://github.com/oasisprotocol/oasis-sdk/blob/c36a7ee194abf4ca28fdac0edbefe3843b39bf69/runtime-sdk/src/modules/consensus_accounts/types.rs#L4-L13" target="_blank" rel="noopener noreferrer" class=""><code>consensus.Deposit</code></a> runtime transaction:</p>
<div class="language-ledger codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ledger codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">|     Type     &gt; | &lt;   To (1/1)  &gt; | &lt;   Amount    &gt; | &lt;     Fee     &gt; | &lt; Gas limit &gt; | &lt;  Network  &gt; | &lt;  ParaTime  &gt; | &lt;             &gt; | &lt;               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|    Deposit     |    &lt;MIXED_TO&gt;   | &lt;SYM&gt; &lt;AMOUNT&gt;  |  &lt;SYM&gt; &lt;FEE&gt;    |  &lt;GAS LIMIT&gt;  |   &lt;NETWORK&gt;   |    &lt;RUNTIME&gt;   |     APPROVE     |      REJECT     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   (ParaTime)   |                 |                 |                 |               |               |                |                 |                 |</span><br></span></code></pre></div></div>
<p><code>MIXED_TO</code> can either be <code>oasis1</code> or the Ethereum&#x27;s <code>0x</code> address. If <code>Meta</code>
does not contain <code>orig_to</code> field, render the <code>tx.call.body.to</code> value in
<code>oasis1</code> format in place of <code>MIXED_TO</code>. If <code>Meta.orig_to</code> is set,
then:</p>
<ol>
<li class="">Check that the ethereum address stored in <code>orig_to</code> field maps to the
native address in <code>tx.call.body.to</code> according to <a href="https://github.com/oasisprotocol/oasis-sdk/blob/c36a7ee194abf4ca28fdac0edbefe3843b39bf69/client-sdk/go/types/address.go#L135-L142" target="_blank" rel="noopener noreferrer" class="">the reference
implementation of the mapping</a>.</li>
<li class="">Render <code>orig_to</code> value in <code>0x</code> format in place of <code>MIXED_TO</code>.</li>
</ol>
<p>In addition, if <code>tx.call.body.to</code> is empty, then the deposit is made to the
signer&#x27;s account inside the runtime. In this case <code>Self</code> literal is rendered in
place of <code>MIXED_TO</code>.</p>
<p><code>AMOUNT</code> and <code>FEE</code> show the amount of tokens transferred in the transaction and
the transaction fee. The number must be formatted according to the number of
decimal places and showing a corresponding symbol <code>SYM</code> beside. These are
determined by the following mapping hardcoded in the hardware wallet:</p>
<p><code>(Network, Runtime ID, Denomination) → (Number of decimals, SYM)</code></p>
<p>Denomination information is stored in <code>tx.part.body.amount[1]</code> or
<code>tx.ai.fee.amount[1]</code> for the tokens transferred in the transaction or the fee
respectively. Empty Denomination is valid and signifies the native token
for the known networks and runtime IDs (see below).</p>
<p>The hardware wallet should have at least the following mappings hardcoded:</p>
<ul>
<li class="">Network: Mainnet, runtime ID: Cipher, Denomination: &quot;&quot; → 9, <code>ROSE</code></li>
<li class="">Network: Testnet, runtime ID: Cipher, Denomination: &quot;&quot; → 9, <code>TEST</code></li>
<li class="">Network: Mainnet, runtime ID: Emerald, Denomination: &quot;&quot; → 18, <code>ROSE</code></li>
<li class="">Network: Testnet, runtime ID: Emerald, Denomination: &quot;&quot; → 18, <code>TEST</code></li>
<li class="">Network: Mainnet, runtime ID: Sapphire, Denomination: &quot;&quot; → 18, <code>ROSE</code></li>
<li class="">Network: Testnet, runtime ID: Sapphire, Denomination: &quot;&quot; → 18, <code>TEST</code></li>
</ul>
<p>If the lookup fails, the following policy should be respected:</p>
<ol>
<li class=""><code>SYM</code> is rendered as empty string.</li>
<li class="">The number of decimals is 18, if runtime ID matches any Emerald or Sapphire
runtime on any network.</li>
<li class="">Otherwise, the number of decimals is 9.</li>
</ol>
<p><code>RUNTIME</code> shows the 32-byte hex encoded runtime ID stored in <code>Meta.runtime_id</code>.
If <code>NETWORK</code> matches Mainnet or Testnet, then human-readable version of
<code>RUNTIME</code> is shown:</p>
<ul>
<li class="">Network: Mainnet, runtime ID: <code>000000000000000000000000000000000000000000000000e199119c992377cb</code> → <code>Cipher</code></li>
<li class="">Network: Testnet, runtime ID: <code>0000000000000000000000000000000000000000000000000000000000000000</code> → <code>Cipher</code></li>
<li class="">Network: Mainnet, runtime ID: <code>000000000000000000000000000000000000000000000000e2eaa99fc008f87f</code> → <code>Emerald</code></li>
<li class="">Network: Testnet, runtime ID: <code>00000000000000000000000000000000000000000000000072c8215e60d5bca7</code> → <code>Emerald</code></li>
<li class="">Network: Mainnet, runtime ID: <code>000000000000000000000000000000000000000000000000f80306c9858e7279</code> → <code>Sapphire</code></li>
<li class="">Network: Testnet, runtime ID: <code>000000000000000000000000000000000000000000000000a6d1e3ebf60dff6c</code> → <code>Sapphire</code></li>
</ul>
<p><strong>SIGNATURE CONTEXT COMPUTATION:</strong> <a href="https://github.com/oasisprotocol/oasis-core/blob/ba9802c0c2ccce366bec65f8426a0f3413670aff/docs/crypto.md#chain-domain-separation" target="_blank" rel="noopener noreferrer" class="">Chain domain separation</a> context
for <strong>runtime</strong> transactions beginning with
<code>oasis-runtime-sdk/tx: v0 for chain </code> and followed by the hash derived from
<code>Meta.runtime_id</code> and <code>Meta.chain_context</code>. See <a href="https://github.com/oasisprotocol/oasis-sdk/blob/c36a7ee194abf4ca28fdac0edbefe3843b39bf69/client-sdk/go/crypto/signature/context.go" target="_blank" rel="noopener noreferrer" class="">golang implementation</a> for the reference implementation.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="withdraw">Withdraw<a href="#withdraw" class="hash-link" aria-label="Direct link to Withdraw" title="Direct link to Withdraw" translate="no">​</a></h4>
<p>We propose the following UI for <a href="https://github.com/oasisprotocol/oasis-sdk/blob/c36a7ee194abf4ca28fdac0edbefe3843b39bf69/runtime-sdk/src/modules/consensus_accounts/types.rs#L15-L23" target="_blank" rel="noopener noreferrer" class=""><code>consensus.Withdraw</code></a> method:</p>
<div class="language-ledger codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ledger codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">|     Type     &gt; | &lt;   To (1/1)  &gt; | &lt;   Amount    &gt; | &lt;     Fee     &gt; | &lt; Gas limit &gt; | &lt;  Network  &gt; | &lt;  ParaTime  &gt; | &lt;             &gt; | &lt;               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   Withdraw     |       &lt;TO&gt;      |  &lt;SYM&gt; &lt;AMOUNT&gt; |   &lt;SYM&gt; &lt;FEE&gt;   |  &lt;GAS LIMIT&gt;  |   &lt;NETWORK&gt;   |   &lt;RUNTIME&gt;    |     APPROVE     |      REJECT     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  (ParaTime)    |                 |                 |                 |               |               |                |                 |                 |</span><br></span></code></pre></div></div>
<p>If <code>tx.call.body.to</code> is empty, then the withdrawal is made to the signer&#x27;s
consensus account. In this case <code>Self</code> literal is rendered in
place of <code>TO</code>.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="transfer">Transfer<a href="#transfer" class="hash-link" aria-label="Direct link to Transfer" title="Direct link to Transfer" translate="no">​</a></h4>
<p>We propose the following UI for the <a href="https://github.com/oasisprotocol/oasis-sdk/blob/c36a7ee194abf4ca28fdac0edbefe3843b39bf69/runtime-sdk/src/modules/accounts/types.rs#L8-L13" target="_blank" rel="noopener noreferrer" class=""><code>accounts.Transfer</code></a> method:</p>
<div class="language-ledger codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ledger codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">|     Type     &gt; | &lt;   To (1/1)  &gt; | &lt;   Amount    &gt; | &lt;     Fee     &gt; | &lt; Gas limit &gt; | &lt;  Network  &gt; | &lt;  ParaTime  &gt; | &lt;             &gt; | &lt;               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   Transfer     |    &lt;MIXED_TO&gt;   | &lt;SYM&gt; &lt;AMOUNT&gt;  |   &lt;SYM&gt; &lt;FEE&gt;   |  &lt;GAS LIMIT&gt;  |   &lt;NETWORK&gt;   |   &lt;RUNTIME&gt;    |     APPROVE     |      REJECT     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  (ParaTime)    |                 |                 |                 |               |               |                |                 |                 |</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="example">Example<a href="#example" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example" translate="no">​</a></h4>
<p>The user wants to deposit 100 ROSE to
<code>0xDce075E1C39b1ae0b75D554558b6451A226ffe00</code> account on Emerald on the Mainnet.
First they sign the deposit allowance transaction for Emerald.</p>
<div class="language-ledger codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ledger codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">|     Type     &gt; | &lt;    To    &gt; | &lt;   Amount   &gt; | &lt; Gas limit &gt; | &lt;     Fee     &gt; | &lt;  Network  &gt; | &lt;             &gt; | &lt;              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   Allowance    |   Emerald    |  ROSE +100.0   |     1277      |     ROSE 0.0    |    Mainnet    |     APPROVE     |     REJECT     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                |   Mainnet    |                |               |                 |               |                 |                |</span><br></span></code></pre></div></div>
<p>Next, they sign the runtime deposit transaction.</p>
<div class="language-ledger codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ledger codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">|     Type     &gt; | &lt;   To (1/2)  &gt; | &lt;    To (2/2)   &gt; | &lt;   Amount    &gt; | &lt;     Fee     &gt; | &lt; Gas limit &gt; | &lt;  Network  &gt; | &lt;  ParaTime  &gt; | &lt;             &gt; | &lt;               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|    Deposit     | 0xDce075E1C39b1 | 451A226ffe00      |   ROSE 100.0    |     ROSE 0.0    |     11310     |    Mainnet    |     Emerald    |     APPROVE     |      REJECT     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   (ParaTime)   | ae0b75D554558b6 |                   |                 |                 |               |               |                |                 |                 |</span><br></span></code></pre></div></div>
<p>Then, they transfer some tokens to another account inside the runtime:</p>
<div class="language-ledger codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ledger codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">|     Type     &gt; | &lt;    To (1/2)  &gt; | &lt;    To (2/2)   &gt; | &lt;   Amount    &gt; | &lt;     Fee     &gt; | &lt; Gas limit &gt; | &lt;  Network  &gt; | &lt;  ParaTime  &gt; | &lt;             &gt; | &lt;               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   Transfer     | oasis1qpupfu7e2n | m8anj64ytrayne    |   ROSE 10.0     |  ROSE 0.00015   |     11311     |    Mainnet    |    Emerald     |     APPROVE     |      REJECT     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  (ParaTime)    | 6pkezeaw0yhj8mce |                   |                 |                 |               |               |                |                 |                 |</span><br></span></code></pre></div></div>
<p>Finally, the user withdraws the remainder of tokens back to the Mainnet.</p>
<div class="language-ledger codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ledger codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">|     Type     &gt; | &lt;    To (1/2)  &gt; | &lt;    To (2/2)   &gt; | &lt;   Amount    &gt; | &lt;     Fee     &gt; | &lt; Gas limit &gt; | &lt;  Network  &gt; | &lt;  ParaTime  &gt; | &lt;             &gt; | &lt;               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   Withdraw     | oasis1qrec770vre | 504k68svq7kzve    |  ROSE 99.9997   |  ROSE 0.00015   |     11311     |    Mainnet    |    Emerald     |     APPROVE     |      REJECT     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  (ParaTime)    | k0a9a5lcrv0zvt22 |                   |                 |                 |               |               |                |                 |                 |</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="signing-smart-contract-runtime-transactions">Signing smart contract runtime transactions<a href="#signing-smart-contract-runtime-transactions" class="hash-link" aria-label="Direct link to Signing smart contract runtime transactions" title="Direct link to Signing smart contract runtime transactions" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="uploading-smart-contract">Uploading smart contract<a href="#uploading-smart-contract" class="hash-link" aria-label="Direct link to Uploading smart contract" title="Direct link to Uploading smart contract" translate="no">​</a></h4>
<p><a href="https://github.com/oasisprotocol/oasis-sdk/blob/c36a7ee194abf4ca28fdac0edbefe3843b39bf69/runtime-sdk/modules/contracts/src/types.rs#L99-L110" target="_blank" rel="noopener noreferrer" class=""><code>contracts.Upload</code></a> method will not be signed by the hardware wallet
because the size of the Wasm byte code to sign may easily exceed the maximum
size of the available encrypted memory.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="instantiating-smart-contract">Instantiating smart contract<a href="#instantiating-smart-contract" class="hash-link" aria-label="Direct link to Instantiating smart contract" title="Direct link to Instantiating smart contract" translate="no">​</a></h4>
<p>We propose the following UI for the <a href="https://github.com/oasisprotocol/oasis-sdk/blob/c36a7ee194abf4ca28fdac0edbefe3843b39bf69/runtime-sdk/modules/contracts/src/types.rs#L119-L133" target="_blank" rel="noopener noreferrer" class=""><code>contracts.Instantiate</code></a> method:</p>
<div class="language-ledger codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ledger codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">|  Review Contract &gt; | &lt; Code ID &gt; | &lt; Amount (1/1) &gt; | &lt; Data (1/1) &gt; | ... | &lt;    Fee    &gt; | &lt; Gas limit &gt; | &lt;  Network  &gt; | &lt;  ParaTime  &gt; | &lt;             &gt; | &lt;               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   Instantiation    |  &lt;CODE ID&gt;  |   &lt;AMOUNT...&gt;    |     &lt;DATA&gt;     | ... |  &lt;SYM&gt; &lt;FEE&gt;  |  &lt;GAS LIMIT&gt;  |   &lt;NETWORK&gt;   |   &lt;RUNTIME&gt;    |     APPROVE     |      REJECT     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|    (ParaTime)      |             |                  |                | ... |               |               |               |                |                 |                 |</span><br></span></code></pre></div></div>
<p><code>DATA</code> is a JSON-like representation of <code>tx.call.body.data</code>, if the latter
is a CBOR-encoded map. If <code>tx.call.body.data</code> is empty or not present,
then Data screen is hidden. If <code>tx.call.body.data</code> is in some other format,
require <strong>blind signing</strong> mode and hide Data screen.</p>
<p>Blind signing means that the user does not see all contract information. In some
cases - as is this - not even the amount or the contract address! <strong>When
signing blindly, it is crucial that the user trusts the client application that
it generated a non-malicious transaction!</strong></p>
<p><code>AMOUNT...</code> is the amount of tokens sent. Contract SDK supports sending
multiple tokens at once, each with its own denomination symbol. The hardware
wallet should render all of them, one per page. For rendering rules of each
<code>AMOUNT</code> consult the <a href="#deposit" class="">runtime deposit</a> behavior.</p>
<p>There can be multiple Data screens Data 1, Data 2, ..., Data N for each key in
<code>tx.call.body.data</code> map. <code>DATA</code> can be one of the following types:</p>
<ul>
<li class="">string</li>
<li class="">number (integer, float)</li>
<li class="">array</li>
<li class="">map</li>
<li class="">boolean</li>
<li class="">null</li>
</ul>
<p>Strings are rendered as UTF-8 strings and the following characters need to be
escaped: <code>:</code>, <code>,</code>, <code>}</code>, <code>]</code>, <code>…</code>.</p>
<p>Numbers are rendered in standard general base-10 encoding. Floats use decimal
period and should be rendered with at least one decimal.</p>
<p>For strings and numbers that cannot fit a single page, a pagination is
activated.</p>
<p>Boolean and null values are rendered as <code>true</code>, <code>false</code> and <code>null</code> respectively
on a single page.</p>
<p>Array and map is rendered in form <code>VAL1,VAL2,...</code> and <code>KEY1:VAL1,KEY1:VAL1,...</code>
respectively. For security, <strong>the items of the map must be sorted
lexicographically by KEY</strong>. <code>KEY</code> and <code>VAL</code> can be of any supported type. If it
is a map or array it is rendered as <code>{DATA}</code> or <code>[DATA]</code> respectively
to avoid disambiguation. Otherwise, it is just <code>DATA</code>.</p>
<p>If the content of an array or a map cannot fit a single page, no pagination
is introduced. Instead, the content is trimmed, ellipsis <code>…</code> is appended at
the end and the screen <strong>becomes confirmable</strong>. If the user double-clicks it, a
subscreen for item <code>n</code> of an array or a map is shown. There is one subscreen
for each item of the array or a map of size <code>N</code> titled Data n.1,
Data n.2, ..., Data n.N which renders the item <code>n</code> as
<code>DATA</code> for an array item or <code>DATA:DATA</code> for a map item:</p>
<div class="language-ledger codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ledger codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">|   Data 1.1 (1/1) &gt; | &lt; Data 1.2 (1/1) | &lt; Data 1.3 (1/1) | ... | &lt;          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|       &lt;DATA&gt;       |      &lt;DATA&gt;      |      &lt;DATA&gt;      |     |    BACK    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                    |                  |                  |     |            |</span><br></span></code></pre></div></div>
<p>The recursive approach described above allows user to browse through a complete
tree of data stracture (typically a request name along with the arguments) by
using ⬅️ and ➡️ buttons, visit a child by double-clicking and returning to a
parent node by confirming the <em>BACK</em> screen.</p>
<p>The maximum string length, the length of the array, the depth of a map must
have reasonable limits on the hardware wallet. If that limit is exceeded, the
hardware wallet displays an error on the initial screen. Then, if the user
still wants to sign such a transaction, they need to enable <strong>blind signing</strong>.</p>
<p>The following UI is shown when blind-signing a non-encrypted transaction due
to too complex function parameters.</p>
<div class="language-ledger codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ledger codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">|  Review Contract &gt; | &lt; BLIND &gt; | &lt; Instance ID (1/1) &gt; | &lt;   Amount    &gt; | &lt;     Fee     &gt; | &lt;  Network  &gt; | &lt;  ParaTime &gt; | &lt;            &gt; | &lt;             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   Instantiation    |  SIGNING! |     &lt;INSTANCE ID&gt;     | &lt;SYM&gt; &lt;AMOUNT&gt;  |   &lt;SYM&gt; &lt;FEE&gt;   |   &lt;NETWORK&gt;   |   &lt;RUNTIME&gt;   |    APPROVE     |     REJECT    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|    (ParaTime)      |           |                       |                 |                 |               |               |                |               |</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="calling-smart-contract">Calling smart contract<a href="#calling-smart-contract" class="hash-link" aria-label="Direct link to Calling smart contract" title="Direct link to Calling smart contract" translate="no">​</a></h4>
<p>The hardware wallet should show details of the runtime transaction to the
user, when this is possible. We propose the following UI for the
<a href="https://github.com/oasisprotocol/oasis-sdk/blob/c36a7ee194abf4ca28fdac0edbefe3843b39bf69/runtime-sdk/modules/contracts/src/types.rs#L142-L153" target="_blank" rel="noopener noreferrer" class=""><code>contracts.Call</code></a> method:</p>
<div class="language-ledger codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ledger codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| Review Contract &gt; | &lt; Instance ID &gt; | &lt; Amount (1/1) &gt; | &lt; Data (1/1) &gt; | ... | &lt;     Fee     &gt; | &lt; Gas limit &gt; | &lt;  Network  &gt; | &lt;  ParaTime  &gt; | &lt;             &gt; | &lt;              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      Call         |  &lt;INSTANCE ID&gt;  |   &lt;AMOUNT...&gt;    |     &lt;DATA&gt;     | ... |   &lt;SYM&gt; &lt;FEE&gt;   |  &lt;GAS LIMIT&gt;  |   &lt;NETWORK&gt;   |   &lt;RUNTIME&gt;    |     APPROVE     |     REJECT     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   (ParaTime)      |                 |                  |                | ... |                 |               |               |                |                 |                |</span><br></span></code></pre></div></div>
<p>The Data screen behavior is the same as for
<a href="#instantiating-smart-contract" class=""><code>contracts.Instantiate</code></a> transaction.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="upgrading-smart-contracts">Upgrading smart contracts<a href="#upgrading-smart-contracts" class="hash-link" aria-label="Direct link to Upgrading smart contracts" title="Direct link to Upgrading smart contracts" translate="no">​</a></h4>
<p>We propose the following UI for the <a href="https://github.com/oasisprotocol/oasis-sdk/blob/c36a7ee194abf4ca28fdac0edbefe3843b39bf69/runtime-sdk/modules/contracts/src/types.rs#L160-L174" target="_blank" rel="noopener noreferrer" class=""><code>contracts.Upgrade</code></a> method:</p>
<div class="language-ledger codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ledger codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">|  Review Contract &gt; | &lt; Instance ID (1/1) &gt; | &lt; Amount (1/1) &gt; | &lt; New Code ID (1/1) &gt; | &lt; Data (1/1) &gt; | ... | &lt; ParaTime &gt; | &lt;     Fee     &gt; | &lt; Gas limit &gt; | &lt; Network &gt; | &lt; ParaTime &gt; | &lt;             &gt; | &lt;               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      Upgrade       |     &lt;INSTANCE ID&gt;     |   &lt;AMOUNT...&gt;    |      &lt;CODE_ID&gt;        |     &lt;DATA&gt;     |     |  &lt;RUNTIME&gt;   |   &lt;SYM&gt; &lt;FEE&gt;   |  &lt;GAS LIMIT&gt;  |  &lt;NETWORK&gt;  |  &lt;RUNTIME&gt;   |    APPROVE      |      REJECT     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|    (ParaTime)      |                       |                  |                       |                |     |              |                 |               |             |              |                 |                 |</span><br></span></code></pre></div></div>
<p>The Data screen behavior is the same as for the
<a href="#instantiating-smart-contract" class="">contract instantiate</a> transaction.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-1">Example<a href="#example-1" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example" translate="no">​</a></h4>
<p>To upload, instantiate and call the <a class="" href="/build/tools/other-paratimes/cipher/hello-world#deploying-the-contract">hello world example</a> running on Testnet
Cipher the user first signs the contract upload transaction with a file-based
ed25519 keypair. The user obtains the <code>Code ID</code> 3 for the uploaded contract.</p>
<p>Next, the user instantiates the contract and obtains the <code>Instance ID</code> 2.</p>
<div class="language-ledger codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ledger codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">|  Review Contract &gt; | &lt; Code ID &gt; | &lt;  Amount  &gt; | &lt;      Data      &gt; | &lt;    Fee    &gt; | &lt; Gas limit &gt; | &lt;  Network  &gt; | &lt;  ParaTime  &gt; | &lt;             &gt; | &lt;               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   Instantiation    |      3      |   ROSE 0.0   | {instantiate:{init |   ROSE 0.0    |     1348      |    Mainnet    |     Cipher     |     APPROVE     |      REJECT     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|    (ParaTime)      |             |              | ial_counter:42}}   |               |               |               |                |                 |                 |                 |</span><br></span></code></pre></div></div>
<p>Finally, they perform a call to <code>say_hello</code> function on a smart contract
passing the <code>{&quot;who&quot;:&quot;me&quot;}</code> object as a function argument.</p>
<div class="language-ledger codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ledger codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| Review Contract &gt; | &lt; Instance ID &gt; | &lt;  Amount  &gt; | &lt;      Data      &gt; | &lt;     Fee     &gt; | &lt; Gas limit &gt; | &lt;  Network  &gt; | &lt;  ParaTime  &gt; | &lt;             &gt; | &lt;              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      Call         |       2         |   ROSE 0.0   | {say_hello:{who:me |     ROSE 0.0    |     1283      |    Mainnet    |     Cipher     |     APPROVE     |     REJECT     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   (ParaTime)      |                 |              | }}                 |                 |               |               |                |                 |                |</span><br></span></code></pre></div></div>
<p>For a complete example, the user can provide a more complex object:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;who&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;username&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;alice&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;client_secret&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;e5868ebb4445fc2ad9f949956c1cb9ddefa0d421&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;last_logins&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1646835046</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1615299046</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1583763046</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1552140646</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;redirect&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token null keyword" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>In this case the hardware wallet renders the following UI.</p>
<div class="language-ledger codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ledger codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| Review Contract &gt; | &lt;  Instance ID  &gt; | &lt;   Amount  &gt; | &lt;      Data      &gt; | &lt;     Fee     &gt; | &lt; Gas limit &gt; | &lt;  Network  &gt; | &lt;  ParaTime  &gt; | &lt;            &gt; | &lt;              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      Call         |       2           |    ROSE 0.0   | {say_hello:{who:{u |    ROSE 0.15    |     1283      |    Mainnet    |     Cipher     |    APPROVE     |     REJECT     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   (ParaTime)      |                   |               | sername:alice,cli… |                 |               |               |                |                |                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                        V                    V</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                        |       Data 1     &gt; | &lt;            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                        | say_hello:{who:{us |     BACK     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                        | ername:alice,clie… |              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                        V                    V</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                        |      Data 1.1    &gt; | &lt;            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                        | who:{username:alic |     BACK     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                        | e,client_secret:[… |              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                        V                    V</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                        |     Data 1.1.1   &gt; | &lt; Data 1.1.2 (1/2) &gt; | &lt; Data 1.1.2 (2/2) &gt; | &lt;    Data 1.1.3    &gt; | &lt;    Data 1.1.4    &gt; | &lt;            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                        | username:alice     | client_secret:e5868e | 1cb9ddefa0d421       | last_logins:[1646835 | redirect:null        |     BACK     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                        |                    | bb4445fc2ad9f949956c |                      | 046,1615299046,1583… |                      |              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                                                                           V                      V</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                                                                           |     Data 1.1.3.1   &gt; | &lt;   Data 1.1.3.2   &gt; | &lt;   Data 1.1.3.3   &gt; | &lt;   Data 1.1.3.4     | &lt;            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                                                                           |      1646835046      |      1615299046      |      1583763046      |      1552140646      |     BACK     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                                                                           |                      |                      |                      |                      |              |</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="signing-evm-runtime-transactions">Signing EVM runtime transactions<a href="#signing-evm-runtime-transactions" class="hash-link" aria-label="Direct link to Signing EVM runtime transactions" title="Direct link to Signing EVM runtime transactions" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="creating-smart-contract">Creating smart contract<a href="#creating-smart-contract" class="hash-link" aria-label="Direct link to Creating smart contract" title="Direct link to Creating smart contract" translate="no">​</a></h4>
<p><a href="https://github.com/oasisprotocol/oasis-sdk/blob/c36a7ee194abf4ca28fdac0edbefe3843b39bf69/runtime-sdk/modules/evm/src/types.rs#L3-L8" target="_blank" rel="noopener noreferrer" class=""><code>evm.Create</code></a> method will not be managed by the hardware wallet because the
size of the EVM byte code may easily exceed the wallet&#x27;s encrypted memory size.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="calling-smart-contract-1">Calling smart contract<a href="#calling-smart-contract-1" class="hash-link" aria-label="Direct link to Calling smart contract" title="Direct link to Calling smart contract" translate="no">​</a></h4>
<p>In contrast to <code>contracts.Call</code>, <a href="https://github.com/oasisprotocol/oasis-sdk/blob/c36a7ee194abf4ca28fdac0edbefe3843b39bf69/runtime-sdk/modules/evm/src/types.rs#L10-L16" target="_blank" rel="noopener noreferrer" class=""><code>evm.Call</code></a> method requires contract ABI and
support for RLP decoding in order to extract argument names from
<code>tx.call.body.data</code>. This is outside of the scope of this ADR and the <strong>blind
signing</strong>, explicitly allowed by the user, is performed.</p>
<p>We propose the following UI:</p>
<div class="language-ledger codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ledger codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| Review Contract &gt; | &lt; BLIND &gt; | &lt; Tx hash (1/1) &gt; | &lt; Address (1/1) &gt; | &lt;   Amount    &gt; | &lt;     Fee     &gt; | &lt; Gas limit &gt; | &lt;  Network  &gt; | &lt;  ParaTime &gt; | &lt;            &gt; | &lt;             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|      Call         |  SIGNING! |     &lt;TX_HASH&gt;     |     &lt;ADDRESS&gt;     | &lt;SYM&gt; &lt;AMOUNT&gt;  |   &lt;SYM&gt; &lt;FEE&gt;   |  &lt;GAS LIMIT&gt;  |   &lt;NETWORK&gt;   |   &lt;RUNTIME&gt;   |    APPROVE     |     REJECT    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   (ParaTime)      |           |                   |                   |                 |                 |               |               |               |                |               |</span><br></span></code></pre></div></div>
<p><code>TX_HASH</code> is a hex representation of sha256 checksum of <code>tx.call.body.data</code>
field.</p>
<p><code>ADDRESS</code> is a hex-encoded address of the smart contract.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="signing-encrypted-runtime-transactions">Signing encrypted runtime transactions<a href="#signing-encrypted-runtime-transactions" class="hash-link" aria-label="Direct link to Signing encrypted runtime transactions" title="Direct link to Signing encrypted runtime transactions" translate="no">​</a></h3>
<p>Encrypted transactions (<code>tx.call.format == 1</code>) contain call data inside the
<a href="https://github.com/oasisprotocol/oasis-sdk/blob/c36a7ee194abf4ca28fdac0edbefe3843b39bf69/runtime-sdk/src/types/callformat.rs#L7-L16" target="_blank" rel="noopener noreferrer" class="">envelope&#x27;s <code>data</code> field</a> encrypted with Deoxys-II
ephemeral key and X25519 key derivation.</p>
<p>The hardware wallet is not expected to implement any of these decryption
schemes, neither it is safe to share the ephemeral key with anyone. Instead,
the user should enable <strong>blind signing</strong> and the hardware wallet should
show the hash of the encrypted call data, the public key and the nonce:</p>
<div class="language-ledger codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ledger codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| Review Encrypted &gt; | &lt; BLIND &gt; | &lt; Tx hash (1/1) &gt; | &lt; Public key (1/1) &gt; | &lt;  Nonce (1/1) &gt; | &lt;    Fee    &gt; | &lt; Gas limit &gt; | &lt;  Network  &gt; | &lt;  ParaTime &gt; | &lt;             &gt; | &lt;             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   Transaction      |  SIGNING! |     &lt;TX_HASH&gt;     |     &lt;PUBLIC_KEY&gt;     |      &lt;NONCE&gt;     |  &lt;SYM&gt; &lt;FEE&gt;  |  &lt;GAS LIMIT&gt;  |   &lt;NETWORK&gt;   |   &lt;RUNTIME&gt;   |     APPROVE     |     REJECT    |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   (ParaTime)       |           |                   |                      |                  |               |               |               |               |                 |               |</span><br></span></code></pre></div></div>
<p><code>TX_HASH</code> is a hex representation of sha256 checksum of <code>tx.call.body.data</code>
field.</p>
<p><code>PUBLIC_KEY</code> is a hex representation of the 32-byte <code>tx.call.body.pk</code> field.</p>
<p><code>NONCE</code> is a hex representation of the 15-byte <code>tx.call.body.nonce</code> field.</p>
<p>Since the transaction stored inside the <code>tx.call.body.data</code> field is encrypted,
there is also no way to discriminate between the transactions, for example
<code>contracts.Call</code>, <code>contracts.Upgrade</code> or <code>evm.Call</code>.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="consequences">Consequences<a href="#consequences" class="hash-link" aria-label="Direct link to Consequences" title="Direct link to Consequences" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="positive">Positive<a href="#positive" class="hash-link" aria-label="Direct link to Positive" title="Direct link to Positive" translate="no">​</a></h3>
<p>Users will have a similar experience for signing runtime transactions on any
wallet implementing this ADR.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="negative">Negative<a href="#negative" class="hash-link" aria-label="Direct link to Negative" title="Direct link to Negative" translate="no">​</a></h3>
<p>For some transactions, user will need to trust the client application and use
blind signing.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="neutral">Neutral<a href="#neutral" class="hash-link" aria-label="Direct link to Neutral" title="Direct link to Neutral" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="consideration-of-roothashsubmitmsg-transactions">Consideration of <code>roothash.SubmitMsg</code> transactions<a href="#consideration-of-roothashsubmitmsg-transactions" class="hash-link" aria-label="Direct link to consideration-of-roothashsubmitmsg-transactions" title="Direct link to consideration-of-roothashsubmitmsg-transactions" translate="no">​</a></h4>
<p>This ADR does not propose a UI for <em>generic</em> runtime calls
(<code>roothash.SubmitMsg</code>, see <a class="" href="/adrs/0011-incoming-runtime-messages">ADR 11</a>). The proposed design in this ADR assumes a
new release of the hardware wallet app each time a new runtime transaction type
is introduced.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="signing-contract-uploads-on-hardware-wallets">Signing contract uploads on hardware wallets<a href="#signing-contract-uploads-on-hardware-wallets" class="hash-link" aria-label="Direct link to Signing contract uploads on hardware wallets" title="Direct link to Signing contract uploads on hardware wallets" translate="no">​</a></h4>
<p>In the future perhaps, if only the merkle root hash of the Wasm contract would
be contained in the transaction, signing such a contract could be feasible. See
how Ethereum 2.x contract deployment is done using this approach.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="consideration-of-adding-from-screen">Consideration of adding <code>From</code> screen<a href="#consideration-of-adding-from-screen" class="hash-link" aria-label="Direct link to consideration-of-adding-from-screen" title="Direct link to consideration-of-adding-from-screen" translate="no">​</a></h4>
<p>None of the proposed UIs and the existing implementation of signing the
consensus transactions on Ledger show <em>who</em> is a signer of the transaction.
The signer&#x27;s <em>from</em> address can be extracted from
<code>tx.ai.si[0].address_spec.signature.&lt;SIGNATURE TYPE&gt;</code>
for oasis native address and if the signer wants to show the Ethereum address,
<code>Meta.orig_from</code> should be populated and the hardware wallet should
verify it before showing the tx.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References" translate="no">​</a></h2>
<ul>
<li class=""><a href="https://github.com/Zondax/ledger-oasis/blob/master/docs/APDUSPEC.md" target="_blank" rel="noopener noreferrer" class="">Existing APDU specification</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/oasisprotocol/adrs/edit/main/0014-runtime-signing-tx-with-hardware-wallet.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-08-04T08:13:58.000Z" itemprop="dateModified">Aug 4, 2025</time></b></span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/adrs/0013-runtime-upgrades"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">ADR 0013: Runtime Upgrade Improvements</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/adrs/0015-vrf-per-block-entropy"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">ADR 0015: Randomized Paratime Proposer Selection</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#component" class="table-of-contents__link toc-highlight">Component</a></li><li><a href="#changelog" class="table-of-contents__link toc-highlight">Changelog</a></li><li><a href="#status" class="table-of-contents__link toc-highlight">Status</a></li><li><a href="#context" class="table-of-contents__link toc-highlight">Context</a><ul><li><a href="#test-vectors" class="table-of-contents__link toc-highlight">Test vectors</a></li><li><a href="#runtime-transaction-format" class="table-of-contents__link toc-highlight">Runtime transaction format</a></li></ul></li><li><a href="#decision" class="table-of-contents__link toc-highlight">Decision</a><ul><li><a href="#apduspec-additions" class="table-of-contents__link toc-highlight">APDUSPEC additions</a></li><li><a href="#changes-to-allowance-transaction" class="table-of-contents__link toc-highlight">Changes to Allowance transaction</a></li><li><a href="#signing-general-runtime-transactions" class="table-of-contents__link toc-highlight">Signing general runtime transactions</a></li><li><a href="#signing-smart-contract-runtime-transactions" class="table-of-contents__link toc-highlight">Signing smart contract runtime transactions</a></li><li><a href="#signing-evm-runtime-transactions" class="table-of-contents__link toc-highlight">Signing EVM runtime transactions</a></li><li><a href="#signing-encrypted-runtime-transactions" class="table-of-contents__link toc-highlight">Signing encrypted runtime transactions</a></li></ul></li><li><a href="#consequences" class="table-of-contents__link toc-highlight">Consequences</a><ul><li><a href="#positive" class="table-of-contents__link toc-highlight">Positive</a></li><li><a href="#negative" class="table-of-contents__link toc-highlight">Negative</a></li><li><a href="#neutral" class="table-of-contents__link toc-highlight">Neutral</a></li></ul></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Tools</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://explorer.oasis.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Explorer</a></li><li class="footer__item"><a href="https://wallet.oasis.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Wallet</a></li><li class="footer__item"><a href="https://github.com/oasisprotocol/cli" target="_blank" rel="noopener noreferrer" class="footer__link-item">CLI</a></li><li class="footer__item"><a href="https://status.oasis.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Status</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Build</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://faucet.testnet.oasis.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Testnet Faucet</a></li><li class="footer__item"><a href="https://playground.oasis.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Playground</a></li><li class="footer__item"><a href="https://api.docs.oasis.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">API</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Node</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/node/network/mainnet">Mainnet</a></li><li class="footer__item"><a class="footer__link-item" href="/node/network/testnet">Testnet</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://oasis.io/discord" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://t.me/oasisprotocolcommunity" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram</a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UC35UFPcZ2F1wjPxhPrSsESQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube</a></li><li class="footer__item"><a href="https://github.com/oasisprotocol" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
<p xmlns:cc="http://creativecommons.org/ns#">Copyright © 2026
by <a rel="cc:attributionURL dct:creator" property="cc:attributionName" href="https://oasis.net">
Oasis Protocol Foundation</a>. We <a href="https://oasisprotocol.org/privacy-policy" target="_blank" rel="noopener noreferrer">respect your privacy</a>.
Unless otherwise specified, all text and images on this website are licensed
under <a href="http://creativecommons.org/licenses/by/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">
CC BY 4.0<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="/img/cc.svg"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="/img/by.svg"></a>.
This does not include the Oasis software and the code examples, both of which are
licensed under <a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">
Apache 2.0</a>. Built with &#x2665; and Docusaurus.</p></div></div></div></footer><!--$--><!--/$--></div>
</body>
</html>