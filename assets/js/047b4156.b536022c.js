"use strict";(globalThis.webpackChunkdocs_oasis_io=globalThis.webpackChunkdocs_oasis_io||[]).push([[5296],{28453:(e,n,o)=>{o.d(n,{R:()=>i,x:()=>a});var t=o(96540);const s={},r=t.createContext(s);function i(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(r.Provider,{value:n},e.children)}},74425:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>l,frontMatter:()=>i,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"node/run-your-node/advanced/copy-state-from-one-node-to-the-other","title":"Copy State from One Node to the Other","description":"A network that\'s been running for some time can accrue significant amount of","source":"@site/docs/node/run-your-node/advanced/copy-state-from-one-node-to-the-other.md","sourceDirName":"node/run-your-node/advanced","slug":"/node/run-your-node/advanced/copy-state-from-one-node-to-the-other","permalink":"/node/run-your-node/advanced/copy-state-from-one-node-to-the-other","draft":false,"unlisted":false,"editUrl":"https://github.com/oasisprotocol/docs/edit/main/docs/node/run-your-node/advanced/copy-state-from-one-node-to-the-other.md","tags":[],"version":"current","lastUpdatedAt":1769514538000,"frontMatter":{"sidebar_custom_props":{}},"sidebar":"operators","previous":{"title":"Pruning State","permalink":"/node/run-your-node/advanced/pruning"},"next":{"title":"Remote Signer for Oasis Node Keys","permalink":"/node/run-your-node/advanced/remote-signer"}}');var s=o(74848),r=o(28453);const i={sidebar_custom_props:{tags:void 0}},a="Copy State from One Node to the Other",d={},c=[];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"copy-state-from-one-node-to-the-other",children:"Copy State from One Node to the Other"})}),"\n",(0,s.jsx)(n.p,{children:"A network that's been running for some time can accrue significant amount of\nstate. This means  bootstrapping a new Oasis node would take quite some time and\nresources (bandwidth, CPU) since it would need to fetch (download) and validate\n(replay) all the blocks from the genesis height onwards."}),"\n",(0,s.jsx)(n.p,{children:"If one has access to an Oasis node that is synced with the latest height, he\ncould just copy Oasis node's state from the synced node to an unsynced node."}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["Another way to speed up bootstrapping an Oasis node is to sync the node using\nthe ",(0,s.jsx)(n.a,{href:"/node/run-your-node/advanced/sync-node-using-state-sync",children:"State Sync"}),"."]})}),"\n",(0,s.jsxs)(n.p,{children:["To bootstrap a new Oasis node by copying state from a synced Oasis node, first\nset up your new Oasis node as a ",(0,s.jsx)(n.a,{href:"/node/run-your-node/validator-node",children:"Validator Node"}),", a\n",(0,s.jsx)(n.a,{href:"/node/run-your-node/non-validator-node",children:"Non-validator Node"})," or a\n",(0,s.jsx)(n.a,{href:"/node/run-your-node/paratime-node",children:"ParaTime Node"}),"."]}),"\n",(0,s.jsx)(n.admonition,{type:"caution",children:(0,s.jsxs)(n.p,{children:["Make sure you use the ",(0,s.jsx)(n.strong,{children:"exact same version of Oasis Core"})," on both the synced\nOasis node and your new Oasis node to prevent ",(0,s.jsx)(n.strong,{children:"issues or state corruption"})," if\nan Oasis node's state is opened ",(0,s.jsx)(n.strong,{children:"with an incompatible version"})," of Oasis\nCore."]})}),"\n",(0,s.jsx)(n.p,{children:"Before starting your new Oasis node, do the following:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Stop the synced Oasis node."}),"\n",(0,s.jsx)(n.admonition,{type:"danger",children:(0,s.jsxs)(n.p,{children:["If an Oasis node is ",(0,s.jsx)(n.strong,{children:"not stopped"})," before its state is copied, its on-disk\nstate might not be consistent and up-to-date. This can lead to ",(0,s.jsx)(n.strong,{children:"state\ncorruption"})," and inability to use the state with your new Oasis node."]})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Copy the following directories from your synced Oasis node's ",(0,s.jsx)(n.strong,{children:"data\ndirectory"})," (e.g. ",(0,s.jsx)(n.code,{children:"/node/data"}),") to your new Oasis node's data directory:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"consensus/state"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"consensus/data"})}),"\n"]}),"\n",(0,s.jsxs)(n.admonition,{type:"caution",children:[(0,s.jsxs)(n.p,{children:["You could also copy the whole ",(0,s.jsx)(n.code,{children:"consensus"})," directory from your synced Oasis\nnode's working directory. In that case, you must ",(0,s.jsx)(n.strong,{children:"omit"})," the\n",(0,s.jsxs)(n.strong,{children:[(0,s.jsx)(n.code,{children:"oasis_priv_validator.json"})," file"]}),", otherwise starting your new Oasis node\nwith fail with something like:"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{"caller":"node.go:541","err":"cometbft/crypto: public key mismatch, state corruption?: %!w(<nil>)","level":"error","module":"oasis-node","msg":"failed to initialize cometbft service","ts":"2023-11-25T14:13:17.919296668Z"}\n'})})]}),"\n",(0,s.jsx)(n.admonition,{type:"caution",children:(0,s.jsxs)(n.p,{children:["If you are copying data from a node that is running ",(0,s.jsx)(n.a,{href:"/node/run-your-node/prerequisites/set-up-tee",children:"TEE-enabled ParaTimes"}),",\nyou must make sure to ",(0,s.jsx)(n.strong,{children:"remove"})," the ",(0,s.jsx)(n.code,{children:"runtimes/*/worker-local-storage.badger.db"}),"\nas otherwise the ParaTime binary may fail to start on a different node since\nit contains data sealed to the source CPU."]})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Start back the synced Oasis node."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Finally, you can start your new Oasis node for the first time."})]})}function l(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}}}]);