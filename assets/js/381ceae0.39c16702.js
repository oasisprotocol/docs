"use strict";(globalThis.webpackChunkdocs_oasis_io=globalThis.webpackChunkdocs_oasis_io||[]).push([[6203],{28453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>l});var i=s(96540);const t={},a=i.createContext(t);function r(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),i.createElement(a.Provider,{value:n},e.children)}},59895:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"build/use-cases/trustless-agent","title":"Trustless AI Agent","description":"Deploy a trustless Eliza AI agent on Oasis using ROFL enclaves, with enclave-managed keys and on-chain verification on Sapphire.","source":"@site/docs/build/use-cases/trustless-agent.mdx","sourceDirName":"build/use-cases","slug":"/build/use-cases/trustless-agent","permalink":"/build/use-cases/trustless-agent","draft":false,"unlisted":false,"editUrl":"https://github.com/oasisprotocol/docs/edit/main/docs/build/use-cases/trustless-agent.mdx","tags":[{"inline":true,"label":"ROFL","permalink":"/tags/rofl"},{"inline":true,"label":"AI","permalink":"/tags/ai"},{"inline":true,"label":"appd","permalink":"/tags/appd"},{"inline":true,"label":"secrets","permalink":"/tags/secrets"}],"version":"current","lastUpdatedAt":1769514538000,"frontMatter":{"description":"Deploy a trustless Eliza AI agent on Oasis using ROFL enclaves, with enclave-managed keys and on-chain verification on Sapphire.","tags":["ROFL","AI","appd","secrets"],"sidebar_custom_props":{"tags":["ROFL","AI","appd","secrets"]}},"sidebar":"developers","previous":{"title":"Cross-Chain Key Generation","permalink":"/build/use-cases/key-generation"},"next":{"title":"Trustless Price Oracle","permalink":"/build/use-cases/price-oracle"}}');var t=s(74848),a=s(28453);const r={description:"Deploy a trustless Eliza AI agent on Oasis using ROFL enclaves, with enclave-managed keys and on-chain verification on Sapphire.",tags:["ROFL","AI","appd","secrets"],sidebar_custom_props:{tags:["ROFL","AI","appd","secrets"]}},l="Trustless AI Agent",o={},c=[{value:"What You\u2019ll Build",id:"what-youll-build",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Create an Eliza Agent",id:"create-an-eliza-agent",level:2},{value:"Containerize the App and the ERC-8004 wrapper",id:"containerize-the-app-and-the-erc-8004-wrapper",level:2},{value:"Init ROFL and Create App",id:"init-rofl-and-create-app",level:2},{value:"Build ROFL bundle",id:"build-rofl-bundle",level:2},{value:"Secrets",id:"secrets",level:2},{value:"Deploy",id:"deploy",level:2},{value:"Trying it out",id:"trying-it-out",level:2},{value:"ERC-8004 Registration and Validation",id:"erc-8004-registration-and-validation",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"trustless-ai-agent",children:"Trustless AI Agent"})}),"\n",(0,t.jsx)(n.p,{children:"Learn how to deploy a trustless Eliza agent on Oasis using ROFL enclaves."}),"\n",(0,t.jsx)(n.h2,{id:"what-youll-build",children:"What You\u2019ll Build"}),"\n",(0,t.jsxs)(n.p,{children:["By the end you will have a working Eliza agent running inside a ROFL Trusted\nExecution Environment (TEE), registered and validated as a trustless agent in\nthe ",(0,t.jsx)(n.a,{href:"https://eips.ethereum.org/EIPS/eip-8004",children:"ERC-8004"})," registry. The agent's code can be fully audited and proved that\nthe deployed instance really originates from it and cannot be silently altered."]}),"\n",(0,t.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsx)(n.p,{children:"You will need:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Docker"})," (or Podman) with credentials on docker.io, ghcr.io or other\npublic OCI registry"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Oasis CLI"})," and at least ",(0,t.jsx)(n.strong,{children:"120 TEST"})," tokens in your wallet\n(use ",(0,t.jsx)(n.a,{href:"https://faucet.testnet.oasis.io",children:"Oasis Testnet faucet"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Node.js 22+"})," (for Eliza and helper scripts)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"OpenAI"})," API key"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"RPC URL"})," for accessing the ERC-8004 registry (e.g. Infura)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Pinata JWT"})," for storing agent information to IPFS"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Check ",(0,t.jsx)(n.a,{href:"../rofl/quickstart#prerequisites",children:"Quickstart Prerequisites"})," for setup details."]}),"\n",(0,t.jsx)(n.h2,{id:"create-an-eliza-agent",children:"Create an Eliza Agent"}),"\n",(0,t.jsx)(n.p,{children:"Initialize a project using the ElizaOS CLI and prepare it for ROFL."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"# Install bun and ElizaOS CLI\nbun --version || curl -fsSL https://bun.sh/install | bash\nbun install -g @elizaos/cli\n\n# Create and configure the agent\nelizaos create -t project rofl-eliza\n# 1) Select Pqlite database\n# 2) Select the OpenAI model and enter your OpenAI key\n\n# Test the agent locally\ncd rofl-eliza\nelizaos start\n# Visiting http://localhost:3000 with your browser should open Eliza UI\n"})}),"\n",(0,t.jsx)(n.h2,{id:"containerize-the-app-and-the-erc-8004-wrapper",children:"Containerize the App and the ERC-8004 wrapper"}),"\n",(0,t.jsxs)(n.p,{children:["The Eliza agent startup wizard already generated ",(0,t.jsx)(n.code,{children:"Dockerfile"})," that packs your\nagent into a container and ",(0,t.jsx)(n.code,{children:"docker-compose.yaml"})," that orchestrates the\n",(0,t.jsx)(n.code,{children:"postgres"})," and ",(0,t.jsx)(n.code,{children:"elizaos"})," containers. Edit ",(0,t.jsx)(n.code,{children:"docker-compose.yaml"})," with the\nfollowing changes:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["In the PostgreSQL section replace relative ",(0,t.jsx)(n.code,{children:"image: ankane/pgvector:latest"}),"\nwith ",(0,t.jsx)(n.code,{children:"image: docker.io/ankane/pgvector:latest"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Name our ",(0,t.jsx)(n.code,{children:"elizaos"})," image with a corresponding absolute path, e.g.\n",(0,t.jsx)(n.code,{children:"image: docker.io/YOUR_USERNAME/elizaos:latest"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Make our Eliza agent registered as a trustless agent in the ERC-8004\nregistry. Paste the following ",(0,t.jsx)(n.a,{href:"https://github.com/oasisprotocol/erc-8004",children:(0,t.jsx)(n.code,{children:"rofl-8004"})})," snippet that will register it\nfor us (keep the environment variables mapping!):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="docker-compose.yaml"',children:"  rofl-8004:\n    image: ghcr.io/oasisprotocol/rofl-8004@sha256:f57373103814a0ca4c0a03608284451221b026e695b0b8ce9ca3d4153819a349\n    platform: linux/amd64\n    environment:\n      - RPC_URL=${RPC_URL}\n      - PINATA_JWT=${PINATA_JWT}\n    volumes:\n      - /run/rofl-appd.sock:/run/rofl-appd.sock\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Build and push:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"docker compose build\ndocker compose push\n"})}),"\n",(0,t.jsxs)(n.p,{children:["For full verifiability pin the digest by appending ",(0,t.jsx)(n.code,{children:"image: ...@sha256:..."})," in\n",(0,t.jsx)(n.code,{children:"docker-compose.yaml"})," to all images."]}),"\n",(0,t.jsx)(n.h2,{id:"init-rofl-and-create-app",children:"Init ROFL and Create App"}),"\n",(0,t.jsx)(n.p,{children:"The agent will run in a container inside a TEE. ROFL will handle the startup\nattestation of the container and the secrets in form of environment variables.\nThis way TEE will be completely transparent to the Eliza agent app."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"oasis rofl init\noasis rofl create --network testnet\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Inspect on-chain activity and app details in the ",(0,t.jsx)(n.a,{href:"https://explorer.oasis.io/testnet/sapphire",children:"Oasis Explorer"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"build-rofl-bundle",children:"Build ROFL bundle"}),"\n",(0,t.jsxs)(n.p,{children:["Eliza requires at least 2 GiB of memory and 10 GB of storage. First, update the\n",(0,t.jsx)(n.code,{children:"resources"})," section in ",(0,t.jsx)(n.code,{children:"rofl.yaml"})," accordingly:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="rofl.yaml"',children:"resources:\n  memory: 2048\n  cpus: 1\n  storage:\n    kind: disk-persistent\n    size: 10000\n"})}),"\n",(0,t.jsx)(n.p,{children:"Then, build the ROFL bundle by invoking:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"oasis rofl build\n"})}),"\n",(0,t.jsx)(n.h2,{id:"secrets",children:"Secrets"}),"\n",(0,t.jsxs)(n.p,{children:["Let's end-to-end encrypt ",(0,t.jsx)(n.code,{children:"OPENAI_API_KEY"})," and store it on-chain. Also, provide\nthe ",(0,t.jsx)(n.code,{children:"RPC_URL"})," and ",(0,t.jsx)(n.code,{children:"PINATA_JWT"})," values for ERC-8004 registration."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'echo -n "<your-openai-key-here>" | oasis rofl secret set OPENAI_API_KEY -\necho -n "https://sepolia.infura.io/v3/<YOUR_KEY>" | oasis rofl secret set RPC_URL -\necho -n "<your-pinata-key-here>" | oasis rofl secret set PINATA_JWT -\n'})}),"\n",(0,t.jsx)(n.p,{children:"Then store the secrets and previously built enclave identities on-chain:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"oasis rofl update\n"})}),"\n",(0,t.jsx)(n.h2,{id:"deploy",children:"Deploy"}),"\n",(0,t.jsx)(n.p,{children:"Deploy your Eliza agent to a ROFL provider by invoking:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"oasis rofl deploy\n"})}),"\n",(0,t.jsxs)(n.p,{children:["By default, the Oasis-maintained provider is selected on Testnet that lends\nyou a node for 1 hour. You can extend the rental, for example by 4 hours by\ninvoking ",(0,t.jsx)(n.code,{children:"oasis rofl machine top-up --term hour --term-count 4"}),"\n",(0,t.jsx)(n.a,{href:"/build/tools/cli/rofl#deploy",children:"command"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"trying-it-out",children:"Trying it out"}),"\n",(0,t.jsx)(n.p,{children:"After deploying the agent, use the CLI to check, if the agent is running:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"# Show machine details (state, proxy URLs, expiration).\noasis rofl machine show\n"})}),"\n",(0,t.jsxs)(n.p,{children:["If the agent successfully booted up, the ",(0,t.jsx)(n.code,{children:"Proxy:"})," section contains the\nURL where your agent is accessible on, for example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Proxy:\n  Domain: m1058.opf-testnet-rofl-25.rofl.app\n  Ports from compose file:\n    3000 (elizaos): https://p3000.m1058.opf-testnet-rofl-25.rofl.app\n"})}),"\n",(0,t.jsxs)(n.p,{children:["In the example above, our app is accessible at\n",(0,t.jsx)(n.a,{href:"https://p3000.m1058.opf-testnet-rofl-25.rofl.app",children:"https://p3000.m1058.opf-testnet-rofl-25.rofl.app"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"erc-8004-registration-and-validation",children:"ERC-8004 Registration and Validation"}),"\n",(0,t.jsxs)(n.p,{children:["When spinning up the agent for the first time, the ",(0,t.jsx)(n.code,{children:"rofl-8004"})," service will\nderive the ethereum address for registering the agent. You will need to\nfund that account with a small amount of ether to pay for the fees."]}),"\n",(0,t.jsx)(n.p,{children:"Fetch your app logs:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"oasis rofl machine logs\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Then look for ",(0,t.jsx)(n.code,{children:"Please top it up"})," line which contains the derived address.\nAfter funding it, your agent will automatically be registered and validated."]}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsxs)(n.p,{children:["Logs are accessible to the app admin and are stored ",(0,t.jsx)(n.strong,{children:"unencrypted on the ROFL\nnode"}),". Avoid printing secrets!"]})}),"\n",(0,t.jsx)(n.admonition,{title:"Trustless Agent Demo",type:"example",children:(0,t.jsxs)(n.p,{children:["You can fetch a complete example shown in this chapter from\n",(0,t.jsx)(n.a,{href:"https://github.com/oasisprotocol/demo-trustless-agent",children:"https://github.com/oasisprotocol/demo-trustless-agent"}),"."]})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);