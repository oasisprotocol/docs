"use strict";(globalThis.webpackChunkdocs_oasis_io=globalThis.webpackChunkdocs_oasis_io||[]).push([[7409],{28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var i=s(96540);const r={},t=i.createContext(r);function o(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(t.Provider,{value:n},e.children)}},77234:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"node/reference/upgrade-logs/testnet","title":"Testnet Upgrade Log","description":"For each upgrade of the Testnet network, we are tracking important changes for","source":"@site/docs/node/reference/upgrade-logs/testnet.md","sourceDirName":"node/reference/upgrade-logs","slug":"/node/reference/upgrade-logs/testnet","permalink":"/node/reference/upgrade-logs/testnet","draft":false,"unlisted":false,"editUrl":"https://github.com/oasisprotocol/docs/edit/main/docs/node/reference/upgrade-logs/testnet.md","tags":[],"version":"current","lastUpdatedAt":1761867754000,"frontMatter":{"sidebar_custom_props":{}},"sidebar":"operators","previous":{"title":"Mainnet","permalink":"/node/reference/upgrade-logs/mainnet"}}');var r=s(74848),t=s(28453);const o={sidebar_custom_props:{tags:void 0}},a="Testnet Upgrade Log",d={},l=[{value:"2023-10-12 Upgrade",id:"2023-10-12-upgrade",level:2},{value:"Instructions",id:"instructions",level:3},{value:"Configuration Changes",id:"configuration-changes",level:3},{value:"Data Directory Changes",id:"data-directory-changes",level:3},{value:"State Changes",id:"state-changes",level:3},{value:"General",id:"general",level:4},{value:"Registry",id:"registry",level:4},{value:"Root Hash",id:"root-hash",level:4},{value:"Staking",id:"staking",level:4},{value:"Key Manager",id:"key-manager",level:4},{value:"Random Beacon",id:"random-beacon",level:4},{value:"Governance",id:"governance",level:4},{value:"Consensus",id:"consensus",level:4},{value:"Other",id:"other",level:4},{value:"2022-04-04 Upgrade",id:"2022-04-04-upgrade",level:2},{value:"Instructions",id:"instructions-1",level:3},{value:"Before Upgrade",id:"before-upgrade",level:3},{value:"2022-03-03 Upgrade",id:"2022-03-03-upgrade",level:2},{value:"Instructions",id:"instructions-2",level:3},{value:"Configuration Changes",id:"configuration-changes-1",level:3},{value:"State Changes",id:"state-changes-1",level:3},{value:"<strong>General</strong>",id:"general-1",level:3},{value:"<strong>Registry</strong>",id:"registry-1",level:3},{value:"<strong>Root Hash</strong>",id:"root-hash-1",level:3},{value:"<strong>Staking</strong>",id:"staking-1",level:3},{value:"<strong>Random Beacon</strong>",id:"random-beacon-1",level:3},{value:"<strong>Governance</strong>",id:"governance-1",level:3},{value:"<strong>Consensus</strong>",id:"consensus-1",level:3},{value:"2021-08-11 Upgrade",id:"2021-08-11-upgrade",level:2},{value:"Proposed Parameter Changes",id:"proposed-parameter-changes",level:3},{value:"Instructions - Before Upgrade System Preparation",id:"instructions---before-upgrade-system-preparation",level:3},{value:"2021-06-23 Upgrade",id:"2021-06-23-upgrade",level:2},{value:"Instructions",id:"instructions-3",level:3},{value:"Before upgrade",id:"before-upgrade-1",level:3},{value:"Extra storage requirements",id:"extra-storage-requirements",level:4},{value:"Extra memory requirements",id:"extra-memory-requirements",level:4},{value:"2021-04-13 Upgrade",id:"2021-04-13-upgrade",level:2},{value:"Instructions",id:"instructions-4",level:3},{value:"Before upgrade",id:"before-upgrade-2",level:3},{value:"2021-03-24 Upgrade",id:"2021-03-24-upgrade",level:2},{value:"Instructions",id:"instructions-5",level:3},{value:"Additional steps",id:"additional-steps",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"testnet-upgrade-log",children:"Testnet Upgrade Log"})}),"\n",(0,r.jsx)(n.p,{children:"For each upgrade of the Testnet network, we are tracking important changes for\nnode operators' deployments."}),"\n",(0,r.jsx)(n.p,{children:"They are enumerated and explained in this document."}),"\n",(0,r.jsx)(n.h2,{id:"2023-10-12-upgrade",children:"2023-10-12 Upgrade"}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"Note that some of the software releases mentioned below have not yet been\npublished. They are expected to become available as we get closer to the\nupgrade window."})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Upgrade height:"})," upgrade is scheduled to happen at epoch ",(0,r.jsx)(n.strong,{children:"29570"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"We expect the Testnet network to reach this epoch at around 2023-10-12 07:56\nUTC."})}),"\n",(0,r.jsx)(n.h3,{id:"instructions",children:"Instructions"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["(optional) Vote for the upgrade. On 2023-10-09, an upgrade proposal will be\nproposed which (if accepted) will schedule the upgrade on epoch ",(0,r.jsx)(n.strong,{children:"29570"}),".\nSee the ",(0,r.jsx)(n.a,{href:"/build/tools/cli/network#governance-cast-vote",children:"Governance documentation"})," for details on voting for proposals."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"The following steps should be performed only after the network has reached the\nupgrade epoch and has halted:"}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsxs)(n.li,{children:["Download the Testnet genesis file published in the\n",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/testnet-artifacts/releases/tag/2023-10-12",children:"Testnet 2023-10-12 release"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsxs)(n.p,{children:["Testnet state at epoch ",(0,r.jsx)(n.strong,{children:"29570"})," will be exported and migrated to a 23.0\ncompatible genesis file."]}),(0,r.jsx)(n.p,{children:"The new genesis file will be published on the above link soon after reaching the\nupgrade epoch."})]}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Verify the provided Testnet upgrade genesis file by comparing it to the\nlocal network state dump."}),"\n",(0,r.jsxs)(n.p,{children:["The state changes are described in the ",(0,r.jsx)(n.a,{href:"#state-changes",children:"State Changes"}),"\nsection below."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Replace the old genesis file with the new Testnet genesis file."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Ensure your node will remain stopped by disabling auto-starting via your\nprocess manager (e.g., ",(0,r.jsx)(n.a,{href:"https://systemd.io/",children:"systemd"})," or ",(0,r.jsx)(n.a,{href:"http://supervisord.org/",children:"Supervisor"}),")"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Back up the entire data directory of your node. Verify that the backup\nincludes the following folders:"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["for consensus: ",(0,r.jsx)(n.code,{children:"tendermint/abci-state"})," and ",(0,r.jsx)(n.code,{children:"tendermint/data"})]}),"\n",(0,r.jsxs)(n.li,{children:["for runtimes: ",(0,r.jsx)(n.code,{children:"runtimes/*/mkvs_storage.badger.db"})," and\n",(0,r.jsx)(n.code,{children:"runtimes/*/worker-local-storage.badger.db"})]}),"\n"]}),"\n",(0,r.jsxs)(n.ol,{start:"7",children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/node/run-your-node/maintenance/wiping-node-state#state-wipe-and-keep-node-identity",children:"Wipe state"}),". This must be performed ",(0,r.jsx)(n.em,{children:"before"})," replacing the Oasis Node\nbinary."]}),"\n"]}),"\n",(0,r.jsxs)(n.admonition,{type:"danger",children:[(0,r.jsx)(n.p,{children:"State of ParaTimes/runtimes is not affected by this upgrade and MUST NOT be\nwiped. Wiping state for confidential ParaTimes will prevent your compute or\nkey manager node from transitioning to the new network."}),(0,r.jsx)(n.p,{children:"Transitioning confidential ParaTimes to the new network requires local state\nthat is sealed to the CPU. This also means that bootstrapping a new node on a\nseparate CPU immediately after the network upgrade will not be possible until\nan updated ParaTime containing new trust roots is released and adopted."})]}),"\n",(0,r.jsxs)(n.ol,{start:"8",children:["\n",(0,r.jsxs)(n.li,{children:["Replace the old version of Oasis Node with version ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/releases/tag/v23.0",children:"23.0"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"The Oasis Core 23.0 binary in our published releases is built only for Ubuntu\n22.04 (GLIBC>=2.32). You'll have to build it yourself if you're using prior\nUbuntu versions (or other distributions using older system libraries)."})}),"\n",(0,r.jsxs)(n.ol,{start:"9",children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Perform any needed ",(0,r.jsx)(n.a,{href:"#configuration-changes",children:"configuration changes"})," described\nbelow."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["(only Rosetta Gateway operators) Replace old version of Oasis Rosetta\nGateway with version ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-rosetta-gateway/releases/tag/v2.6.0",children:"2.6.0"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Start your node and re-enable auto-starting via your process manager."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"configuration-changes",children:"Configuration Changes"}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["To see the full extent of the changes examine the ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/blob/v23.0/CHANGELOG.md",children:"Change Log"})," of the 23.0\nrelease."]})}),"\n",(0,r.jsxs)(n.p,{children:["The node configuration has been refactored so that everything is now configured\nvia a YAML configuration file and ",(0,r.jsx)(n.strong,{children:"configuring via command-line options is no\nlonger supported"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Some configuration options have changed and so the configuration file needs to\nbe updated. To make this step easier, a command-line tool has been provided that\nwill perform most of the changes automatically. You can run it with:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"oasis-node config migrate --in config.yml --out new-config.yml\n"})}),"\n",(0,r.jsx)(n.p,{children:"The migration subcommand logs the various changes it makes and warns you if a\nconfig option is no longer supported, etc. At the end, any unknown sections of\nthe input config file are printed to the terminal to give you a chance to review\nthem and make manual changes if required."}),"\n",(0,r.jsx)(n.p,{children:"Note that the migration subcommand does not preserve comments and order of\nsections from the input YAML config file. You should always carefully read the\noutput of this command, as well as compare the generated config file with the\noriginal before using it."}),"\n",(0,r.jsx)(n.p,{children:"After you are satisfied with the new configuration file, replace the old file\nwith the new one as follows:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"mv new-config.yml config.yml\n"})}),"\n",(0,r.jsxs)(n.admonition,{type:"tip",children:[(0,r.jsx)(n.p,{children:"The configuration format for seed nodes has changed and it now requires the\nnode's P2P public key to be used. In case your old configuration file contains\nknown Testnet seed nodes, this transformation is performed automatically."}),(0,r.jsx)(n.p,{children:"However, if it contains unknown seed nodes then the conversion did not happen\nautomatically and you may need to obtain the seed node's P2P public key. For\nTestnet you can use the following addresses:"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"HcDFrTp/MqRHtju5bCx6TIhIMd6X/0ZQ3lUG73q5898=@34.86.165.6:26656"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"HcDFrTp/MqRHtju5bCx6TIhIMd6X/0ZQ3lUG73q5898=@34.86.165.6:9200"})}),"\n"]}),(0,r.jsx)(n.p,{children:"Please be aware that every seed node should be configured to listen on two\ndistinct ports. One is dedicated to peer discovery within the CometBFT P2P\nnetwork, while the other is used to bootstrap the Oasis P2P network."})]}),"\n",(0,r.jsx)(n.h3,{id:"data-directory-changes",children:"Data Directory Changes"}),"\n",(0,r.jsxs)(n.p,{children:["The subdirectory (located inside the node's data directory) used to store\nconsensus-related data, previously called ",(0,r.jsx)(n.code,{children:"tendermint"})," (after the consensus\nlayer protocol backend) has been renamed to ",(0,r.jsx)(n.code,{children:"consensus"})," in Oasis Core 23.0. If\nany of your scripts rely on specific directory names, please make sure to update\nthem to reflect the changed directory name."]}),"\n",(0,r.jsx)(n.h3,{id:"state-changes",children:"State Changes"}),"\n",(0,r.jsx)(n.p,{children:"The following parts of the genesis document will be updated:"}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["For a more detailed explanation of the parameters below, see the\n",(0,r.jsx)(n.a,{href:"/node/reference/genesis-doc#parameters",children:"Genesis Document"})," docs."]})}),"\n",(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsxs)(n.p,{children:["All state changes will be done automatically with the migration command provided\nby the new version of ",(0,r.jsx)(n.code,{children:"oasis-node"}),". It can be used as follows to derive the same\ngenesis file from an existing state dump at the correct height (assuming there\nis a ",(0,r.jsx)(n.code,{children:"genesis.json"})," present in the current working directory):"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"oasis-node genesis migrate --genesis.new_chain_id testnet-2023-10-12\n"})})]}),"\n",(0,r.jsx)(n.h4,{id:"general",children:"General"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"chain_id"})})," will be set to ",(0,r.jsx)(n.code,{children:"testnet-2023-10-12"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"halt_epoch"})})," will be removed as it is no longer used."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"registry",children:"Registry"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"registry.runtimes[].txn_scheduler.propose_batch_timeout"})})," specifies how\nlong to wait before accepting proposal from the next backup scheduler. It will\nbe set to ",(0,r.jsx)(n.code,{children:"5000000000"})," (5 seconds). Previously the value was represented in\nthe number of consensus layer blocks."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"registry.params.gas_costs.prove_freshness"})})," specifies the cost of the\nfreshness proof transaction. It will be set to ",(0,r.jsx)(n.code,{children:"1000"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"registry.params.gas_costs.update_keymanager"})})," specifies the cost of the\nkeymanager policy update transaction. It will be removed as the parameter has\nbeen moved under ",(0,r.jsx)(n.code,{children:"keymanager.params.gas_costs.update_policy"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"registry.params.tee_features"})})," specify various TEE features supported by\nthe consensus layer registry service. These will be set to the following\nvalues to activate the new features:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'"tee_features": {\n  "sgx": {\n    "pcs": true,\n    "signed_attestations": true,\n    "max_attestation_age": 1200\n  },\n  "freshness_proofs": true\n}\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"registry.params.max_runtime_deployments"})})," specifies the maximum number of\nruntime deployments that can be specified in the runtime descriptor. It will\nbe set to ",(0,r.jsx)(n.code,{children:"5"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"root-hash",children:"Root Hash"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"roothash.params.max_past_roots_stored"})})," specifies the maximum number of\npast runtime state roots that are stored in consensus state for each runtime.\nIt will be set to ",(0,r.jsx)(n.code,{children:"1200"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"staking",children:"Staking"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"staking.params.commission_schedule_rules.min_commission_rate"})})," specifies\nthe minimum commission rate. It will be set to ",(0,r.jsx)(n.code,{children:"0"})," to maintain the existing\nbehavior."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"staking.params.thresholds.node-observer"})})," specifies the stake threshold\nfor registering an observer node. It will be set to ",(0,r.jsx)(n.code,{children:"100000000000"})," base units\n(or ",(0,r.jsx)(n.code,{children:"100"})," tokens), same as for existing compute nodes."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"key-manager",children:"Key Manager"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"keymanager.params.gas_costs"})})," specify the cost of key manager\ntransactions. These will be set to the following values:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'"gas_costs": {\n  "publish_ephemeral_secret": 1000,\n  "publish_master_secret": 1000,\n  "update_policy": 1000\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"random-beacon",children:"Random Beacon"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"beacon.base"})})," is the network's starting epoch. It will be set to the epoch\nof Testnet's state dump + 1, ",(0,r.jsx)(n.code,{children:"29570"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"governance",children:"Governance"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"governance.params.enable_change_parameters_proposal"})})," specifies whether\nparameter change governance proposals are allowed. It will be set to ",(0,r.jsx)(n.code,{children:"true"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"consensus",children:"Consensus"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"consensus.params.max_block_size"})})," specifies the maximum block size in the\nconsensus layer. It will be set to ",(0,r.jsx)(n.code,{children:"1048576"})," (1 MiB)."]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"other",children:"Other"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"extra_data"})})," will be set back to the value in the ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/mainnet-artifacts/releases/tag/2020-11-18",children:"Mainnet genesis file"}),"\nto include the Oasis Network's genesis quote:"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.em,{children:"\u201d"}),(0,r.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Quis_custodiet_ipsos_custodes%3F",children:(0,r.jsx)(n.em,{children:"Quis custodiet ipsos custodes?"})}),(0,r.jsx)(n.em,{children:"\u201d [submitted by Oasis\nCommunity Member Daniyar Borangaziyev]:"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'"extra_data": {\n  "quote": "UXVpcyBjdXN0b2RpZXQgaXBzb3MgY3VzdG9kZXM/IFtzdWJtaXR0ZWQgYnkgT2FzaXMgQ29tbXVuaXR5IE1lbWJlciBEYW5peWFyIEJvcmFuZ2F6aXlldl0="\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"2022-04-04-upgrade",children:"2022-04-04 Upgrade"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Upgrade height:"})," upgrade is scheduled to happen at epoch ",(0,r.jsx)(n.strong,{children:"15056"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"We expect the Testnet network to reach this epoch at around 2022-04-04 7:45 UTC."})}),"\n",(0,r.jsx)(n.h3,{id:"instructions-1",children:"Instructions"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["See ",(0,r.jsx)(n.a,{href:"/node/reference/upgrade-logs/testnet#before-upgrade",children:"Before upgrade"})," section for required steps\nto be done before upgrade."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["(optional) Vote for the upgrade. On 2022-04-01, an upgrade proposal will be\nproposed which (if accepted) will schedule the upgrade on epoch ",(0,r.jsx)(n.strong,{children:"15056"}),".\nSee the ",(0,r.jsx)(n.a,{href:"/build/tools/cli/network#governance-cast-vote",children:"Governance documentation"}),"\nfor details on voting for proposals."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["The upgrade proposal contains the ",(0,r.jsx)(n.code,{children:'"empty"'})," upgrade handler whose only purpose\nis allow specifying a no-op handler when submitting an upgrade proposal."]})}),"\n",(0,r.jsx)(n.admonition,{title:"This is not dump & restore upgrade",type:"caution",children:(0,r.jsxs)(n.p,{children:["For this upgrade, ",(0,r.jsx)(n.strong,{children:"do NOT wipe state"}),". The new Oasis Core version expects\nthe synced state using Oasis Core 22.0.x all the way until the upgrade epoch.\nRead ",(0,r.jsx)(n.a,{href:"/node/run-your-node/maintenance/handling-network-upgrades",children:"Handling Network Upgrades"})," for more info."]})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Once reaching the designated upgrade epoch, your node will stop and needs to\nbe upgraded to Oasis Core ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/releases/tag/v22.1",children:"22.1"}),".\nAfter your node is upgraded to Oasis Core 22.1, restart it and wait for more\nthan 2/3+ of nodes by stake to do the same and the network starts again."]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"The Testnet's genesis file and the genesis document's hash will remain the same."})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["If the nodes are running any ParaTimes, make sure you upgrade to the versions\npublished on the ",(0,r.jsx)(n.a,{href:"/node/network/testnet",children:"Testnet network parameters page"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsxs)(n.p,{children:["ParaTime binaries for the Cipher ParaTime will be published at a later time due\nto the additional offline signing step. If you are running ",(0,r.jsx)(n.em,{children:"multiple"})," ParaTimes\non the same node, you should ",(0,r.jsx)(n.em,{children:"disable"})," the Cipher ParaTime until the new version\nis published."]})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["If you are running a Rosetta gateway, upgrade it to version ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-rosetta-gateway/releases/tag/v2.2.0",children:"2.2.0"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"before-upgrade",children:"Before Upgrade"}),"\n",(0,r.jsxs)(n.p,{children:["This upgrade will upgrade ",(0,r.jsx)(n.strong,{children:"Oasis Core"})," to ",(0,r.jsxs)(n.strong,{children:["version ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/releases/tag/v22.1",children:"22.1"})]})," which ",(0,r.jsx)(n.strong,{children:"no longer\nallows running Oasis Node"})," (i.e. the ",(0,r.jsx)(n.code,{children:"oasis-node"})," binary) ",(0,r.jsx)(n.strong,{children:"as root"}),"\n(effective user ID of 0)."]}),"\n",(0,r.jsxs)(n.p,{children:['Running network accessible services as the root user is extremely bad for\nsystem security as a general rule. While it would be "ok" if we could drop\nprivileges, ',(0,r.jsx)(n.code,{children:"syscall.AllThreadsSyscall"})," does not work if the binary uses ",(0,r.jsx)(n.code,{children:"cgo"}),"\nat all."]}),"\n",(0,r.jsxs)(n.p,{children:["Nothing in Oasis Node will ever require elevated privileges.\nAttempting to run the ",(0,r.jsx)(n.code,{children:"oasis-node"})," process as the root user will now terminate\nimmediately on startup."]}),"\n",(0,r.jsx)(n.p,{children:"While there may be specific circumstances where it is safe to run network\nservices with the effective user ID set to 0, the overwhelming majority of cases\nwhere this is done is a misconfiguration."}),"\n",(0,r.jsxs)(n.p,{children:["If the previous behavior is required, the binary must be run in unsafe/debug\nmode (via the intentionally undocumented flag), and ",(0,r.jsx)(n.code,{children:"debug.allow_root"})," must also\nbe set."]}),"\n",(0,r.jsx)(n.h2,{id:"2022-03-03-upgrade",children:"2022-03-03 Upgrade"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Upgrade height:"})," upgrade is scheduled to happen at epoch ",(0,r.jsx)(n.strong,{children:"14209."})]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"We expect the Testnet network to reach this epoch at around 2022-03-03 12:45 UTC."})}),"\n",(0,r.jsx)(n.h3,{id:"instructions-2",children:"Instructions"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["(optional) Vote for the upgrade. On 2022-03-02, an upgrade proposal will be proposed which (if accepted) will schedule the upgrade on epoch ",(0,r.jsx)(n.strong,{children:"14209."})," See the ",(0,r.jsx)(n.a,{href:"/build/tools/cli/network#governance-cast-vote",children:"Governance documentation"})," for details on voting for proposals."]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsx)(n.p,{children:"The upgrade proposal contains a non-existing upgrade handler and will be used to\ncoordinate the network shutdown, the rest of the upgrade is manual."})}),"\n",(0,r.jsx)(n.p,{children:"The following steps should be performed only after the network has reached the\nupgrade network and has halted:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Download the Testnet genesis file published in the ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/testnet-artifacts/releases/tag/2022-03-03",children:"Testnet 2022-03-03 release"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["Testnet state at epoch ",(0,r.jsx)(n.strong,{children:"14209"})," will be exported and migrated to a 22.0\ncompatible genesis file. The new genesis file will be published on the above\nlink soon after reaching the upgrade epoch."]})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Replace the old genesis file with the new Testnet genesis file.\nThe ",(0,r.jsx)(n.a,{href:"#state-changes",children:"state changes"})," are described and explained below."]}),"\n",(0,r.jsxs)(n.li,{children:["Replace the old version of Oasis Node with version ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/releases/tag/v22.0",children:"22.0"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/node/run-your-node/maintenance/wiping-node-state#state-wipe-and-keep-node-identity",children:"Wipe state"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Perform any needed ",(0,r.jsx)(n.a,{href:"#configuration-changes",children:"configuration changes"})," described below."]}),"\n",(0,r.jsx)(n.li,{children:"Start your node."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"configuration-changes-1",children:"Configuration Changes"}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["To see the full extent of the changes examine the ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/blob/v22.0/CHANGELOG.md#220-2022-03-01",children:"Change Log"})," of the 22.0 release."]})}),"\n",(0,r.jsx)(n.p,{children:"If your node is currently configured to run a ParaTime, you need to perform some\nadditional steps."}),"\n",(0,r.jsxs)(n.p,{children:["The way ParaTime binaries are distributed has changed so that all required\nartifacts are contained in a single archive called the Oasis Runtime Container\nand have the ",(0,r.jsx)(n.code,{children:".orc"})," extension. Links to updated ParaTime binaries will be\npublished on the ",(0,r.jsx)(n.a,{href:"/node/network/testnet",children:"Testnet network parameters page"})," for their respective\nParaTimes."]}),"\n",(0,r.jsxs)(n.p,{children:["The configuration is simplified as the ",(0,r.jsx)(n.code,{children:"runtime.paths"})," now only needs to list\nall of the supported ",(0,r.jsx)(n.code,{children:".orc"})," files (see below for an example)."]}),"\n",(0,r.jsxs)(n.p,{children:["Instead of separately configuring various roles for a node, there is now a\nsingle configuration flag called ",(0,r.jsx)(n.code,{children:"runtime.mode"})," which enables the correct roles\nas needed. It should be set to one of the following values:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"none"})," (runtime support is disabled, only consensus layer is enabled)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"compute"})," (node is participating as a runtime compute node for all the\nconfigured runtimes)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"keymanager"})," (node is participating as a keymanager node)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"client"})," (node is a stateful runtime client)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"client-stateless"})," (node is a stateless runtime client and connects to\nremote nodes for any state queries)"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Nodes that have so far been participating as compute nodes should set the mode\nto ",(0,r.jsx)(n.code,{children:"compute"})," and nodes that have been participating as clients for querying\nand transaction submission should set it to ",(0,r.jsx)(n.code,{children:"client"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"The following configuration flags have been removed:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"runtime.supported"})," (existing ",(0,r.jsx)(n.code,{children:"runtime.paths"})," is used instead)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"worker.p2p.enabled"})," (now automatically set based on runtime mode)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"worker.compute.enabled"})," (now set based on runtime mode)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"worker.keymanager.enabled"})," (now set based on runtime mode)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"worker.storage.enabled"})," (no longer needed)"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Also the ",(0,r.jsx)(n.code,{children:"worker.client"})," option is no longer needed unless you are providing\nconsensus layer RPC services."]}),"\n",(0,r.jsxs)(n.p,{children:["For example if your ",(0,r.jsx)(n.em,{children:"previous"})," configuration looked like:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'runtime:\n  supported:\n    - "000000000000000000000000000000000000000000000000000000000000beef"\n\n  paths:\n    "000000000000000000000000000000000000000000000000000000000000beef": /path/to/runtime\n\nworker:\n  # ... other settings omitted ...\n\n  storage:\n    enabled: true\n\n  compute:\n    enabled: true\n\n  client:\n    port: 12345\n    addresses:\n      - "xx.yy.zz.vv:12345"\n\n  p2p:\n    enabled: true\n    port: 12346\n    addresses:\n      - "xx.yy.zz.vv:12346"\n'})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.em,{children:"new"})," configuration should look like:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'runtime:\n  mode: compute\n  paths:\n    - /path/to/runtime.orc\n\nworker:\n  # ... other settings omitted ...\n\n  p2p:\n    port: 12346\n    addresses:\n      - "xx.yy.zz.vv:12346"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"state-changes-1",children:"State Changes"}),"\n",(0,r.jsx)(n.p,{children:"The following parts of the genesis document will be updated:"}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["For a more detailed explanation of the parameters below, see the ",(0,r.jsx)(n.a,{href:"/node/reference/genesis-doc#parameters",children:"Genesis Document"})," docs."]})}),"\n",(0,r.jsx)(n.h3,{id:"general-1",children:(0,r.jsx)(n.strong,{children:"General"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"height"})})," will be set to the height of the Testnet state dump + 1, i.e. ",(0,r.jsx)(n.code,{children:"8535081"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"genesis_time"})})," will be set to ",(0,r.jsx)(n.code,{children:"2022-03-03T13:00:00Z"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"chain_id"})})," will be set to ",(0,r.jsx)(n.code,{children:"testnet-2022-03-03"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"halt_epoch"})})," will be set to ",(0,r.jsx)(n.code,{children:"24210"})," (more than 1 year from the upgrade)."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"registry-1",children:(0,r.jsx)(n.strong,{children:"Registry"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"registry.runtimes"})})," list contains the registered runtimes' descriptors. In\nthis upgrade, all runtime descriptors will be migrated from version ",(0,r.jsx)(n.code,{children:"2"})," to\nversion ",(0,r.jsx)(n.code,{children:"3"}),".\nThe migration will be done automatically with the ",(0,r.jsx)(n.code,{children:"oasis-node debug fix-genesis"}),"\ncommand."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"registry.suspended_runtimes"})})," list contains the suspended registered\nruntimes' descriptors. In this upgrade, all runtime descriptors will be\nmigrated from version ",(0,r.jsx)(n.code,{children:"2"})," to version ",(0,r.jsx)(n.code,{children:"3"}),".\nThe migration will be done automatically with the ",(0,r.jsx)(n.code,{children:"oasis-node debug fix-genesis"}),"\ncommand."]}),"\n",(0,r.jsxs)(n.li,{children:["Inactive registered entities in ",(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"registry.entities"})})," (and their\ncorresponding nodes in ",(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"registry.nodes"})}),") that don't pass the\n",(0,r.jsx)(n.a,{href:"/node/reference/genesis-doc#staking-thresholds",children:"minimum staking thresholds"})," will be removed.\nThe removal will be done automatically with the ",(0,r.jsx)(n.code,{children:"oasis-node debug fix-genesis"}),"\ncommand."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"root-hash-1",children:(0,r.jsx)(n.strong,{children:"Root Hash"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"roothash.params.gas_costs.submit_msg"})})," is a new parameter that specifies\nthe cost for an submit message transaction. It will be set to ",(0,r.jsx)(n.code,{children:"1000"}),".\nThis will be done automatically with the ",(0,r.jsx)(n.code,{children:"oasis-node debug fix-genesis"})," command."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"roothash.params.max_in_runtime_messages"})})," is a new parameter that\nspecifies the maximum number of incoming messages that can be queued for\nprocessing by a runtime. It will be set to ",(0,r.jsx)(n.code,{children:"128"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["This will be done automatically with the ",(0,r.jsx)(n.code,{children:"oasis-node debug fix-genesis"})," command."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"roothash.runtime_state"})})," contains the state roots of the runtimes.\nEmpty fields will be omitted.\nThis will be done automatically with the ",(0,r.jsx)(n.code,{children:"oasis-node debug fix-genesis"})," command."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"staking-1",children:(0,r.jsx)(n.strong,{children:"Staking"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"staking.params.thresholds"})})," specifies the minimum number of tokens that\nneed to be staked in order for a particular entity or a particular type of node\nto participate in the network.\nThe ",(0,r.jsx)(n.code,{children:"node-storage"})," key is removed since Oasis Core 22.0+ removes separate\nstorage nodes (for more details, see: ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/pull/4308",children:"#4308"}),").\nThis will be done automatically with the ",(0,r.jsx)(n.code,{children:"oasis-node debug fix-genesis"})," command."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"staking.params.min_transfer"})})," specifies the minimum number of tokens one\ncan transfer.\nThe value is set to 10,000,000 base units, or 0.01 TEST tokens.\nThis will be done automatically with the ",(0,r.jsx)(n.code,{children:"oasis-node debug fix-genesis"})," command."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"staking.params.min_transact_balance"})})," specifies the minimum general balance\nan account must have to be able to perform transactions on the network.\nThe value is set to 0 base units meaning this requirement is currently not\nenforced.\nThis will be done automatically with the ",(0,r.jsx)(n.code,{children:"oasis-node debug fix-genesis"})," command."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"staking.params.reward_schedule"})})," specifies the staking reward schedule\nas an array with elements of the form:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'{\n  "until": 14226,\n  "scale": "1229"\n}\n'})}),"\n","For example, this element specifies that the staking reward is 0.001229% per\nepoch until epoch ",(0,r.jsx)(n.code,{children:"14226"}),".\nIt will be set to the same schedule that is currently on used on the Mainnet."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"random-beacon-1",children:(0,r.jsx)(n.strong,{children:"Random Beacon"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"beacon"})})," object contains parameters controlling the new\n",(0,r.jsx)(n.a,{href:"../../../adrs/0010-vrf-elections",children:"improved VRF-based random beacon"})," introduced in the Damask upgrade."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"beacon.base"})})," is the network's starting epoch. It will be set to the\n",(0,r.jsx)(n.code,{children:"14209"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"beacon.params.backend"})})," configures the random beacon backend to use. It\nwill be set to ",(0,r.jsx)(n.code,{children:'"vrf"'})," indicating that the beacon implementing a\n",(0,r.jsx)(n.a,{href:"../../../adrs/0010-vrf-elections",children:"VRF-based random beacon"})," should be used."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"beacon.params.vrf_parameters.alpha_hq_threshold"})})," is minimal number of\nnodes that need to contribute a VRF proof for the beacon's output to be valid.\nIt will be set to ",(0,r.jsx)(n.code,{children:"3"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["This will be done automatically with the ",(0,r.jsx)(n.code,{children:"oasis-node debug fix-genesis"}),"\ncommand."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"beacon.params.vrf_parameters.interval"})})," is the duration of an epoch.\nIt will be set to ",(0,r.jsx)(n.code,{children:"600"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["This will be done automatically with the ",(0,r.jsx)(n.code,{children:"oasis-node debug fix-genesis"}),"\ncommand."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"beacon.params.vrf_parameters.proof_delay"})})," is number of blocks since the\nbeginning of an epoch after a node can still submit its VRF proof.\nIt will be set to ",(0,r.jsx)(n.code,{children:"300"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["This will be done automatically with the ",(0,r.jsx)(n.code,{children:"oasis-node debug fix-genesis"}),"\ncommand."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"beacon.params.vrf_parameters.gas_costs.vrf_prove"})})," specifies the cost for\na VRF prove transaction.\nIt will be set to ",(0,r.jsx)(n.code,{children:"1000"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["This will be done automatically with the ",(0,r.jsx)(n.code,{children:"oasis-node debug fix-genesis"}),"\ncommand."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"beacon.params.pvss_parameters"})})," control the behavior of the\n",(0,r.jsx)(n.a,{href:"/adrs/0007-improved-random-beacon",children:"previous random beacon implementing a PVSS scheme"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Since PVSS is no longer supported, all its configuration options are removed\nas well."}),"\n",(0,r.jsx)(n.h3,{id:"governance-1",children:(0,r.jsx)(n.strong,{children:"Governance"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"governance.params.stake_threshold"})})," is a new parameter specifying the\nsingle unified stake threshold representing the percentage of ",(0,r.jsx)(n.code,{children:"VoteYes"})," votes\nin terms of total voting power for a governance proposal to pass.\nIt will be set to ",(0,r.jsx)(n.code,{children:"68"})," (i.e. 68%)."]}),"\n",(0,r.jsxs)(n.p,{children:["This will be done automatically with the ",(0,r.jsx)(n.code,{children:"oasis-node debug fix-genesis"}),"\ncommand."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"governance.params.quorum"})})," is the minimum percentage of voting power that\nneeds to be cast on a proposal for the result to be valid."]}),"\n",(0,r.jsxs)(n.p,{children:["It will be removed since it is being replaced by the single\n",(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"governance.params.staking_threshold"})})," parameter."]}),"\n",(0,r.jsxs)(n.p,{children:["This will be done automatically with the ",(0,r.jsx)(n.code,{children:"oasis-node debug fix-genesis"}),"\ncommand."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"governance.params.threshold"})})," is the minimum percentage of ",(0,r.jsx)(n.code,{children:"VoteYes"})," votes\nin order for a proposal to be accepted."]}),"\n",(0,r.jsxs)(n.p,{children:["It will be removed since it is being replaced by the single\n",(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"governance.params.staking_threshold"})})," parameter."]}),"\n",(0,r.jsxs)(n.p,{children:["This will be done automatically with the ",(0,r.jsx)(n.code,{children:"oasis-node debug fix-genesis"}),"\ncommand."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"consensus-1",children:(0,r.jsx)(n.strong,{children:"Consensus"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"consensus.params.state_checkpoint_interval"})})," parameter controls the\ninterval (in blocks) on which state checkpoints should be taken. It will be\nincreased from ",(0,r.jsx)(n.code,{children:"10000"})," to ",(0,r.jsx)(n.code,{children:"100000"})," to improve nodes' performance since\ncomputing checkpoints is I/O intensive."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"2021-08-11-upgrade",children:"2021-08-11 Upgrade"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Upgrade height:"})," upgrade is scheduled to happen at epoch ",(0,r.jsx)(n.strong,{children:"8844."})]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"We expect the Testnet network to reach this epoch at around 2021-08-11 08:50 UTC."})}),"\n",(0,r.jsx)(n.h3,{id:"proposed-parameter-changes",children:"Proposed Parameter Changes"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/releases/tag/v21.2.8",children:"Oasis Core 21.2.8"})," release contains the ",(0,r.jsxs)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/blob/v21.2.8/go/upgrade/migrations/consensus_parameters.go",children:[(0,r.jsx)(n.code,{children:"consensus-params-update-2021-08"})," upgrade handler"]})," which will update the following parameters in the consensus layer:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["**",(0,r.jsx)(n.code,{children:"staking.params.max_allowances"})," ** specifies the maximum number of allowances on account can store. It will be set to ",(0,r.jsx)(n.code,{children:"16"})," (default value is ",(0,r.jsx)(n.code,{children:"0"}),") to enable support for beneficiary allowances which are required to transfer tokens into a ParaTime. ",(0,r.jsx)(n.em,{children:"Note that this has already been the case on Testnet since the"})," ",(0,r.jsx)(n.a,{href:"/node/reference/upgrade-logs/testnet#2021-06-23-upgrade",children:(0,r.jsx)(n.em,{children:"2021-06-23 upgrade"})}),(0,r.jsx)(n.em,{children:"."})]}),"\n",(0,r.jsxs)(n.li,{children:["**",(0,r.jsx)(n.code,{children:"staking.params.gas_costs"})," ** , ",(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"governance.params.gas_costs"})})," and ",(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"roothash.params.gas_costs"})})," specify gas costs for various types of staking, governance and roothash transactions. Gas costs for transactions that were missing gas costs will be added."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"scheduler.params.max_validators"})})," is the maximum size of the consensus committee (i.e. the validator set). It will be increased to",(0,r.jsx)(n.code,{children:"110"})," (it was set to ",(0,r.jsx)(n.code,{children:"100"})," previously)."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"instructions---before-upgrade-system-preparation",children:"Instructions - Before Upgrade System Preparation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["This upgrade will upgrade ",(0,r.jsx)(n.strong,{children:"Oasis Core"})," to version ",(0,r.jsx)(n.strong,{children:"21.2.8"})," which:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Has a check that makes sure the ",(0,r.jsx)(n.strong,{children:"file descriptor limit"})," is set to an appropriately high value (at least 50000). While previous versions only warned in case the limit was set too low, this version will refuse to start. Follow the ",(0,r.jsx)(n.a,{href:"/node/run-your-node/prerequisites/system-configuration#increase-file-descriptor-limit",children:"File Descriptor Limit"})," documentation page for details on how to increase the limit on your system."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Stop your node, replace the old version of Oasis Node with version ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/releases/tag/v21.2.8",children:"21.2.8"})," and restart your node."]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsx)(n.p,{children:"Since Oasis Core 21.2.8 is otherwise compatible with the current consensus layer protocol, you may upgrade your Testnet node to this version at any time."})}),"\n",(0,r.jsx)(n.admonition,{title:"This is not dump & restore upgrade",type:"caution",children:(0,r.jsxs)(n.p,{children:["For this upgrade, ",(0,r.jsx)(n.strong,{children:"do NOT wipe state"}),"."]})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Once reaching the designated upgrade epoch, your node will stop and needs to be upgraded to Oasis Core ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/releases/tag/v21.2.8",children:"21.2.8"}),".","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"If you upgraded your node to Oasis Core 21.2.8 before the upgrade epoch was reached, you only need to restart your node for the upgrade to proceed."}),"\n",(0,r.jsx)(n.li,{children:"Otherwise, you need to upgrade your node to Oasis Core 21.2.8 first and then restart it."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["If you use a process manager like ",(0,r.jsx)(n.a,{href:"https://github.com/systemd/systemd",children:"systemd"})," or ",(0,r.jsx)(n.a,{href:"http://supervisord.org",children:"Supervisor"}),", you can configure it to restart the Oasis Node automatically."]})}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"The Testnet's genesis file and the genesis document's hash will remain the same."})}),"\n",(0,r.jsx)(n.h2,{id:"2021-06-23-upgrade",children:"2021-06-23 Upgrade"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Upgrade height:"})," upgrade is scheduled to happen at epoch ",(0,r.jsx)(n.strong,{children:"7553."})]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"We expect the Testnet network to reach this epoch at around 2021-06-23 14:30 UTC."})}),"\n",(0,r.jsx)(n.h3,{id:"instructions-3",children:"Instructions"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["See ",(0,r.jsx)(n.a,{href:"/node/reference/upgrade-logs/testnet#before-upgrade",children:"Before upgrade"})," section for required steps to be done before upgrade."]}),"\n",(0,r.jsxs)(n.li,{children:["(optional) Vote for the upgrade. On 2021-06-21, an upgrade proposal will be proposed which (if accepted) will schedule the upgrade on epoch ",(0,r.jsx)(n.strong,{children:"7553."})," See the ",(0,r.jsx)(n.a,{href:"/build/tools/cli/network#governance-cast-vote",children:"Governance documentation"})," for details on voting for proposals."]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["The upgrade proposal contains the ",(0,r.jsx)(n.code,{children:'"consensus-max-allowances-16"'})," upgrade handler whose only purpose is to set the**",(0,r.jsx)(n.code,{children:"staking.params.min_delegation"}),"** consensus parameter to 16 (default value is 0) to enable support for beneficiary allowances which are required to transfer tokens into a ParaTime."]})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Stop your node, replace the old version of Oasis Node with version ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/releases/tag/v21.2.4",children:"21.2.4"})," and restart your node."]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsx)(n.p,{children:"Since Oasis Core 21.2.4 is otherwise compatible with the current consensus layer protocol, you may upgrade your Testnet node to this version at any time."})}),"\n",(0,r.jsx)(n.admonition,{title:"This is not dump & restore upgrade",type:"caution",children:(0,r.jsxs)(n.p,{children:["For this upgrade, ",(0,r.jsx)(n.strong,{children:"do NOT wipe state"}),"."]})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Once reaching the designated upgrade epoch, your node will stop and needs to be upgraded to Oasis Core ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/releases/tag/v21.2.4",children:"21.2.4"}),".","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"If you upgraded your node to Oasis Core 21.2.4 before the upgrade epoch was reached, you only need to restart your node for the upgrade to proceed."}),"\n",(0,r.jsx)(n.li,{children:"Otherwise, you need to upgrade your node to Oasis Core 21.2.4 first and then restart it."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["If you use a process manager like ",(0,r.jsx)(n.a,{href:"https://github.com/systemd/systemd",children:"systemd"})," or ",(0,r.jsx)(n.a,{href:"http://supervisord.org",children:"Supervisor"}),", you can configure it to restart the Oasis Node automatically."]})}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"The Testnet's genesis file and the genesis document's hash will remain the same."})}),"\n",(0,r.jsx)(n.h3,{id:"before-upgrade-1",children:"Before upgrade"}),"\n",(0,r.jsxs)(n.p,{children:["This upgrade will upgrade Oasis Core to version ",(0,r.jsx)(n.strong,{children:"21.2.x"})," which includes the new ",(0,r.jsx)(n.a,{href:"https://github.com/dgraph-io/badger",children:(0,r.jsx)(n.strong,{children:"BadgerDB"})})," ",(0,r.jsx)(n.strong,{children:"v3"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Since BadgerDB's on-disk format changed in v3, it requires on-disk state migration. The migration process is done automatically and makes the following steps:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Upon startup, Oasis Node will start migrating all ",(0,r.jsx)(n.code,{children:"<DATA-DIR>/**/*.badger.db"})," files (Badger v2 files) and start writing Badger v3 DB to files with the ",(0,r.jsx)(n.code,{children:".migrate"})," suffix."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["If the migration fails in the middle, Oasis Node will delete all ",(0,r.jsx)(n.code,{children:"<DATA-DIR>/**/*.badger.db.migrate"})," files the next time it starts and start the migration (of the remaining ",(0,r.jsx)(n.code,{children:"<DATA-DIR>/**/*.badger.db"})]}),"\n",(0,r.jsx)(n.p,{children:"files) again."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["If the migration succeeds, Oasis Node will append the ",(0,r.jsx)(n.code,{children:".backup"})," suffix to all ",(0,r.jsx)(n.code,{children:"<DATA-DIR>/**/*.badger.db"})," files (Badger v2 files) and remove the ",(0,r.jsx)(n.code,{children:".migrate"})," suffix from all ",(0,r.jsx)(n.code,{children:"<DATA-DIR>/**/*.badger.db.migrate"})," files (Badger v3 files)."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"extra-storage-requirements",children:"Extra storage requirements"}),"\n",(0,r.jsx)(n.p,{children:"Your node will thus need to have extra storage space to store both the old and the new BadgerDB files."}),"\n",(0,r.jsxs)(n.p,{children:["To see estimate how much extra space the migration will need, use the ",(0,r.jsx)(n.code,{children:"du"})," tool:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"shopt -s globstar\ndu -h <DATA-DIR>/**/*.badger.db | sort -h -r\n"})}),"\n",(0,r.jsxs)(n.p,{children:["This is an example output from a Testnet node that uses ",(0,r.jsx)(n.code,{children:"/srv/oasis/node"})," as the ",(0,r.jsx)(n.code,{children:"<DATA-DIR>"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"6.3G\t/srv/oasis/node/tendermint/data/blockstore.badger.db\n2.7G\t/srv/oasis/node/tendermint/abci-state/mkvs_storage.badger.db\n1.4G\t/srv/oasis/node/tendermint/data/state.badger.db\n158M\t/srv/oasis/node/persistent-store.badger.db\n164K\t/srv/oasis/node/tendermint/abci-state/mkvs_storage.badger.db/checkpoints\n80K\t/srv/oasis/node/tendermint/abci-state/mkvs_storage.badger.db/checkpoints/4424334\n80K\t/srv/oasis/node/tendermint/abci-state/mkvs_storage.badger.db/checkpoints/4423334\n76K\t/srv/oasis/node/tendermint/abci-state/mkvs_storage.badger.db/checkpoints/4424334/fc815694d8219acb97fc0207a2159601df76df4d96802c147252ad0f2fd8a3f3\n76K\t/srv/oasis/node/tendermint/abci-state/mkvs_storage.badger.db/checkpoints/4423334/613e734e4ee4999bf71c3a190df13ea9d9b7d65af6a7fd8b2c9a477f2d052313\n68K\t/srv/oasis/node/tendermint/abci-state/mkvs_storage.badger.db/checkpoints/4424334/fc815694d8219acb97fc0207a2159601df76df4d96802c147252ad0f2fd8a3f3/chunks\n68K\t/srv/oasis/node/tendermint/abci-state/mkvs_storage.badger.db/checkpoints/4423334/613e734e4ee4999bf71c3a190df13ea9d9b7d65af6a7fd8b2c9a477f2d052313/chunks\n20K\t/srv/oasis/node/tendermint/data/evidence.badger.db\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["After you've confirmed your node is up and running, you can safely delete all the  ",(0,r.jsx)(n.code,{children:"<DATA-DIR>/**/*.badger.db.backup"})," files."]})}),"\n",(0,r.jsx)(n.h4,{id:"extra-memory-requirements",children:"Extra memory requirements"}),"\n",(0,r.jsx)(n.p,{children:"BadgerDB v2 to v3 migration can use a number of Go routines to migrate different database files in parallel."}),"\n",(0,r.jsxs)(n.p,{children:["However, this comes with a memory cost. For larger database files, it might need up to 4 GB of RAM per database, so we recommend lowering the number of Go routines BadgerDB uses during migration (",(0,r.jsx)(n.code,{children:"badger.migrate.num_go_routines"}),") if your node has less than 8 GB of RAM."]}),"\n",(0,r.jsxs)(n.p,{children:["If your node has less than 8 GB of RAM, set the number of Go routines BadgerDB uses during migration to 2 (default is 8) by adding the following to your node's ",(0,r.jsx)(n.code,{children:"config.yml"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# BadgerDB configuration.\nbadger:\n  migrate:\n    # Set the number of Go routines BadgerDB uses during migration to 2 to lower\n    # the memory pressure during migration (at the expense of a longer migration\n    # time).\n    num_go_routines: 2\n"})}),"\n",(0,r.jsx)(n.h2,{id:"2021-04-13-upgrade",children:"2021-04-13 Upgrade"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Upgrade height:"})," upgrade is scheduled to happen at epoch ",(0,r.jsx)(n.strong,{children:"5662."})]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"We expect the Testnet network to reach this epoch at around 2021-04-13 12:00 UTC."})}),"\n",(0,r.jsx)(n.h3,{id:"instructions-4",children:"Instructions"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Runtime operators see ",(0,r.jsx)(n.a,{href:"/node/reference/upgrade-logs/testnet#before-upgrade",children:"Before upgrade"})," section for required steps to be done before upgrade."]}),"\n",(0,r.jsxs)(n.li,{children:["(optional) Vote for the upgrade. On 2021-04-12 an upgrade proposal will be proposed which (if accepted) will schedule a network shutdown on epoch ",(0,r.jsx)(n.strong,{children:"5662."})," See the ",(0,r.jsx)(n.a,{href:"/build/tools/cli/network#governance-cast-vote",children:"Governance documentation"})," for details on voting for proposals."]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsx)(n.p,{children:"The upgrade proposal contains a non-existing upgrade handler and will be used to coordinate the network shutdown, the rest of the upgrade is manual."})}),"\n",(0,r.jsx)(n.p,{children:"Following steps should be performed only after the network has reached the upgrade network and has halted:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Download the Testnet genesis file published in the ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/testnet-artifacts/releases/tag/2021-04-13",children:"Testnet 2021-04-13 release"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["Testnet state at epoch ",(0,r.jsx)(n.strong,{children:"5662"})," will be exported and migrated to a 21.1.x compatible genesis file. Upgrade genesis file will be published on the above link soon after reaching the upgrade epoch."]})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Replace the old genesis file with the new Testnet genesis file."}),"\n",(0,r.jsxs)(n.li,{children:["Replace the old version of Oasis Node with version ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/releases/tag/v21.1",children:"21.1"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/node/run-your-node/maintenance/wiping-node-state#state-wipe-and-keep-node-identity",children:"Wipe state"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Start your node."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"before-upgrade-2",children:"Before upgrade"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Runtime operators"})}),"\n",(0,r.jsxs)(n.p,{children:["This upgrade requires a runtime storage node migration to be performed ",(0,r.jsx)(n.strong,{children:"before the upgrade genesis is published"}),". This can be done before the upgrade epoch is reached by stopping all runtime nodes and running the migration."]}),"\n",(0,r.jsxs)(n.admonition,{type:"danger",children:[(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Backup your node's data directory"})}),(0,r.jsx)(n.p,{children:"To prevent irrecoverable runtime storage data corruption/loss in case of a failed storage migration, backup your node's data directory."}),(0,r.jsxs)(n.p,{children:["For example, to backup the ",(0,r.jsx)(n.code,{children:"/serverdir/node"})," directory using the rsync tool, run:"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"rsync -a /serverdir/node/ /serverdir/node-BACKUP/\n"})})]}),"\n",(0,r.jsxs)(n.p,{children:["The storage database on all storage nodes needs to be migrated with the following command (using the ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/releases/tag/v21.1",children:"21.1"})," binary):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"oasis-node storage migrate \\\n  --datadir <NODE-DATADIR> \\\n  --runtime.supported <RUNTIME-ID>\n"})}),"\n",(0,r.jsx)(n.p,{children:"After the migration to v5 completes, you will see an output similar to:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"...\n- migrating from v4 to v5...\n- migrating version 24468...\n- migrated root state-root:195cf7a9a103e7300b2bb4e537cb9935cbebd83e448e67aa55433861a6ad7426 -> state-root:cea105a5d701deab935b94af9e8e0c5af5dcdb61c242bf434da9f11aa8d110ba\n- migrated root io-root:0850c5a33ee7f45aa92724b7d5f28c9ac9ae8799b88cc5be9773e8aba9526ca7 -> io-root:19713a2b44e1bf868ebee43c36872baa3058870bb890a5e25d1c4cea2622be77\n- migrated root io-root:477391131f60ac2c22bce9167c7e3783a13d4fb81fddd2d388b4ead6a586fe52 -> io-root:f29f86d491303c5fd7b3572e97cbd65b7487b6b4ac519623afd161cc2e4678b7\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Take note of the displayed ",(0,r.jsx)(n.code,{children:"state-root"})," and report it to the Foundation, as it needs to be included in the upgrade's new genesis file. Keep the runtime nodes stopped until the upgrade epoch is reached. At upgrade epoch, upgrade the nodes by following the remaining steps above."]}),"\n",(0,r.jsx)(n.h2,{id:"2021-03-24-upgrade",children:"2021-03-24 Upgrade"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Upgrade height:"})," upgrade is scheduled to happen at epoch ",(0,r.jsx)(n.strong,{children:"5128."})]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"We expect the Testnet network to reach this epoch at around 2021-03-24 11:30 UTC."})}),"\n",(0,r.jsx)(n.h3,{id:"instructions-5",children:"Instructions"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["(optional) To ensure your node will stop at epoch ",(0,r.jsx)(n.strong,{children:"5128"})," ",(0,r.jsx)(n.a,{href:"/build/tools/cli/network#governance-create-proposal",children:"submit the following upgrade descriptor"})," at any time before the upgrade:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "name": "testnet-upgrade-2021-03-24",\n  "method": "internal",\n  "identifier": "testnet-upgrade-2021-03-24",\n  "epoch": 5128\n}\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Download the Testnet genesis file published in the ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/testnet-artifacts/releases/tag/2021-03-24",children:"Testnet 2021-03-24 release"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["Testnet state at epoch ",(0,r.jsx)(n.strong,{children:"5128"})," will be exported and migrated to a 21.0.x compatible genesis file. Upgrade genesis file will be published on the above link soon after reaching the upgrade epoch."]})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["(optional) Verify the provided Testnet genesis file by comparing it to network state dump. See instructions in the ",(0,r.jsx)(n.a,{href:"/node/run-your-node/maintenance/handling-network-upgrades#verify-genesis",children:"Handling Network Upgrades"})," guide."]}),"\n",(0,r.jsx)(n.li,{children:"Replace the old genesis file with the new Testnet genesis file."}),"\n",(0,r.jsx)(n.li,{children:"Stop your node (if you haven't stopped it already by submitting the upgrade descriptor)."}),"\n",(0,r.jsxs)(n.li,{children:["Replace the old version of Oasis Node with version ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/releases/tag/v21.0.1",children:"21.0.1"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Update your node's configuration or perform any additional needed steps as per ",(0,r.jsx)(n.a,{href:"#additional-steps",children:"Additional Steps"})," below."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/node/run-your-node/maintenance/wiping-node-state#state-wipe-and-keep-node-identity",children:"Wipe state"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Start your node."}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["For more detailed instructions, see the ",(0,r.jsx)(n.a,{href:"/node/run-your-node/maintenance/handling-network-upgrades",children:"Handling Network Upgrades"})," guide."]})}),"\n",(0,r.jsx)(n.h3,{id:"additional-steps",children:"Additional steps"}),"\n",(0,r.jsxs)(n.p,{children:["Examine the ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/blob/v21.0.1/CHANGELOG.md#210-2021-03-18",children:"Changelog"})," of the 21.0 release."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Runtime operators"})}),"\n",(0,r.jsxs)(n.p,{children:["In addition to some ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/blob/v21.0.1/CHANGELOG.md#configuration-changes",children:"configuration changes"}),", this upgrade contains breaking runtime API changes. Make sure any runtime code is updated and compatible with the 21.0.x runtime API version."]}),"\n",(0,r.jsxs)(n.admonition,{type:"danger",children:[(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Backup your node's data directory"})}),(0,r.jsx)(n.p,{children:"To prevent irrecoverable runtime storage data corruption/loss in case of a failed storage migration, backup your node's data directory."}),(0,r.jsxs)(n.p,{children:["For example, to backup the ",(0,r.jsx)(n.code,{children:"/serverdir/node"})," directory using the rsync tool, run:"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"rsync -a /serverdir/node/ /serverdir/node-BACKUP/\n"})})]}),"\n",(0,r.jsxs)(n.p,{children:["For this upgrade, the runtime node operators need to perform an additional migration of the storage nodes. ",(0,r.jsx)(n.strong,{children:"Before starting the upgraded node and before wiping state"}),", the storage database on all storage nodes needs to be migrated with the following command (using the 21.0.1 binary):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"oasis-node storage migrate \\\n  --datadir <NODE-DATADIR> \\\n  --runtime.supported <RUNTIME-ID>\n"})}),"\n",(0,r.jsxs)(n.admonition,{type:"caution",children:[(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Storage access policy changes"})}),(0,r.jsxs)(n.p,{children:["Due to the changes in the default access policy on storage nodes, at least one of the storage nodes should be configured with the ",(0,r.jsx)(n.code,{children:"worker.storage.public_rpc.enabled"})," flag set to ",(0,r.jsx)(n.code,{children:"true"}),"."]}),(0,r.jsx)(n.p,{children:"Otherwise, external runtime clients wont be able to connect to any storage nodes."})]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);