"use strict";(globalThis.webpackChunkdocs_oasis_io=globalThis.webpackChunkdocs_oasis_io||[]).push([[529],{28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>o});var i=t(96540);const s={},a=i.createContext(s);function r(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(a.Provider,{value:n},e.children)}},68032:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"adrs/0025-bundle_hot_loading","title":"ADR 0025: Hot-loading of Runtime Bundles","description":"Component","source":"@site/docs/adrs/0025-bundle_hot_loading.md","sourceDirName":"adrs","slug":"/adrs/0025-bundle_hot_loading","permalink":"/adrs/0025-bundle_hot_loading","draft":false,"unlisted":false,"editUrl":"https://github.com/oasisprotocol/adrs/edit/main/0025-bundle_hot_loading.md","tags":[],"version":"current","lastUpdatedAt":1754295238000,"frontMatter":{"sidebar_custom_props":{}},"sidebar":"adrs","previous":{"title":"ADR 0024: Runtime Off-chain Logic (ROFL)","permalink":"/adrs/0024-off-chain-runtime-logic"}}');var s=t(74848),a=t(28453);const r={sidebar_custom_props:{tags:void 0}},o="ADR 0025: Hot-loading of Runtime Bundles",d={},l=[{value:"Component",id:"component",level:2},{value:"Changelog",id:"changelog",level:2},{value:"Status",id:"status",level:2},{value:"Context",id:"context",level:2},{value:"Decision",id:"decision",level:2},{value:"Metadata File",id:"metadata-file",level:2},{value:"Bundle Registry",id:"bundle-registry",level:2},{value:"Oasis Bundle Registry",id:"oasis-bundle-registry",level:3},{value:"Updates to the Runtime Configuration",id:"updates-to-the-runtime-configuration",level:2},{value:"Consequences",id:"consequences",level:2},{value:"Positive",id:"positive",level:3},{value:"Negative",id:"negative",level:3},{value:"Neutral",id:"neutral",level:3}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"adr-0025-hot-loading-of-runtime-bundles",children:"ADR 0025: Hot-loading of Runtime Bundles"})}),"\n",(0,s.jsx)(n.h2,{id:"component",children:"Component"}),"\n",(0,s.jsx)(n.p,{children:"Oasis Core"}),"\n",(0,s.jsx)(n.h2,{id:"changelog",children:"Changelog"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"2025-07-13: Initial version"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"status",children:"Status"}),"\n",(0,s.jsx)(n.p,{children:"Accepted"}),"\n",(0,s.jsx)(n.h2,{id:"context",children:"Context"}),"\n",(0,s.jsx)(n.p,{children:"The secure procedure for upgrading runtimes is not simple and requires\nsignificant effort from node operators. First, they must download\nthe latest bundle, which includes the updated version of the runtime\nthey intend to upgrade. Then, they need to verify the bundle, update\nthe node configuration to point to the new bundle's location, and restart\nthe node. Finally, once the new version is active, they must remove\nthe outdated bundles."}),"\n",(0,s.jsx)(n.h2,{id:"decision",children:"Decision"}),"\n",(0,s.jsx)(n.p,{children:"This proposal aims to automate bundle discovery and distribution so that\nthe upgrade process is more secure, reliable, and more user-friendly\nfor node operators."}),"\n",(0,s.jsx)(n.p,{children:"The process would involve the following steps:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"The runtime owner publishes the bundle checksum, i.e. the SHA-256 hash\nof the runtime bundle manifest, on-chain when registering a new runtime\ndeployment."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Upon registration of the new deployment, the node automatically retrieves\nthe bundle URL corresponding to the provided checksum from the configured\nbundle registries and downloads the bundle. The downloaded bundle is then\nverified and extracted to the appropriate location."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Once the new deployment becomes active, files and bundles associated\nwith the previous versions are removed from the file system."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"If needed, we can gradually transition to a more decentralized version\nof this process."}),"\n",(0,s.jsx)(n.h2,{id:"metadata-file",children:"Metadata File"}),"\n",(0,s.jsx)(n.p,{children:"A metadata file is a plain text document that references a specific bundle\nORC file and must follow these rules:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"The name must match the checksum of the bundle."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"The content must be a single line containing the URL of the corresponding\nbundle ORC file."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["For example, for the Sapphire ParaTime version 0.8.2, the metadata file would\nbe named ",(0,s.jsx)(n.code,{children:"e523903e480a8bef7caf18b846aefaa17913878b67eee13ac618849dd0bb8741"}),"\nand would look like this:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-txt",children:"https://github.com/oasisprotocol/sapphire-paratime/releases/download/v0.8.2/sapphire-paratime.orc\n"})}),"\n",(0,s.jsx)(n.h2,{id:"bundle-registry",children:"Bundle Registry"}),"\n",(0,s.jsx)(n.p,{children:"The bundle registry is responsible for storing metadata files used for bundle\ndiscovery and distribution. It may host metadata for one or more runtimes."}),"\n",(0,s.jsx)(n.p,{children:"The registry must ensure that all metadata files are accessible through\na bundle registry URL, as metadata URLs are formed by appending the metadata\nfile name, i.e. the bundle checksum, to this URL. Therefore, the bundle\nregistry URL doesn't need to be valid endpoint, only the constructed metadata\nURLs need to be valid."}),"\n",(0,s.jsx)(n.p,{children:"Note that the registry itself does not need to store any bundles; these can be\nhosted externally. Similarly, the runtime owners do not need to change their\nexisting release process. Instead, they simply need to extend it by publishing\nmetadata files with each release, if they wish to support hot-loading."}),"\n",(0,s.jsx)(n.h3,{id:"oasis-bundle-registry",children:"Oasis Bundle Registry"}),"\n",(0,s.jsxs)(n.p,{children:["To avoid requiring every runtime owner to host their own bundle registry,\nthe Oasis team has prepared a shared\n",(0,s.jsx)(n.a,{href:"https://github.com/oasisprotocol/bundle-registry",children:"bundle registry"}),",\nwhich is included by default in the node configuration."]}),"\n",(0,s.jsx)(n.p,{children:"Runtime owners can contribute by creating a pull request to add their metadata\nfiles to this shared registry. Alternatively, they can override the default\nconfiguration and use a custom one if they prefer to maintain their own."}),"\n",(0,s.jsx)(n.p,{children:"To explicitly use the Oasis bundle registry, you need to add the following\nURL to the configuration. Note that this URL is not a valid endpoint by itself:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-txt",children:"https://raw.githubusercontent.com/oasisprotocol/bundle-registry/main/metadata/\n"})}),"\n",(0,s.jsx)(n.p,{children:"When the node will request a metadata file, for example, for Sapphire ParaTime\nversion 0.8.2, the full URL will be constructed by appending the bundle\nchecksum. This will point to the correct file:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-txt",children:"https://raw.githubusercontent.com/oasisprotocol/bundle-registry/main/metadata/e523903e480a8bef7caf18b846aefaa17913878b67eee13ac618849dd0bb8741\n"})}),"\n",(0,s.jsx)(n.h2,{id:"updates-to-the-runtime-configuration",children:"Updates to the Runtime Configuration"}),"\n",(0,s.jsx)(n.p,{children:"Runtime configuration needs to be extended to accept a list of bundle registry\nURLs from which metadata files can be fetched. Registries hosting metadata\nfor all runtimes can be defined at the top level, while runtime-specific\nregistries can be configured individually for each runtime."}),"\n",(0,s.jsx)(n.p,{children:"The global configuration and runtime-specific configuration should be updated\nas follows:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'// Config is the runtime registry configuration structure.\ntype Config struct {\n  // ... existing fields omitted ...\n\n  // Registries is the list of base URLs used to fetch runtime bundle metadata.\n  //\n  // The actual metadata URLs are constructed by appending the manifest hash\n  // to the base URL. Therefore, the provided URLs don\'t need to be valid\n  // endpoints themselves, only the constructed URLs need to be valid.\n  Registries []string `yaml:"registries,omitempty"`\n}\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'// RuntimeConfig is the runtime configuration.\ntype RuntimeConfig struct {\n  // ... existing fields omitted ...\n\n  // Registries is the list of base URLs used to fetch runtime bundle metadata.\n  //\n  // The actual metadata URLs are constructed by appending the manifest hash\n  // to the base URL. Therefore, the provided URLs don\'t need to be valid\n  // endpoints themselves, only the constructed URLs need to be valid.\n  Registries []string `yaml:"registries,omitempty"`\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"consequences",children:"Consequences"}),"\n",(0,s.jsx)(n.h3,{id:"positive",children:"Positive"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Seamless runtime upgrades."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Reduced manual effort for node operators."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Improved security, as bundles are automatically verified."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"negative",children:"Negative"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Requires runtime owners to maintain metadata files and publish them\nconsistently."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"neutral",children:"Neutral"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Does not change the release process."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Bundle hosting remains flexible and decentralized."}),"\n"]}),"\n"]})]})}function c(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}}}]);