"use strict";(globalThis.webpackChunkdocs_oasis_io=globalThis.webpackChunkdocs_oasis_io||[]).push([[3746],{19315:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>d,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"node/run-your-node/maintenance/refreshing-certificates","title":"Refreshing Node Certificates","description":"Refreshing Sentry Client TLS Certificate on the Validator Node","source":"@site/docs/node/run-your-node/maintenance/refreshing-certificates.md","sourceDirName":"node/run-your-node/maintenance","slug":"/node/run-your-node/maintenance/refreshing-certificates","permalink":"/node/run-your-node/maintenance/refreshing-certificates","draft":false,"unlisted":false,"editUrl":"https://github.com/oasisprotocol/docs/edit/main/docs/node/run-your-node/maintenance/refreshing-certificates.md","tags":[],"version":"current","lastUpdatedAt":1761867754000,"frontMatter":{"sidebar_custom_props":{}},"sidebar":"operators","previous":{"title":"Adding or Removing Nodes","permalink":"/node/run-your-node/maintenance/adding-or-removing-nodes"},"next":{"title":"Shutting Down a Node","permalink":"/node/run-your-node/maintenance/shutting-down-a-node"}}');var r=t(74848),o=t(28453);const d={sidebar_custom_props:{tags:void 0}},s="Refreshing Node Certificates",c={},a=[{value:"Refreshing Sentry Client TLS Certificate on the Validator Node",id:"refreshing-sentry-client-tls-certificate-on-the-validator-node",level:2},{value:"Steps on the Validator Node",id:"steps-on-the-validator-node",level:3},{value:"Steps on the Sentry Node",id:"steps-on-the-sentry-node",level:3},{value:"Refreshing TLS Certificate on the Sentry Node",id:"refreshing-tls-certificate-on-the-sentry-node",level:2},{value:"Steps on the Sentry Node",id:"steps-on-the-sentry-node-1",level:3},{value:"Steps on the Validator Node",id:"steps-on-the-validator-node-1",level:3}];function l(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"refreshing-node-certificates",children:"Refreshing Node Certificates"})}),"\n",(0,r.jsx)(n.h2,{id:"refreshing-sentry-client-tls-certificate-on-the-validator-node",children:"Refreshing Sentry Client TLS Certificate on the Validator Node"}),"\n",(0,r.jsx)(n.h3,{id:"steps-on-the-validator-node",children:"Steps on the Validator Node"}),"\n",(0,r.jsxs)(n.p,{children:["Go to your validator node's data directory, e.g. ",(0,r.jsx)(n.code,{children:"/node/data"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"cd <PATH-TO-DATADIR>\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsxs)(n.p,{children:["We recommend backing up your validator's private and public keys (i.e. all ",(0,r.jsx)(n.code,{children:"*.pem"})," files) in your node's data directory before continuing."]})}),"\n",(0,r.jsx)(n.p,{children:"Remove the validator's current sentry client TLS private key and certificate by running:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"rm sentry_client_tls_identity.pem sentry_client_tls_identity_cert.pem\n"})}),"\n",(0,r.jsx)(n.p,{children:"Re-generate node's keys by running:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"oasis-node identity init --datadir ./\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["This should keep all your other node's keys (i.e. ",(0,r.jsx)(n.code,{children:"beacon.pem"}),", ",(0,r.jsx)(n.code,{children:"consensus.pem"}),", ",(0,r.jsx)(n.code,{children:"consensus_pub.pem"}),", ",(0,r.jsx)(n.code,{children:"identity.pem"}),", ",(0,r.jsx)(n.code,{children:"identity_pub.pem"}),", ...) intact."]})}),"\n",(0,r.jsx)(n.p,{children:"Then run:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"oasis-node identity show-sentry-client-pubkey --datadir ./\n"})}),"\n",(0,r.jsxs)(n.p,{children:["to obtain the value of the validator's new sentry client TLS public key in Base64-encoding that can be put in sentry node's configuration under ",(0,r.jsx)(n.code,{children:"control.authorized_pubkey"})," list."]}),"\n",(0,r.jsx)(n.p,{children:"Restart your validator node."}),"\n",(0,r.jsx)(n.h3,{id:"steps-on-the-sentry-node",children:"Steps on the Sentry Node"}),"\n",(0,r.jsx)(n.p,{children:"After generating a new sentry client TLS private key and certificate on the validator node, set the new client TLS public key in your sentry node's configuration."}),"\n",(0,r.jsx)(n.p,{children:"Before using the below sentry node configuration snippet, replace the following variables:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"{{ validator_sentry_client_grpc_public_key }}"}),": The validator node's new sentry client TLS public key encoded in Base64-encoding (e.g. ",(0,r.jsx)(n.code,{children:"KjVEdeGbtdxffQaSxIkLE+kW0sINI5/5YR/lgUkuEcw="}),")."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"... trimmed ...\n\n# Worker configuration.\nworker:\n  sentry:\n    # Enable sentry node.\n    enabled: true\n    # Port used by validator nodes to query sentry node for registry\n    # information.\n    # IMPORTANT: Only validator nodes protected by the sentry node should have\n    # access to this port. This port should not be exposed on the public\n    # network.\n    control:\n      port: 9009\n      authorized_pubkey:\n        - {{ validator_sentry_client_grpc_public_key }}\n\n... trimmed ...\n"})}),"\n",(0,r.jsx)(n.p,{children:"Restart your sentry node."}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsx)(n.p,{children:"The validator node will re-register itself automatically once it's connected to the network through the sentry again."})}),"\n",(0,r.jsx)(n.h2,{id:"refreshing-tls-certificate-on-the-sentry-node",children:"Refreshing TLS Certificate on the Sentry Node"}),"\n",(0,r.jsx)(n.h3,{id:"steps-on-the-sentry-node-1",children:"Steps on the Sentry Node"}),"\n",(0,r.jsxs)(n.p,{children:["Go to your sentry node's data directory, e.g. ",(0,r.jsx)(n.code,{children:"/node/data"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"cd <PATH-TO-DATADIR>\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsxs)(n.p,{children:["We recommend backing up your sentry's private and public keys (i.e. all ",(0,r.jsx)(n.code,{children:"*.pem"})," files) in your node's data directory before continuing."]})}),"\n",(0,r.jsx)(n.p,{children:"Remove the sentry's current TLS private key and certificate by running:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"rm tls_identity.pem tls_identity_cert.pem\n"})}),"\n",(0,r.jsx)(n.p,{children:"Re-generate node's keys by running:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"oasis-node identity init --datadir ./\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["This should keep all your other node's keys (i.e. ",(0,r.jsx)(n.code,{children:"beacon.pem"}),", ",(0,r.jsx)(n.code,{children:"consensus.pem"}),", ",(0,r.jsx)(n.code,{children:"consensus_pub.pem"}),", ",(0,r.jsx)(n.code,{children:"identity.pem"}),", ",(0,r.jsx)(n.code,{children:"identity_pub.pem"}),", ...) intact."]})}),"\n",(0,r.jsx)(n.p,{children:"Then run:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"oasis-node identity show-tls-pubkey --datadir ./\n"})}),"\n",(0,r.jsxs)(n.p,{children:["to obtain the value of the sentry's new TLS public key in Base64-encoding that can be put in validator node's configuration under ",(0,r.jsx)(n.code,{children:"worker.sentry.address"})," list."]}),"\n",(0,r.jsx)(n.p,{children:"Restart your sentry node."}),"\n",(0,r.jsx)(n.h3,{id:"steps-on-the-validator-node-1",children:"Steps on the Validator Node"}),"\n",(0,r.jsx)(n.p,{children:"After generating a new TLS private key and certificate on the sentry node, set the new TLS public key in your validator node's configuration."}),"\n",(0,r.jsx)(n.p,{children:"Before using the below validator node configuration snippet, replace the following variables:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"{{ entity_id }}"}),": The node's entity ID from the ",(0,r.jsx)(n.code,{children:"entity.json"})," file."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"{{ sentry_node_grpc_public_key }}"}),": The sentry node's new TLS public key encoded in Base64-encoding (e.g. ",(0,r.jsx)(n.code,{children:"1dA4/NuYPSWXYaKpLhaofrZscIb2FDKtJclCMnVC0Xc="}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"{{ sentry_node_private_ip }}"}),": The private IP address of the sentry node over which sentry node should be accessible to the validator."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'... trimmed ...\n\nworker:\n  registration:\n    # In order for the node to register itself, the entity ID must be set.\n    entity_id: {{ entity_id }}\n  sentry:\n    address:\n      - "{{ sentry_node_grpc_public_key }}@{{ sentry_node_private_ip }}:9009"\n\n... trimmed ...\n'})}),"\n",(0,r.jsx)(n.p,{children:"Restart your validator node."})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>d,x:()=>s});var i=t(96540);const r={},o=i.createContext(r);function d(e){const n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);