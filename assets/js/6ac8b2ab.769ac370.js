"use strict";(globalThis.webpackChunkdocs_oasis_io=globalThis.webpackChunkdocs_oasis_io||[]).push([[3132],{28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>a});var t=i(96540);const s={},o=t.createContext(s);function r(e){const n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(o.Provider,{value:n},e.children)}},79305:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"adrs/0009-ed25519-semantics","title":"ADR 0009: Ed25519 Signature Verification Semantics","description":"Component","source":"@site/docs/adrs/0009-ed25519-semantics.md","sourceDirName":"adrs","slug":"/adrs/0009-ed25519-semantics","permalink":"/adrs/0009-ed25519-semantics","draft":false,"unlisted":false,"editUrl":"https://github.com/oasisprotocol/adrs/edit/main/0009-ed25519-semantics.md","tags":[],"version":"current","lastUpdatedAt":1754295238000,"frontMatter":{"sidebar_custom_props":{}},"sidebar":"adrs","previous":{"title":"ADR 0008: Standard Account Key Generation","permalink":"/adrs/0008-standard-account-key-generation"},"next":{"title":"ADR 0010: VRF-based Committee Elections","permalink":"/adrs/0010-vrf-elections"}}');var s=i(74848),o=i(28453);const r={sidebar_custom_props:{tags:void 0}},a="ADR 0009: Ed25519 Signature Verification Semantics",c={},l=[{value:"Component",id:"component",level:2},{value:"Changelog",id:"changelog",level:2},{value:"Status",id:"status",level:2},{value:"Context",id:"context",level:2},{value:"Decision",id:"decision",level:2},{value:"Reject Non-canonical s",id:"reject-non-canonical-s",level:3},{value:"Reject Small Order A/R",id:"reject-small-order-ar",level:3},{value:"Accept Non-canonical A/R",id:"accept-non-canonical-ar",level:3},{value:"Cofactored Verification Equation",id:"cofactored-verification-equation",level:3},{value:"Accept A/R With Non-zero Torsion",id:"accept-ar-with-non-zero-torsion",level:3},{value:"Consequences",id:"consequences",level:2},{value:"Positive",id:"positive",level:3},{value:"Negative",id:"negative",level:3},{value:"Neutral",id:"neutral",level:3},{value:"Future Improvements",id:"future-improvements",level:3},{value:"Recomendations For Future Projects",id:"recomendations-for-future-projects",level:2},{value:"References",id:"references",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"adr-0009-ed25519-signature-verification-semantics",children:"ADR 0009: Ed25519 Signature Verification Semantics"})}),"\n",(0,s.jsx)(n.h2,{id:"component",children:"Component"}),"\n",(0,s.jsx)(n.p,{children:"Oasis Core"}),"\n",(0,s.jsx)(n.h2,{id:"changelog",children:"Changelog"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"2021-05-10: Initial version"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"status",children:"Status"}),"\n",(0,s.jsx)(n.p,{children:"Informative"}),"\n",(0,s.jsx)(n.h2,{id:"context",children:"Context"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"In programming, it's often the buts in the specification that kill you."}),"\n",(0,s.jsx)(n.p,{children:"-- Boris Beizer"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:'For a large host of reasons, mostly historical, there are numerous definitions\nof "Ed25519 signature validation" in the wild, which have the potential to\nbe mutually incompatible.  This ADR serves to provide a rough high-level\noverview of the issue, and to document the current definition of "Ed25519\nsignature verification" as used by Oasis Core.'}),"\n",(0,s.jsx)(n.h2,{id:"decision",children:"Decision"}),"\n",(0,s.jsx)(n.p,{children:"The Oasis Core consensus layer (and all of the Go components) currently uses\nthe following Ed25519 verification semantics."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Non-canonical s is rejected (MUST enforce ",(0,s.jsx)(n.code,{children:"s < L"}),")"]}),"\n",(0,s.jsx)(n.li,{children:"Small order A/R are rejected"}),"\n",(0,s.jsx)(n.li,{children:"Non-canonical A/R are accepted"}),"\n",(0,s.jsxs)(n.li,{children:["The cofactored verification equation MUST be used (",(0,s.jsx)(n.code,{children:"[8][S]B = [8]R + [8][k]A"}),")"]}),"\n",(0,s.jsx)(n.li,{children:"A/R may have a non-zero torsion component."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"reject-non-canonical-s",children:"Reject Non-canonical s"}),"\n",(0,s.jsxs)(n.p,{children:["Ed25519 signatures are trivially malleable unless the scalar component is\nconstrained to ",(0,s.jsx)(n.code,{children:"0 <= s < L"}),", as is possible to create valid signatures\nfrom an existing public key/message/signature tuple by adding L to s."]}),"\n",(0,s.jsx)(n.p,{children:"This check is mandated in all recent formulations of Ed25519 including\nbut not limited to RFC 8032 and FIPS 186-5, and most modern implementations\nwill include this check."}),"\n",(0,s.jsxs)(n.p,{children:["Note: Only asserting that ",(0,s.jsx)(n.code,{children:"s[31] & 224 == 0"})," as done in older implementations\nis insufficient."]}),"\n",(0,s.jsx)(n.h3,{id:"reject-small-order-ar",children:"Reject Small Order A/R"}),"\n",(0,s.jsx)(n.p,{children:"Rejecting small order A is required to make the signature scheme strongly\nbinding (resilience to key/message substitution attacks)."}),"\n",(0,s.jsx)(n.p,{children:"Rejecting (or accepting) small order R is not believed to have a security\nimpact."}),"\n",(0,s.jsx)(n.h3,{id:"accept-non-canonical-ar",children:"Accept Non-canonical A/R"}),"\n",(0,s.jsx)(n.p,{children:"The discrete logarithm of the Ed25519 points that have a valid non-canonical\nencoding and are not small order is unknown, and accepting them is not\nbelieved to have a security impact."}),"\n",(0,s.jsx)(n.p,{children:"Note: RFC 8032 and FIPS 186-5 require rejecting non-canonically encoded\npoints."}),"\n",(0,s.jsx)(n.h3,{id:"cofactored-verification-equation",children:"Cofactored Verification Equation"}),"\n",(0,s.jsxs)(n.p,{children:["There are two forms of the Ed25519 verification equation commonly in use,\n",(0,s.jsx)(n.code,{children:"[S]B = R + [k]A"})," (cofactor-less), and ",(0,s.jsx)(n.code,{children:"[8][S]B = [8]R + [8][k]A"}),"\n(cofactored), which are mutually incompatible in that it is possible\nto produce signatures that pass with one and fail with the other."]}),"\n",(0,s.jsx)(n.p,{children:"The cofactored verification equation is explicitly required by FIPS 186-5,\nand is the only equation that is compatible with batch signature verification.\nAdditionally, the more modern lattice-reduction based technique for fast\nsignature verification is incompatible with existing implementations unless\ncofactored."}),"\n",(0,s.jsx)(n.h3,{id:"accept-ar-with-non-zero-torsion",children:"Accept A/R With Non-zero Torsion"}),"\n",(0,s.jsx)(n.p,{children:"No other library enforces this, the check is extremely expensive, and\nwith how Oasis Core currently uses Ed25519 signatures, this has no security\nimpact.  In the event that Oasis Core does exotic things that, for example,\nrequire that the public key is in the prime-order subgroup, this must be\nchanged."}),"\n",(0,s.jsx)(n.h2,{id:"consequences",children:"Consequences"}),"\n",(0,s.jsx)(n.h3,{id:"positive",children:"Positive"}),"\n",(0,s.jsx)(n.p,{children:"The verification semantics in use by Oasis Core provides the following\nproperties:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"SUF-CMA security"}),"\n",(0,s.jsx)(n.li,{children:"Non-repudiation (strong binding)"}),"\n",(0,s.jsx)(n.li,{children:"Compatibility with batch and lattice reduction based verification."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"negative",children:"Negative"}),"\n",(0,s.jsx)(n.p,{children:'The combination of "reject small order A/R" and "accept non-canonical A/R"\nis difficult to test as it is not easily possible to generate valid\nsignatures that meet both conditions.'}),"\n",(0,s.jsx)(n.h3,{id:"neutral",children:"Neutral"}),"\n",(0,s.jsx)(n.h3,{id:"future-improvements",children:"Future Improvements"}),"\n",(0,s.jsx)(n.p,{children:"WARNING: Any changes to verification semantics are consensus breaking."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:'Consider switching to the "Algorithm 2" definition, for ease of testing\nand because it is the default behavior provided by curve25519-voi.'}),"\n",(0,s.jsx)(n.li,{children:"Consider switching to ZIP-215 semantics, to be inline with other projects,\nmore library support (Give up on strong binding)."}),"\n",(0,s.jsx)(n.li,{children:"Switching to ristretto255 (sr25519) eliminates these problems entirely."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"recomendations-for-future-projects",children:"Recomendations For Future Projects"}),"\n",(0,s.jsx)(n.p,{children:"The definition used in Oasis Core is partly historical.  New code should\nstrongly consider using one of FIPS 186-5, Algorithm 2, or ZIP-215 semantics."}),"\n",(0,s.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://eprint.iacr.org/2020/1244.pdf",children:"Taming the many EdDSAs"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://zips.z.cash/zip-0215",children:"Explicitly Defining and Modifying Ed25519 Validation Rules"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);