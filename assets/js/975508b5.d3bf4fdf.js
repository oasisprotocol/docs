"use strict";(globalThis.webpackChunkdocs_oasis_io=globalThis.webpackChunkdocs_oasis_io||[]).push([[5158],{28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var i=s(96540);const r={},t=i.createContext(r);function o(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(t.Provider,{value:n},e.children)}},64160:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"node/reference/upgrade-logs/mainnet","title":"Mainnet Upgrade Log","description":"For each upgrade of the Oasis Network, we are tracking important changes for","source":"@site/docs/node/reference/upgrade-logs/mainnet.md","sourceDirName":"node/reference/upgrade-logs","slug":"/node/reference/upgrade-logs/mainnet","permalink":"/node/reference/upgrade-logs/mainnet","draft":false,"unlisted":false,"editUrl":"https://github.com/oasisprotocol/docs/edit/main/docs/node/reference/upgrade-logs/mainnet.md","tags":[],"version":"current","lastUpdatedAt":1761867754000,"frontMatter":{"sidebar_custom_props":{}},"sidebar":"operators","previous":{"title":"Upgrade Logs","permalink":"/node/reference/upgrade-logs"},"next":{"title":"Testnet","permalink":"/node/reference/upgrade-logs/testnet"}}');var r=s(74848),t=s(28453);const o={sidebar_custom_props:{tags:void 0}},a="Mainnet Upgrade Log",d={},l=[{value:"2023-11-29 (10:02 UTC) - Eden Upgrade",id:"eden-upgrade",level:2},{value:"Configuration Changes",id:"configuration-changes",level:3},{value:"Data Directory Changes",id:"data-directory-changes",level:3},{value:"State Changes",id:"state-changes",level:3},{value:"General",id:"general",level:4},{value:"Registry",id:"registry",level:4},{value:"Root Hash",id:"root-hash",level:4},{value:"Staking",id:"staking",level:4},{value:"Key Manager",id:"key-manager",level:4},{value:"Random Beacon",id:"random-beacon",level:4},{value:"Governance",id:"governance",level:4},{value:"Consensus",id:"consensus",level:4},{value:"Other",id:"other",level:4},{value:"2022-04-11 (8:30 UTC) - Damask Upgrade",id:"damask-upgrade",level:2},{value:"Instructions - Voting",id:"instructions---voting",level:3},{value:"Instructions - Before upgrade",id:"instructions---before-upgrade",level:3},{value:"Instructions - Upgrade day",id:"instructions---upgrade-day",level:3},{value:"Configuration Changes",id:"damask-conf-changes",level:3},{value:"Additional notes",id:"additional-notes",level:3},{value:"2021-08-31 (16:00 UTC) - Parameter Update",id:"2021-08-31-upgrade",level:2},{value:"Proposed Parameter Changes",id:"proposed-parameter-changes",level:3},{value:"Instructions - Voting",id:"instructions---voting-1",level:3},{value:"Instructions - Before Upgrade System Preparation",id:"instructions---before-upgrade-system-preparation",level:3},{value:"BadgerDB v2 to v3 Migration",id:"badgerdb-v2-to-v3-migration",level:3},{value:"Extra storage requirements",id:"extra-storage-requirements",level:4},{value:"Extra memory requirements",id:"extra-memory-requirements",level:4},{value:"Installing Oasis App 2.3.1 to Your Ledger",id:"installing-oasis-app-231-to-your-ledger",level:3},{value:"Update Firmware to Version 2.0.0",id:"update-firmware-to-version-200",level:4},{value:"Install Prerequisites for Manual Installation",id:"install-prerequisites-for-manual-installation",level:4},{value:"Download Oasis App 2.3.1",id:"download-oasis-app-231",level:4},{value:"Install Oasis App 2.3.1",id:"install-oasis-app-231",level:4},{value:"Verify Installation",id:"verify-installation",level:4},{value:"2021-04-28 (16:00 UTC) - Cobalt Upgrade",id:"cobalt-upgrade",level:2},{value:"Instructions - Before upgrade",id:"instructions---before-upgrade-1",level:3},{value:"<strong>Runtime operators</strong>",id:"runtime-operators",level:4},{value:"Instructions - Upgrade day",id:"instructions---upgrade-day-1",level:3},{value:"Additional notes",id:"additional-notes-1",level:3},{value:"2020-11-18 (16:00 UTC) - Mainnet",id:"mainnet-upgrade",level:2},{value:"Instructions",id:"instructions",level:3},{value:"Configuration changes",id:"configuration-changes-1",level:3},{value:"2020-10-01 - Mainnet Beta",id:"mainnet-beta-upgrade",level:2},{value:"Instructions",id:"instructions-1",level:3},{value:"2020-09-22 - Mainnet Dry Run",id:"mainnet-dry-run",level:2},{value:"Instructions",id:"instructions-2",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"mainnet-upgrade-log",children:"Mainnet Upgrade Log"})}),"\n",(0,r.jsx)(n.p,{children:"For each upgrade of the Oasis Network, we are tracking important changes for\nnode operators' deployments."}),"\n",(0,r.jsx)(n.p,{children:"They are enumerated and explained in this document."}),"\n",(0,r.jsx)(n.h2,{id:"eden-upgrade",children:"2023-11-29 (10:02 UTC) - Eden Upgrade"}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsxs)(n.p,{children:["For a detailed view of the Eden Upgrade process, please refer to the\n",(0,r.jsx)(n.a,{href:"/node/reference/upgrades/eden-upgrade",children:"Eden Upgrade"})," page."]})}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsx)(n.p,{children:"The Oasis Core 23.0.x binary in our published releases is built only for Ubuntu\n22.04 (GLIBC>=2.32). You'll have to build it yourself if you're using prior\nUbuntu versions (or other distributions using older system libraries)."})}),"\n",(0,r.jsx)(n.h3,{id:"configuration-changes",children:"Configuration Changes"}),"\n",(0,r.jsxs)(n.p,{children:["The node configuration has been refactored so that everything is now configured\nvia a YAML configuration file and ",(0,r.jsx)(n.strong,{children:"configuring via command-line options is no\nlonger supported"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Some configuration options have changed and so the configuration file needs to\nbe updated. To make this step easier, a command-line tool has been provided that\nwill perform most of the changes automatically. You can run it with:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"oasis-node config migrate --in config.yml --out new-config.yml\n"})}),"\n",(0,r.jsx)(n.p,{children:"The migration subcommand logs the various changes it makes and warns you if a\nconfig option is no longer supported, etc. At the end, any unknown sections of\nthe input config file are printed to the terminal to give you a chance to review\nthem and make manual changes if required."}),"\n",(0,r.jsx)(n.p,{children:"Note that the migration subcommand does not preserve comments and order of\nsections from the input YAML config file. You should always carefully read the\noutput of this command, as well as compare the generated config file with the\noriginal before using it."}),"\n",(0,r.jsx)(n.p,{children:"After you are satisfied with the new configuration file, replace the old file\nwith the new one as follows:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"mv new-config.yml config.yml\n"})}),"\n",(0,r.jsxs)(n.admonition,{type:"tip",children:[(0,r.jsx)(n.p,{children:"The configuration format for seed nodes has changed and it now requires the\nnode's P2P public key to be used. In case your old configuration file contains\nknown Mainnet seed nodes, this transformation is performed automatically."}),(0,r.jsx)(n.p,{children:"However, if it contains unknown seed nodes then the conversion did not happen\nautomatically and you may need to obtain the seed node's P2P public key. For\nMainnet you can use the following addresses:"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"TBD"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"TBD"})}),"\n"]}),(0,r.jsx)(n.p,{children:"Please be aware that every seed node should be configured to listen on two\ndistinct ports. One is dedicated to peer discovery within the CometBFT P2P\nnetwork, while the other is used to bootstrap the Oasis P2P network."})]}),"\n",(0,r.jsx)(n.h3,{id:"data-directory-changes",children:"Data Directory Changes"}),"\n",(0,r.jsxs)(n.p,{children:["The subdirectory (located inside the node's data directory) used to store\nconsensus-related data, previously called ",(0,r.jsx)(n.code,{children:"tendermint"})," (after the consensus\nlayer protocol backend) has been renamed to ",(0,r.jsx)(n.code,{children:"consensus"})," in Oasis Core 23.0.x. If\nany of your scripts rely on specific directory names, please make sure to update\nthem to reflect the changed sdirectory name."]}),"\n",(0,r.jsx)(n.h3,{id:"state-changes",children:"State Changes"}),"\n",(0,r.jsx)(n.p,{children:"The following parts of the genesis document will be updated:"}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["For a more detailed explanation of the parameters below, see the\n",(0,r.jsx)(n.a,{href:"/node/reference/genesis-doc#parameters",children:"Genesis Document"})," docs."]})}),"\n",(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsxs)(n.p,{children:["All state changes will be done automatically with the migration command provided\nby the new version of ",(0,r.jsx)(n.code,{children:"oasis-node"}),". It can be used as follows to derive the same\ngenesis file from an existing state dump at the correct height (assuming there\nis a ",(0,r.jsx)(n.code,{children:"genesis.json"})," present in the current working directory):"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"oasis-node genesis migrate --genesis.new_chain_id oasis-4\n"})})]}),"\n",(0,r.jsx)(n.h4,{id:"general",children:"General"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"chain_id"})})," will be set to ",(0,r.jsx)(n.code,{children:"oasis-4"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"halt_epoch"})})," will be removed as it is no longer used."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"registry",children:"Registry"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"registry.runtimes[].txn_scheduler.propose_batch_timeout"})})," specifies how\nlong to wait before accepting proposal from the next backup scheduler. It will\nbe set to ",(0,r.jsx)(n.code,{children:"5000000000"})," (5 seconds). Previously the value was represented in\nthe number of consensus layer blocks."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"registry.params.gas_costs.prove_freshness"})})," specifies the cost of the\nfreshness proof transaction. It will be set to ",(0,r.jsx)(n.code,{children:"1000"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"registry.params.gas_costs.update_keymanager"})})," specifies the cost of the\nkeymanager policy update transaction. It will be removed as the parameter has\nbeen moved under ",(0,r.jsx)(n.code,{children:"keymanager.params.gas_costs.update_policy"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"registry.params.tee_features"})})," specify various TEE features supported by\nthe consensus layer registry service. These will be set to the following\nvalues to activate the new features:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'"tee_features": {\n  "sgx": {\n    "pcs": true,\n    "signed_attestations": true,\n    "max_attestation_age": 1200\n  },\n  "freshness_proofs": true\n}\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"registry.params.max_runtime_deployments"})})," specifies the maximum number of\nruntime deployments that can be specified in the runtime descriptor. It will\nbe set to ",(0,r.jsx)(n.code,{children:"5"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"root-hash",children:"Root Hash"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"roothash.params.max_past_roots_stored"})})," specifies the maximum number of\npast runtime state roots that are stored in consensus state for each runtime.\nIt will be set to ",(0,r.jsx)(n.code,{children:"1200"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"staking",children:"Staking"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"staking.params.commission_schedule_rules.min_commission_rate"})})," specifies\nthe minimum commission rate. It will be set to ",(0,r.jsx)(n.code,{children:"0"})," to maintain the existing\nbehavior."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"staking.params.thresholds.node-observer"})})," specifies the stake threshold\nfor registering an observer node. It will be set to ",(0,r.jsx)(n.code,{children:"100000000000"})," base units\n(or ",(0,r.jsx)(n.code,{children:"100"})," tokens), same as for existing compute nodes."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"key-manager",children:"Key Manager"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"keymanager.params.gas_costs"})})," specify the cost of key manager\ntransactions. These will be set to the following values:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'"gas_costs": {\n  "publish_ephemeral_secret": 1000,\n  "publish_master_secret": 1000,\n  "update_policy": 1000\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"random-beacon",children:"Random Beacon"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"beacon.base"})})," is the network's starting epoch. It will be set to the epoch\nof Mainnet's state dump + 1, ",(0,r.jsx)(n.code,{children:"28017"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"governance",children:"Governance"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"governance.params.enable_change_parameters_proposal"})})," specifies whether\nparameter change governance proposals are allowed. It will be set to ",(0,r.jsx)(n.code,{children:"true"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"consensus",children:"Consensus"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"consensus.params.max_block_size"})})," specifies the maximum block size in the\nconsensus layer. It will be set to ",(0,r.jsx)(n.code,{children:"1048576"})," (1 MiB)."]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"other",children:"Other"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"extra_data"})})," will be set back to the value in the ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/mainnet-artifacts/releases/tag/2020-11-18",children:"Mainnet genesis file"}),"\nto include the Oasis Network's genesis quote:"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.em,{children:"\u201d"}),(0,r.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Quis_custodiet_ipsos_custodes%3F",children:(0,r.jsx)(n.em,{children:"Quis custodiet ipsos custodes?"})}),(0,r.jsx)(n.em,{children:"\u201d [submitted by Oasis\nCommunity Member Daniyar Borangaziyev]:"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'"extra_data": {\n  "quote": "UXVpcyBjdXN0b2RpZXQgaXBzb3MgY3VzdG9kZXM/IFtzdWJtaXR0ZWQgYnkgT2FzaXMgQ29tbXVuaXR5IE1lbWJlciBEYW5peWFyIEJvcmFuZ2F6aXlldl0="\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"damask-upgrade",children:"2022-04-11 (8:30 UTC) - Damask Upgrade"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Upgrade height:"})," upgrade is scheduled to happen at epoch ",(0,r.jsx)(n.strong,{children:"13402"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"We expect the Mainnet network to reach this epoch at around 2022-04-11 8:30\nUTC."})}),"\n",(0,r.jsx)(n.h3,{id:"instructions---voting",children:"Instructions - Voting"}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Voting for the upgrade proposal will end at epoch 13152. We expect the Mainnet\nnetwork to reach this epoch at around 2022-03-31 21:00 UTC"}),"."]})}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"At this time only entities which have active validator nodes scheduled in the\nvalidator set are eligible to vote for governance proposals."})}),"\n",(0,r.jsxs)(n.admonition,{type:"danger",children:[(0,r.jsxs)(n.p,{children:["At least ",(0,r.jsx)(n.strong,{children:"75%"})," of the total ",(0,r.jsx)(n.strong,{children:"voting power"})," of the validator set needs to\ncast a vote on the upgrade proposal for the result to be valid."]}),(0,r.jsxs)(n.p,{children:["At least ",(0,r.jsx)(n.strong,{children:"90%"})," of the vote needs to be ",(0,r.jsx)(n.strong,{children:"yes"})," votes for a proposal to be\naccepted."]})]}),"\n",(0,r.jsxs)(n.p,{children:["The Oasis Protocol Foundation has submitted an ",(0,r.jsx)(n.a,{href:"/core/consensus/services/governance#submit-proposal",children:"upgrade governance proposal"}),"\nwith the following contents:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'{\n   "v": 1,\n    "handler": "mainnet-upgrade-2022-04-11",\n    "target": {\n        "consensus_protocol": {\n            "major": 5\n        },\n        "runtime_host_protocol": {\n            "major": 5\n        },\n        "runtime_committee_protocol": {\n            "major": 4\n        }\n    },\n    "epoch": 13402\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"To view the proposal yourself, you can run the following command on your online\nOasis Node:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"oasis-node governance list_proposals -a $ADDR\n"})}),"\n",(0,r.jsxs)(n.p,{children:["where ",(0,r.jsx)(n.code,{children:"$ADDR"})," represents the path to the internal Oasis Node UNIX socket\nprefixed with ",(0,r.jsx)(n.code,{children:"unix:"})," (e.g.",(0,r.jsx)(n.code,{children:"unix:/serverdir/node/internal.sock"}),")."]}),"\n",(0,r.jsx)(n.p,{children:"The output should look like:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'[\n  {\n    "id": 2,\n    "submitter": "oasis1qpydpeyjrneq20kh2jz2809lew6d9p64yymutlee",\n    "state": "active",\n    "deposit": "10000000000000",\n    "content": {\n      "upgrade": {\n        "v": 1,\n        "handler": "mainnet-upgrade-2022-04-11",\n        "target": {\n          "consensus_protocol": {\n            "major": 5\n          },\n          "runtime_host_protocol": {\n            "major": 5\n          },\n          "runtime_committee_protocol": {\n            "major": 4\n          }\n        },\n        "epoch": 13402\n      }\n    },\n    "created_at": 12984,\n    "closes_at": 13152\n  }\n]\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Obtain ",(0,r.jsx)(n.a,{href:"/build/tools/cli/account#show",children:"your entity's nonce"})," and store it in the ",(0,r.jsx)(n.code,{children:"NONCE"})," variable. You can do\nthat by running:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"ENTITY_DIR=<PATH-TO-YOUR-ENTITY>\nADDRESS=$(oasis-node stake pubkey2address --public_key \\\n  $(cat $ENTITY_DIR/entity.json | jq .id -r))\nNONCE=$(oasis-node stake account nonce --stake.account.address $ADDRESS -a $ADDR)\n"})}),"\n",(0,r.jsxs)(n.p,{children:["where ",(0,r.jsx)(n.code,{children:"<PATH-TO-YOUR-ENTITY>"})," is the path to your entity's descriptor, e.g.\n",(0,r.jsx)(n.code,{children:"/serverdir/node/entity/"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"To vote for the proposal, use the following command to generate a suitable\ntransaction:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'oasis-node governance gen_cast_vote \\\n  "${TX_FLAGS[@]}" \\\n  --vote.proposal.id 2 \\\n  --vote yes \\\n  --transaction.file tx_cast_vote.json \\\n  --transaction.nonce $NONCE \\\n  --transaction.fee.gas 2000 \\\n  --transaction.fee.amount 2000\n'})}),"\n",(0,r.jsxs)(n.p,{children:["where ",(0,r.jsx)(n.code,{children:"TX_FLAGS"})," refer to previously set base and signer flags as described in\nthe ",(0,r.jsx)(n.a,{href:"/core/oasis-node/cli",children:"Oasis node CLI Tools Setup"})," doc."]}),"\n",(0,r.jsxs)(n.admonition,{type:"caution",children:[(0,r.jsxs)(n.p,{children:["If you use a Ledger-signer backed entity, you will need to install version 2.3.2\nof the Oasis App as described in ",(0,r.jsx)(n.a,{href:"/general/manage-tokens/holding-rose-tokens/ledger-wallet",children:"Installing Oasis App on Your Ledger Wallet"}),"."]}),(0,r.jsxs)(n.p,{children:["Note that the previous version of the Oasis App available through Ledger Live,\nversion 1.8.2, doesn't support signing the ",(0,r.jsx)(n.code,{children:"governance.CastVote"})," transaction\ntype."]})]}),"\n",(0,r.jsxs)(n.p,{children:["To submit the generated transaction, copy ",(0,r.jsx)(n.code,{children:"tx_cast_vote.json"})," to the online\nOasis node and submit it from there:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"oasis-node consensus submit_tx \\\n  -a $ADDR \\\n  --transaction.file tx_cast_vote.json\n"})}),"\n",(0,r.jsx)(n.h3,{id:"instructions---before-upgrade",children:"Instructions - Before upgrade"}),"\n",(0,r.jsxs)(n.p,{children:["This upgrade will upgrade ",(0,r.jsx)(n.strong,{children:"Oasis Core"})," to the ",(0,r.jsx)(n.strong,{children:"22.1.x release series"})," which\n",(0,r.jsx)(n.strong,{children:"no longer allow running Oasis Node"})," (i.e. the ",(0,r.jsx)(n.code,{children:"oasis-node"})," binary)\n",(0,r.jsx)(n.strong,{children:"as root"})," (effective user ID of 0)."]}),"\n",(0,r.jsxs)(n.p,{children:['Running network accessible services as the root user is extremely bad for\nsystem security as a general rule. While it would be "ok" if we could drop\nprivileges, ',(0,r.jsx)(n.code,{children:"syscall.AllThreadsSyscall"})," does not work if the binary uses ",(0,r.jsx)(n.code,{children:"cgo"}),"\nat all."]}),"\n",(0,r.jsxs)(n.p,{children:["Nothing in Oasis Node will ever require elevated privileges.\nAttempting to run the ",(0,r.jsx)(n.code,{children:"oasis-node"})," process as the root user will now terminate\nimmediately on startup."]}),"\n",(0,r.jsx)(n.p,{children:"While there may be specific circumstances where it is safe to run network\nservices with the effective user ID set to 0, the overwhelming majority of cases\nwhere this is done is a misconfiguration."}),"\n",(0,r.jsxs)(n.p,{children:["Please, follow our ",(0,r.jsx)(n.a,{href:"/node/run-your-node/prerequisites/system-configuration#create-a-user",children:"Changing Your Setup to Run Oasis Services with Non-root\nSystem User"})," guide for steps-by-step instructions on how\nto update your system."]}),"\n",(0,r.jsxs)(n.p,{children:["If the previous behavior is required, the binary must be run in unsafe/debug\nmode (via the intentionally undocumented flag), and ",(0,r.jsx)(n.code,{children:"debug.allow_root"})," must also\nbe set."]}),"\n",(0,r.jsx)(n.h3,{id:"instructions---upgrade-day",children:"Instructions - Upgrade day"}),"\n",(0,r.jsxs)(n.p,{children:["Following steps should be performed on ",(0,r.jsx)(n.strong,{children:"2022-04-11"})," only after the network has\nreached the upgrade epoch and has halted:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Download the genesis file published in the ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/mainnet-artifacts/releases/tag/2022-04-11",children:"Damask upgrade release"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsxs)(n.p,{children:["Mainnet state at epoch ",(0,r.jsx)(n.strong,{children:"13402"})," will be exported and migrated to a 22.1.x\ncompatible genesis file."]}),(0,r.jsx)(n.p,{children:"Upgrade genesis file will be published on the above link soon after reaching the\nupgrade epoch."})]}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Verify the provided Damask upgrade genesis file by comparing it to network\nstate dump."}),"\n",(0,r.jsxs)(n.p,{children:["The state changes are described in the ",(0,r.jsx)(n.a,{href:"/node/reference/upgrades/damask-upgrade#proposed-state-changes",children:"Damask Upgrade"})," document."]}),"\n",(0,r.jsxs)(n.p,{children:["See instructions in the ",(0,r.jsx)(n.a,{href:"../../run-your-node/maintenance/handling-network-upgrades#verify-genesis",children:"Handling Network Upgrades"})," guide."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Replace the old genesis file with the new Damask upgrade genesis file."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Ensure your node will remain stopped by disabling auto-starting via your\nprocess manager (e.g., ",(0,r.jsx)(n.a,{href:"https://systemd.io/",children:"systemd"})," or ",(0,r.jsx)(n.a,{href:"http://supervisord.org/",children:"Supervisor"}),")"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Replace the old version of Oasis Node with version ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/releases/tag/v22.1.3",children:"22.1.3"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"../../run-your-node/maintenance/wiping-node-state#state-wipe-and-keep-node-identity",children:"Wipe state"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsx)(n.p,{children:"State of ParaTimes/runtimes is not affected by this upgrade and should NOT be\nwiped."})}),"\n",(0,r.jsxs)(n.admonition,{type:"caution",children:[(0,r.jsxs)(n.p,{children:["We recommend ",(0,r.jsx)(n.strong,{children:"backing up the pre-Damask consensus state"})," so all the\ntransactions and history are not permanently lost."]}),(0,r.jsx)(n.p,{children:"Also, if you ever need to access that state in the future, you will be able to\nspin up an Oasis Node in archive mode and query the pre-Damask state."})]}),"\n",(0,r.jsxs)(n.ol,{start:"7",children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Perform any needed ",(0,r.jsx)(n.a,{href:"#damask-conf-changes",children:"configuration changes"})," described\nbelow."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["(only for ParaTime operators) Replace old versions of your ParaTime binaries\nwith the new ",(0,r.jsxs)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/issues/4469",children:["Oasis Runtime Containers (",(0,r.jsx)(n.code,{children:".orc"}),")"]})," introduced in the\nDamask upgrade."]}),"\n",(0,r.jsx)(n.p,{children:"For the official Oasis ParaTimes, use the following versions:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Emerald ParaTime: ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/emerald-paratime/releases/tag/v8.2.0",children:"8.2.0"})]}),"\n",(0,r.jsxs)(n.li,{children:["Cipher ParaTime: ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/cipher-paratime/releases/tag/v1.1.0",children:"1.1.0"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["(only Emerald Web3 Gateway operators) Replace old version of Emerald Web3\nGateway with version ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/emerald-web3-gateway/releases/tag/v2.1.0",children:"2.1.0"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["(only Rosetta Gateway operators) Replace old version of Oasis Rosetta\nGateway with version ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-rosetta-gateway/releases/tag/v2.2.0",children:"2.2.0"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Start your node and re-enable auto-starting via your process manager."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"damask-conf-changes",children:"Configuration Changes"}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["To see the full extent of the changes examine the ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/blob/v22.1.3/CHANGELOG.md",children:"Change Log"}),":\nof the ",(0,r.jsx)(n.strong,{children:"Oasis Core 22.1.3"}),", in particular the ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/blob/v22.1.3/CHANGELOG.md#221-2022-04-01",children:"22.1"})," and\n",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/blob/v22.1.3/CHANGELOG.md#220-2022-03-01",children:"22.0"})," sections."]})}),"\n",(0,r.jsx)(n.p,{children:"If your node is currently configured to run a ParaTime, you need to perform some\nadditional steps."}),"\n",(0,r.jsxs)(n.p,{children:["The way ParaTime binaries are distributed has changed so that all required\nartifacts are contained in a single archive called the Oasis Runtime Container\nand have the ",(0,r.jsx)(n.code,{children:".orc"})," extension."]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["Links to updated ParaTime binaries will be published on the\n",(0,r.jsx)(n.a,{href:"../../network/mainnet#paratimes",children:"Network Parameters"})," page for their respective\nParaTimes."]})}),"\n",(0,r.jsxs)(n.p,{children:["The configuration is simplified as the ",(0,r.jsx)(n.code,{children:"runtime.paths"})," now only needs to list\nall of the supported ",(0,r.jsx)(n.code,{children:".orc"})," files (see below for an example)."]}),"\n",(0,r.jsxs)(n.p,{children:["Instead of separately configuring various roles for a node, there is now a\nsingle configuration flag called ",(0,r.jsx)(n.code,{children:"runtime.mode"})," which enables the correct roles\nas needed. It should be set to one of the following values:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"none"})," (runtime support is disabled, only consensus layer is enabled)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"compute"})," (node is participating as a runtime compute node for all the\nconfigured runtimes)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"keymanager"})," (node is participating as a keymanager node)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"client"})," (node is a stateful runtime client)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"client-stateless"})," (node is a stateless runtime client and connects to\nremote nodes for any state queries)"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Nodes that have so far been participating as compute nodes should set the mode\nto ",(0,r.jsx)(n.code,{children:"compute"})," and nodes that have been participating as clients for querying\nand transaction submission should set it to ",(0,r.jsx)(n.code,{children:"client"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"The following configuration flags have been removed:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"runtime.supported"})," (existing ",(0,r.jsx)(n.code,{children:"runtime.paths"})," is used instead)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"worker.p2p.enabled"})," (now automatically set based on runtime mode)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"worker.compute.enabled"})," (now set based on runtime mode)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"worker.keymanager.enabled"})," (now set based on runtime mode)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"worker.storage.enabled"})," (no longer needed)"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Also the ",(0,r.jsx)(n.code,{children:"worker.client"})," option is no longer needed unless you are providing\nconsensus layer RPC services."]}),"\n",(0,r.jsxs)(n.p,{children:["For example, if your ",(0,r.jsx)(n.em,{children:"previous"})," configuration looked like:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'runtime:\n  supported:\n    - "000000000000000000000000000000000000000000000000000000000000beef"\n\n  paths:\n    "000000000000000000000000000000000000000000000000000000000000beef": /path/to/runtime\n\nworker:\n  # ... other settings omitted ...\n\n  storage:\n    enabled: true\n\n  compute:\n    enabled: true\n\n  client:\n    port: 12345\n    addresses:\n      - "xx.yy.zz.vv:12345"\n\n  p2p:\n    enabled: true\n    port: 12346\n    addresses:\n      - "xx.yy.zz.vv:12346"\n'})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.em,{children:"new"})," configuration should look like:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'runtime:\n  mode: compute\n  paths:\n    - /path/to/runtime.orc\n\nworker:\n  # ... other settings omitted ...\n\n  p2p:\n    port: 12346\n    addresses:\n      - "xx.yy.zz.vv:12346"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"additional-notes",children:"Additional notes"}),"\n",(0,r.jsxs)(n.p,{children:["Examine the ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/blob/v22.1.3/CHANGELOG.md",children:"Change Log"})," of the 22.1.3 release, in particular\nthe ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/blob/v22.1.3/CHANGELOG.md#221-2022-04-01",children:"22.1"})," and ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/blob/v22.1.3/CHANGELOG.md#220-2022-03-01",children:"22.0"})," sections."]}),"\n",(0,r.jsx)(n.h2,{id:"2021-08-31-upgrade",children:"2021-08-31 (16:00 UTC) - Parameter Update"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Upgrade height:"})," upgrade is scheduled to happen at epoch ",(0,r.jsx)(n.strong,{children:"8049."})]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"We expect the Mainnet network to reach this epoch at around 2021-08-31 16:00 UTC."})}),"\n",(0,r.jsx)(n.h3,{id:"proposed-parameter-changes",children:"Proposed Parameter Changes"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/releases/tag/v21.2.8",children:"Oasis Core 21.2.8"})," release contains the ",(0,r.jsxs)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/blob/v21.2.8/go/upgrade/migrations/consensus_parameters.go",children:[(0,r.jsx)(n.code,{children:"consensus-params-update-2021-08"})," upgrade handler"]})," which will update the following parameters in the consensus layer:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["**",(0,r.jsx)(n.code,{children:"staking.params.max_allowances"})," ** specifies the maximum number of allowances on account can store. It will be set to ",(0,r.jsx)(n.code,{children:"16"})," (default value is ",(0,r.jsx)(n.code,{children:"0"}),") to enable support for beneficiary allowances which are required to transfer tokens into a ParaTime."]}),"\n",(0,r.jsxs)(n.li,{children:["**",(0,r.jsx)(n.code,{children:"staking.params.gas_costs"})," ** , ",(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"governance.params.gas_costs"})})," and ",(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"roothash.params.gas_costs"})})," specify gas costs for various types of staking, governance and roothash transactions. Gas costs for transactions that were missing gas costs will be added."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"scheduler.params.max_validators"})})," is the maximum size of the consensus committee (i.e. the validator set). It will be increased to",(0,r.jsx)(n.code,{children:"110"})," (it was set to ",(0,r.jsx)(n.code,{children:"100"})," previously)."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"instructions---voting-1",children:"Instructions - Voting"}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Voting for the upgrade proposal will end at epoch 7876. We expect the Mainnet network to reach this epoch at around 2021-08-24 12:00 UTC"}),(0,r.jsx)(n.em,{children:(0,r.jsx)(n.strong,{children:"."})})]})}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"At this time only entities which have active validator nodes scheduled in the validator set are eligible to vote for governance proposals."})}),"\n",(0,r.jsxs)(n.admonition,{type:"danger",children:[(0,r.jsxs)(n.p,{children:["At least ",(0,r.jsx)(n.strong,{children:"75%"})," of the ",(0,r.jsx)(n.strong,{children:"voting power"})," needs to cast vote on the upgrade proposal for the result to be valid."]}),(0,r.jsxs)(n.p,{children:["At least ",(0,r.jsx)(n.strong,{children:"90%"})," of the votes need to be ",(0,r.jsx)(n.strong,{children:"yes"})," votes for a proposal to be accepted."]})]}),"\n",(0,r.jsxs)(n.p,{children:["This upgrade will be the first upgrade that will use the new on-chain governance service introduced in the ",(0,r.jsx)(n.a,{href:"/node/reference/upgrades/cobalt-upgrade",children:"Cobalt Upgrade"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["The Oasis Protocol Foundation has submitted an ",(0,r.jsx)(n.a,{href:"/core/consensus/services/governance#submit-proposal",children:"upgrade governance proposal"})," with the following contents:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'{\n   "v": 1,\n    "handler": "consensus-params-update-2021-08",\n    "target": {\n        "consensus_protocol": {\n            "major": 4\n        },\n        "runtime_host_protocol": {\n            "major": 3\n        },\n        "runtime_committee_protocol": {\n            "major": 2\n        }\n    },\n    "epoch": 8049\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"To view the proposal yourself, you can run the following command on your online Oasis Node:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"oasis-node governance list_proposals -a $ADDR | jq\n"})}),"\n",(0,r.jsxs)(n.p,{children:["where ",(0,r.jsx)(n.code,{children:"$ADDR"})," represents the path to the internal Oasis Node UNIX socket prefixed with ",(0,r.jsx)(n.code,{children:"unix:"})," (e.g.",(0,r.jsx)(n.code,{children:"unix:/serverdir/node/internal.sock"}),")."]}),"\n",(0,r.jsx)(n.p,{children:"The output should look like:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'[\n  {\n    "id": 1,\n    "submitter": "oasis1qpydpeyjrneq20kh2jz2809lew6d9p64yymutlee",\n    "state": "active",\n    "deposit": "10000000000000",\n    "content": {\n      "upgrade": {\n        "v": 1,\n        "handler": "consensus-params-update-2021-08",\n        "target": {\n          "consensus_protocol": {\n            "major": 4\n          },\n          "runtime_host_protocol": {\n            "major": 3\n          },\n          "runtime_committee_protocol": {\n            "major": 2\n          }\n        },\n        "epoch": 8049\n      }\n    },\n    "created_at": 7708,\n    "closes_at": 7876\n  }\n]\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Obtain ",(0,r.jsx)(n.a,{href:"/build/tools/cli/account#show",children:"your entity's nonce"})," and store it in the ",(0,r.jsx)(n.code,{children:"NONCE"})," variable. You can do that by running:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"ENTITY_DIR=<PATH-TO-YOUR-ENTITY>\nADDRESS=$(oasis-node stake pubkey2address --public_key \\\n  $(cat $ENTITY_DIR/entity.json | jq .id -r))\nNONCE=$(oasis-node stake account nonce --stake.account.address $ADDRESS -a $ADDR)\n"})}),"\n",(0,r.jsxs)(n.p,{children:["where ",(0,r.jsx)(n.code,{children:"<PATH-TO-YOUR-ENTITY>"})," is the path to your entity's descriptor, e.g. ",(0,r.jsx)(n.code,{children:"/serverdir/node/entity/"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"To vote for the proposal, use the following command to generate a suitable transaction:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'oasis-node governance gen_cast_vote \\\n  "${TX_FLAGS[@]}" \\\n  --vote.proposal.id 1 \\\n  --vote yes \\\n  --transaction.file tx_cast_vote.json \\\n  --transaction.nonce $NONCE \\\n  --transaction.fee.gas 2000 \\\n  --transaction.fee.amount 2000\n'})}),"\n",(0,r.jsxs)(n.p,{children:["where ",(0,r.jsx)(n.code,{children:"TX_FLAGS"})," refer to previously set base and signer flags as described in the ",(0,r.jsx)(n.a,{href:"/core/oasis-node/cli",children:"Oasis node CLI Tools Setup"})," doc."]}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsxs)(n.p,{children:["If you use a Ledger-signer backed entity, you will need to install version 2.3.1 of the Oasis App as described in ",(0,r.jsx)(n.a,{href:"#installing-oasis-app-231-to-your-ledger",children:"Installing Oasis App 2.3.1 to Your Ledger"}),". This is needed because the current version of the Oasis App available through Ledger Live, version 1.8.2, doesn't support signing the ",(0,r.jsx)(n.code,{children:"governance.CastVote"})," transaction type."]})}),"\n",(0,r.jsxs)(n.p,{children:["To submit the generated transaction, copy ",(0,r.jsx)(n.code,{children:"tx_cast_vote.json"})," to the online Oasis node and submit it from there:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"oasis-node consensus submit_tx \\\n  -a $ADDR \\\n  --transaction.file tx_cast_vote.json\n"})}),"\n",(0,r.jsx)(n.h3,{id:"instructions---before-upgrade-system-preparation",children:"Instructions - Before Upgrade System Preparation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["This upgrade will upgrade ",(0,r.jsx)(n.strong,{children:"Oasis Core"})," to version ",(0,r.jsx)(n.strong,{children:"21.2.8"})," which:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Upgrades the BadgerDB database backend from v2 to v3. See ",(0,r.jsx)(n.a,{href:"/node/reference/upgrade-logs/mainnet#badgerdb-v2-to-v3-migration",children:(0,r.jsx)(n.strong,{children:"BadgerDB v2 to v3 Migration"})})," section for required steps to be done before upgrade."]}),"\n",(0,r.jsxs)(n.li,{children:["Has a check that makes sure the ",(0,r.jsx)(n.strong,{children:"file descriptor limit"})," is set to an appropriately high value (at least 50000). While previous versions only warned in case the limit was set too low, this version will refuse to start. Follow the ",(0,r.jsx)(n.a,{href:"/node/run-your-node/prerequisites/system-configuration#increase-file-descriptor-limit",children:"File Descriptor Limit"})," documentation page for details on how to increase the limit on your system."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Stop your node, replace the old version of Oasis Node with version ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/releases/tag/v21.2.8",children:"21.2.8"})," and restart your node."]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsx)(n.p,{children:"Since Oasis Core 21.2.8 is otherwise compatible with the current consensus layer protocol, you may upgrade your Mainnet node to this version at any time."})}),"\n",(0,r.jsx)(n.admonition,{title:"This is not dump & restore upgrade",type:"caution",children:(0,r.jsxs)(n.p,{children:["For this upgrade, ",(0,r.jsx)(n.strong,{children:"do NOT wipe state"}),"."]})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Once reaching the designated upgrade epoch, your node will stop and needs to be upgraded to Oasis Core ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/releases/tag/v21.2.8",children:"21.2.8"}),".","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"If you upgraded your node to Oasis Core 21.2.8 before the upgrade epoch was reached, you only need to restart your node for the upgrade to proceed."}),"\n",(0,r.jsx)(n.li,{children:"Otherwise, you need to upgrade your node to Oasis Core 21.2.8 first and then restart it."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["If you use a process manager like ",(0,r.jsx)(n.a,{href:"https://github.com/systemd/systemd",children:"systemd"})," or ",(0,r.jsx)(n.a,{href:"http://supervisord.org",children:"Supervisor"}),", you can configure it to restart the Oasis Node automatically."]})}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"The Mainnet's genesis file and the genesis document's hash will remain the same."})}),"\n",(0,r.jsx)(n.h3,{id:"badgerdb-v2-to-v3-migration",children:"BadgerDB v2 to v3 Migration"}),"\n",(0,r.jsxs)(n.p,{children:["This upgrade will upgrade Oasis Core to version ",(0,r.jsx)(n.strong,{children:"21.2.x"})," which includes the new ",(0,r.jsx)(n.a,{href:"https://github.com/dgraph-io/badger",children:(0,r.jsx)(n.strong,{children:"BadgerDB"})})," ",(0,r.jsx)(n.strong,{children:"v3"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Since BadgerDB's on-disk format changed in v3, it requires on-disk state migration. The migration process is done automatically and makes the following steps:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Upon startup, Oasis Node will start migrating all ",(0,r.jsx)(n.code,{children:"<DATA-DIR>/**/*.badger.db"})," files (Badger v2 files) and start writing Badger v3 DB to files with the ",(0,r.jsx)(n.code,{children:".migrate"})," suffix."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["If the migration fails in the middle, Oasis Node will delete all ",(0,r.jsx)(n.code,{children:"<DATA-DIR>/**/*.badger.db.migrate"})," files the next time it starts and start the migration (of the remaining ",(0,r.jsx)(n.code,{children:"<DATA-DIR>/**/*.badger.db"})]}),"\n",(0,r.jsx)(n.p,{children:"files) again."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["If the migration succeeds, Oasis Node will append the ",(0,r.jsx)(n.code,{children:".backup"})," suffix to all ",(0,r.jsx)(n.code,{children:"<DATA-DIR>/**/*.badger.db"})," files (Badger v2 files) and remove the ",(0,r.jsx)(n.code,{children:".migrate"})," suffix from all ",(0,r.jsx)(n.code,{children:"<DATA-DIR>/**/*.badger.db.migrate"})," files (Badger v3 files)."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.admonition,{type:"caution",children:[(0,r.jsxs)(n.p,{children:["The BadgerDB v2 to v3 migration is ",(0,r.jsx)(n.strong,{children:"very I/O intensive"})," (both IOPS and throughput) and ",(0,r.jsx)(n.strong,{children:"may take a couple of hours"})," to complete."]}),(0,r.jsx)(n.p,{children:"To follow its progress, run:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"shopt -s globstar\ndu -h <DATA-DIR>/**/*.badger.db* | sort -h -r\n"})}),(0,r.jsxs)(n.p,{children:["and observe the sizes of various ",(0,r.jsx)(n.code,{children:"*.badger.db*"})," directories."]}),(0,r.jsx)(n.p,{children:"For example, if it outputted the following:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"55G\tdata/tendermint/data/blockstore.badger.db\n37G\tdata/tendermint/abci-state/mkvs_storage.badger.db.backup\n32G\tdata/tendermint/abci-state/mkvs_storage.badger.db\n16G\tdata/tendermint/data/blockstore.badger.db.migration\n2.9G\tdata/tendermint/data/state.badger.db\n62M\tdata/persistent-store.badger.db.backup\n2.1M\tdata/tendermint/abci-state/mkvs_storage.badger.db.backup/checkpoints\n1.1M\tdata/tendermint/abci-state/mkvs_storage.badger.db.backup/checkpoints/4767601/ca51b06a054b69f2c18b9781ea42f0b00900de199c1937398514331b0d136ec3/chunks\n1.1M\tdata/tendermint/abci-state/mkvs_storage.badger.db.backup/checkpoints/4767601/ca51b06a054b69f2c18b9781ea42f0b00900de199c1937398514331b0d136ec3\n1.1M\tdata/tendermint/abci-state/mkvs_storage.badger.db.backup/checkpoints/4767601\n1.1M\tdata/tendermint/abci-state/mkvs_storage.badger.db.backup/checkpoints/4757601/2ec3a28b1f4a2fcce503f2e80eb5d77b6c0a4d1075e8a14d880ac390338a855e/chunks\n1.1M\tdata/tendermint/abci-state/mkvs_storage.badger.db.backup/checkpoints/4757601/2ec3a28b1f4a2fcce503f2e80eb5d77b6c0a4d1075e8a14d880ac390338a855e\n1.1M\tdata/tendermint/abci-state/mkvs_storage.badger.db.backup/checkpoints/4757601\n36K\tdata/persistent-store.badger.db\n20K\tdata/tendermint/data/evidence.badger.db\n"})}),(0,r.jsxs)(n.p,{children:["then the ",(0,r.jsx)(n.code,{children:"mkvs_storage.badger.db"})," was already migrated:"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["old BadgerDB v2 directory: ",(0,r.jsx)(n.code,{children:"37G data/tendermint/abci-state/mkvs_storage.badger.db.backup"})]}),"\n",(0,r.jsxs)(n.li,{children:["new BadgerDB v3 directory: ",(0,r.jsx)(n.code,{children:"32G data/tendermint/abci-state/mkvs_storage.badger.db"})]}),"\n"]}),(0,r.jsxs)(n.p,{children:["and now the ",(0,r.jsx)(n.code,{children:"blockstore.badger.db"})," is being migrated:"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"current BadgerDB v2 directory:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"55G data/tendermint/data/blockstore.badger.db"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["new BadgerDB v3 directory: ",(0,r.jsx)(n.code,{children:"16G data/tendermint/data/blockstore.badger.db.migration"})]}),"\n"]}),"\n"]}),(0,r.jsx)(n.p,{children:"Note that usually, the new BadgerDB v3 directory is smaller due to less fragmentation."})]}),"\n",(0,r.jsx)(n.h4,{id:"extra-storage-requirements",children:"Extra storage requirements"}),"\n",(0,r.jsx)(n.p,{children:"Your node will thus need to have extra storage space to store both the old and the new BadgerDB files."}),"\n",(0,r.jsxs)(n.p,{children:["To see estimate how much extra space the migration will need, use the ",(0,r.jsx)(n.code,{children:"du"})," tool:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"shopt -s globstar\ndu -h <DATA-DIR>/**/*.badger.db | sort -h -r\n"})}),"\n",(0,r.jsxs)(n.p,{children:["This is an example output from a Mainnet node that uses ",(0,r.jsx)(n.code,{children:"/srv/oasis/node"})," as the ",(0,r.jsx)(n.code,{children:"<DATA-DIR>"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"43G\t/srv/oasis/node/tendermint/data/blockstore.badger.db\n28G\t/srv/oasis/node/tendermint/abci-state/mkvs_storage.badger.db\n311M\t/srv/oasis/node/tendermint/data/state.badger.db\n2.0M\t/srv/oasis/node/tendermint/abci-state/mkvs_storage.badger.db/checkpoints\n996K\t/srv/oasis/node/tendermint/abci-state/mkvs_storage.badger.db/checkpoints/4517601\n996K\t/srv/oasis/node/tendermint/abci-state/mkvs_storage.badger.db/checkpoints/4507601\n992K\t/srv/oasis/node/tendermint/abci-state/mkvs_storage.badger.db/checkpoints/4517601/ba6218d7be2df31ba6e7201a8585c6435154728e55bbb7df1ffebe683bf60217\n992K\t/srv/oasis/node/tendermint/abci-state/mkvs_storage.badger.db/checkpoints/4507601/1e0bf592bb0d99832b13ad91bc32aed018dfc2639e07b93a254a05f6791a19ac\n984K\t/srv/oasis/node/tendermint/abci-state/mkvs_storage.badger.db/checkpoints/4517601/ba6218d7be2df31ba6e7201a8585c6435154728e55bbb7df1ffebe683bf60217/chunks\n984K\t/srv/oasis/node/tendermint/abci-state/mkvs_storage.badger.db/checkpoints/4507601/1e0bf592bb0d99832b13ad91bc32aed018dfc2639e07b93a254a05f6791a19ac/chunks\n148K\t/srv/oasis/node/persistent-store.badger.db\n36K\t/srv/oasis/node/tendermint/data/evidence.badger.db\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["After you've confirmed your node is up and running, you can safely delete all the  ",(0,r.jsx)(n.code,{children:"<DATA-DIR>/**/*.badger.db.backup"})," files."]})}),"\n",(0,r.jsx)(n.h4,{id:"extra-memory-requirements",children:"Extra memory requirements"}),"\n",(0,r.jsx)(n.p,{children:"BadgerDB v2 to v3 migration can use a number of Go routines to migrate different database files in parallel."}),"\n",(0,r.jsxs)(n.p,{children:["However, this comes with a memory cost. For larger database files, it might need up to 4 GB of RAM per database, so we recommend lowering the number of Go routines BadgerDB uses during migration (",(0,r.jsx)(n.code,{children:"badger.migrate.num_go_routines"}),") if your node has less than 8 GB of RAM."]}),"\n",(0,r.jsxs)(n.p,{children:["If your node has less than 8 GB of RAM, set the number of Go routines BadgerDB uses during migration to 2 (default is 8) by adding the following to your node's ",(0,r.jsx)(n.code,{children:"config.yml"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# BadgerDB configuration.\nbadger:\n  migrate:\n    # Set the number of Go routines BadgerDB uses during migration to 2 to lower\n    # the memory pressure during migration (at the expense of a longer migration\n    # time).\n    num_go_routines: 2\n"})}),"\n",(0,r.jsx)(n.h3,{id:"installing-oasis-app-231-to-your-ledger",children:"Installing Oasis App 2.3.1 to Your Ledger"}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["This manual installation procedure is needed until the latest version of the Oasis App, version 2.3.1, becomes available through ",(0,r.jsx)(n.a,{href:"https://www.ledger.com/ledger-live/",children:"Ledger Live"}),"'s Manager."]})}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsxs)(n.p,{children:["Unlike Nano S devices, ",(0,r.jsx)(n.strong,{children:"Nano X"})," devices are locked meaning one cannot manual install the latest version of the Oasis App on them. If you use a Nano X device, you will need to temporarily switch to a Nano S device or wait for the new version of the Oasis App to be available through Ledger Live's Manager."]})}),"\n",(0,r.jsx)(n.h4,{id:"update-firmware-to-version-200",children:"Update Firmware to Version 2.0.0"}),"\n",(0,r.jsxs)(n.p,{children:["First, make sure the firmware on your Nano S is up-to-date. At least ",(0,r.jsx)(n.a,{href:"https://support.ledger.com/hc/en-us/articles/360010446000-Ledger-Nano-S-firmware-release-notes",children:"version 2.0.0"})," released on May 4, 2021, is required. Follow ",(0,r.jsx)(n.a,{href:"https://support.ledger.com/hc/en-us/articles/360002731113-Update-Ledger-Nano-S-firmware",children:"Ledger's instructions for updating the firmware on your Nano S"}),"."]}),"\n",(0,r.jsx)(n.h4,{id:"install-prerequisites-for-manual-installation",children:"Install Prerequisites for Manual Installation"}),"\n",(0,r.jsx)(n.p,{children:"The manual installation process relies on some tooling that needs to be available on the system:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.python.org",children:"Python"})," 3."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://github.com/LedgerHQ/blue-loader-python",children:"Python tools for Ledger Blue, Nano S and Nano X"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Most systems should already have ",(0,r.jsx)(n.a,{href:"https://www.python.org",children:"Python"})," pre-installed."]}),"\n",(0,r.jsxs)(n.p,{children:["To install ",(0,r.jsx)(n.a,{href:"https://github.com/LedgerHQ/blue-loader-python",children:"Python tools for Ledger Blue, Nano S and Nano X"}),", use ",(0,r.jsx)(n.a,{href:"https://pip.pypa.io/en/stable/",children:"pip"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"pip3 install --upgrade ledgerblue\n"})}),"\n",(0,r.jsxs)(n.p,{children:["You might want to install the packages to a ",(0,r.jsx)(n.a,{href:"https://packaging.python.org/tutorials/installing-packages/#creating-virtual-environments",children:"Python virtual environment"})," or via so-called ",(0,r.jsx)(n.a,{href:"https://pip.pypa.io/en/stable/user_guide/#user-installs",children:"User install"})," (i.e. isolated to the current user)."]}),"\n",(0,r.jsx)(n.h4,{id:"download-oasis-app-231",children:"Download Oasis App 2.3.1"}),"\n",(0,r.jsxs)(n.p,{children:["Download the ",(0,r.jsx)(n.a,{href:"https://github.com/Zondax/ledger-oasis/releases/download/v2.3.1/installer_s.sh",children:"Oasis App 2.3.1 installer for Nano S"})," from ",(0,r.jsx)(n.a,{href:"https://github.com/Zondax/ledger-oasis",children:"Zondax's Oasis App GitHub repo"}),"."]}),"\n",(0,r.jsx)(n.h4,{id:"install-oasis-app-231",children:"Install Oasis App 2.3.1"}),"\n",(0,r.jsx)(n.p,{children:"Make the downloaded installer executable by running:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"chmod +x installer_s.sh\n"})}),"\n",(0,r.jsx)(n.p,{children:"Connect you Nano S and unlock it. Then execute the installer:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"./installer_s.sh load\n"})}),"\n",(0,r.jsx)(n.p,{children:"Your Nano S will give you the option to either:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.em,{children:"Deny unsafe manager"}),", or"]}),"\n",(0,r.jsxs)(n.li,{children:["review the ",(0,r.jsx)(n.em,{children:"Public Key"})," and ",(0,r.jsx)(n.em,{children:"Allow unsafe manager"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["First review the public key and ensure it matches the ",(0,r.jsx)(n.code,{children:"Generated random root public key"})," displayed in the terminal."]}),"\n",(0,r.jsxs)(n.p,{children:["Then double press the ",(0,r.jsx)(n.em,{children:"Allow unsafe manager"})," option."]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["If there is an existing version of the ",(0,r.jsx)(n.em,{children:"Oasis App"})," installed on your Nano S, you will be prompted with the ",(0,r.jsx)(n.em,{children:"Uninstall Oasis"})," screen, followed by reviewing the ",(0,r.jsx)(n.em,{children:"Identifier"})," (it will depend on the version of the Oasis App you have currently installed) and finally confirming deletion on the ",(0,r.jsx)(n.em,{children:"Confirm action"})," screen."]})}),"\n",(0,r.jsxs)(n.p,{children:["After the new version of the Oasis App has finished loading, you will be prompted with the ",(0,r.jsx)(n.em,{children:"Install app Oasis"})," screen, followed by reviewing the ",(0,r.jsx)(n.em,{children:"Version"}),", ",(0,r.jsx)(n.em,{children:"Identifier"})," and ",(0,r.jsx)(n.em,{children:"Code Identifier"})," screens_._ Ensure the values are as follows:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Version: 2.3.1"}),"\n",(0,r.jsxs)(n.li,{children:["Identifier (",(0,r.jsx)(n.em,{children:"Application full hash"})," on the terminal): ",(0,r.jsx)(n.code,{children:"E0CB424D3B1C2A0F694BCB6E99C3B37C7685399D59DD12D7CF80AF4A487882B1"})]}),"\n",(0,r.jsxs)(n.li,{children:["Code Identifier: ",(0,r.jsx)(n.code,{children:"C17EBE7CD356D01411A02A81C64CDA3E81F193BDA09BEBBD0AEAF75AD7EC35E3"})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Finally, confirm installation of the new app by double pressing on the ",(0,r.jsx)(n.em,{children:"Perform installation"})," screen. Your Ledger device will ask for your PIN again."]}),"\n",(0,r.jsx)(n.admonition,{type:"danger",children:(0,r.jsxs)(n.p,{children:["Installing Oasis App 2.3.1 on a Nano S with the firmware version < 2.0.0 (e.g. 1.6.1) will NOT fail. It will show a different ",(0,r.jsx)(n.em,{children:"Identifier"})," when installing the app which will NOT match the ",(0,r.jsx)(n.em,{children:"Application full hash"}),' shown on the terminal. However, opening the app will not work and it will "freeze" your Nano S device.']})}),"\n",(0,r.jsx)(n.h4,{id:"verify-installation",children:"Verify Installation"}),"\n",(0,r.jsxs)(n.p,{children:["Open the Oasis App on your Nano S and ensure the ",(0,r.jsx)(n.em,{children:"Version"})," screen shows version 2.3.1."]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["Starting the manually installed version of the Oasis App will always show the ",(0,r.jsx)(n.em,{children:"This app is not genuine"})," screen, followed by ",(0,r.jsx)(n.em,{children:"Identifier"})," (which should match the Identifier value above) screen. Finally, open the application by double pressing on the ",(0,r.jsx)(n.em,{children:"Open application"})," screen."]})}),"\n",(0,r.jsxs)(n.admonition,{type:"tip",children:[(0,r.jsxs)(n.p,{children:["After you've signed your ",(0,r.jsx)(n.code,{children:"governance.CastVote"})," transaction, you can safely downgrade Oasis App to the latest official version available via ",(0,r.jsx)(n.a,{href:"https://www.ledger.com/ledger-live/",children:"Ledger Live"}),", version 1.8.2."]}),(0,r.jsx)(n.p,{children:"To do that, just open Ledger Live's Manager and it will prompt you to install version 1.8.2."})]}),"\n",(0,r.jsx)(n.h2,{id:"cobalt-upgrade",children:"2021-04-28 (16:00 UTC) - Cobalt Upgrade"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Upgrade height:"})," upgrade is scheduled to happen at epoch ",(0,r.jsx)(n.strong,{children:"5046."})]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"We expect the Mainnet network to reach this epoch at around 2021-04-28 12:00 UTC."})}),"\n",(0,r.jsx)(n.h3,{id:"instructions---before-upgrade-1",children:"Instructions - Before upgrade"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Make sure you are running the latest Mainnet-compatible Oasis Node version: ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/releases/tag/v20.12.7",children:"20.12.7"}),".","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["If you are running a different ",(0,r.jsx)(n.strong,{children:"20.12.x"})," Oasis Node version, update to version ",(0,r.jsx)(n.strong,{children:"20.12.7"})," before the upgrade."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["Version ",(0,r.jsx)(n.strong,{children:"20.12.7"})," is backwards compatible with other ",(0,r.jsx)(n.strong,{children:"20.12.x"})," releases, so upgrade can be performed at any time by stopping the node and replacing the binary."]})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["To ensure your node will stop at epoch ",(0,r.jsx)(n.strong,{children:"5046"})," ",(0,r.jsx)(n.a,{href:"/build/tools/cli/network#governance-create-proposal",children:"submit the following upgrade descriptor"})," at any time before the upgrade:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'{\n  "name": "mainnet-upgrade-2021-04-28",\n  "method": "internal",\n  "identifier": "mainnet-upgrade-2021-04-28",\n  "epoch": 5046\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsx)(n.p,{children:"The upgrade descriptor contains a non-existing upgrade handler and will be used to coordinate the network shutdown, the rest of the upgrade is manual."})}),"\n",(0,r.jsx)(n.h4,{id:"runtime-operators",children:(0,r.jsx)(n.strong,{children:"Runtime operators"})}),"\n",(0,r.jsxs)(n.p,{children:["Following section is relevant only for ",(0,r.jsx)(n.strong,{children:"runtime operators"})," that are running ",(0,r.jsx)(n.strong,{children:"storage"})," nodes for active runtimes on the Mainnet."]}),"\n",(0,r.jsxs)(n.p,{children:["This upgrade requires a runtime storage node migration to be performed ",(0,r.jsx)(n.strong,{children:"before the upgrade genesis is published"}),". This can be done before the upgrade epoch is reached by stopping all runtime nodes and running the migration."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Backup your node's data directory"})}),"\n",(0,r.jsx)(n.p,{children:"To prevent irrecoverable runtime storage data corruption/loss in case of a failed storage migration, backup your node's data directory."}),"\n",(0,r.jsxs)(n.p,{children:["For example, to backup the ",(0,r.jsx)(n.code,{children:"/serverdir/node"})," directory using the ",(0,r.jsx)(n.a,{href:"https://rsync.samba.org",children:"rsync"})," tool, run:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"rsync -a /serverdir/node/ /serverdir/node-BACKUP/\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The storage database on all storage nodes needs to be migrated with the following command (using the ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/releases/tag/v21.1.1",children:"21.1.1"})," binary):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"oasis-node storage migrate \\\n  --datadir <NODE-DATADIR> \\\n  --runtime.supported <RUNTIME-ID>\n"})}),"\n",(0,r.jsx)(n.p,{children:"After the migration to v5 completes, you will see an output similar to:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"...\n- migrating from v4 to v5...\n- migrating version 24468...\n- migrated root state-root:195cf7a9a103e7300b2bb4e537cb9935cbebd83e448e67aa55433861a6ad7426 -> state-root:cea105a5d701deab935b94af9e8e0c5af5dcdb61c242bf434da9f11aa8d110ba\n- migrated root io-root:0850c5a33ee7f45aa92724b7d5f28c9ac9ae8799b88cc5be9773e8aba9526ca7 -> io-root:19713a2b44e1bf868ebee43c36872baa3058870bb890a5e25d1c4cea2622be77\n- migrated root io-root:477391131f60ac2c22bce9167c7e3783a13d4fb81fddd2d388b4ead6a586fe52 -> io-root:f29f86d491303c5fd7b3572e97cbd65b7487b6b4ac519623afd161cc2e4678b7\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Take note of the displayed ",(0,r.jsx)(n.code,{children:"state-root"})," and report it to the Foundation, as it needs to be included in the upgrade's new genesis file. Keep the runtime nodes stopped until the upgrade epoch is reached. At upgrade epoch, upgrade the nodes by following the remaining steps above."]}),"\n",(0,r.jsx)(n.h3,{id:"instructions---upgrade-day-1",children:"Instructions - Upgrade day"}),"\n",(0,r.jsxs)(n.p,{children:["Following steps should be performed on ",(0,r.jsx)(n.strong,{children:"2021-04-28"})," only after the network has reached the upgrade epoch and has halted:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Download the genesis file published in the ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/mainnet-artifacts/releases/tag/2021-04-28",children:"Cobalt Upgrade release"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["Mainnet state at epoch ",(0,r.jsx)(n.strong,{children:"5046"})," will be exported and migrated to a 21.1.x compatible genesis file. Upgrade genesis file will be published on the above link soon after reaching the upgrade epoch."]})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Verify the provided Cobalt upgrade genesis file by comparing it to network state dump. See instructions in the ",(0,r.jsx)(n.a,{href:"/node/run-your-node/maintenance/handling-network-upgrades#verify-genesis",children:"Handling Network Upgrades"})," guide."]}),"\n",(0,r.jsx)(n.li,{children:"Replace the old genesis file with the new Cobalt upgrade genesis file."}),"\n",(0,r.jsx)(n.li,{children:"Stop your node (if you haven't stopped it already by submitting the upgrade descriptor)."}),"\n",(0,r.jsxs)(n.li,{children:["Replace the old version of Oasis Node with version ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/releases/tag/v21.1.1",children:"21.1.1"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/node/run-your-node/maintenance/wiping-node-state#state-wipe-and-keep-node-identity",children:"Wipe state"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Start your node."}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["For more detailed instructions, see the ",(0,r.jsx)(n.a,{href:"/node/run-your-node/maintenance/handling-network-upgrades",children:"Handling Network Upgrades"})," guide."]})}),"\n",(0,r.jsx)(n.h3,{id:"additional-notes-1",children:"Additional notes"}),"\n",(0,r.jsxs)(n.p,{children:["Examine the ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/blob/v21.1.1/CHANGELOG.md",children:"Change Log"})," of the 21.1.1 (and 21.0) releases."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Runtime operators"})}),"\n",(0,r.jsxs)(n.p,{children:["Note the following configuration change in the ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/blob/v21.1.1/CHANGELOG.md#configuration-changes",children:"21.0"})," release."]}),"\n",(0,r.jsxs)(n.admonition,{type:"caution",children:[(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Storage access policy changes"})}),(0,r.jsxs)(n.p,{children:["Due to the changes in the default access policy on storage nodes, at least one of the storage nodes should be configured with the ",(0,r.jsx)(n.code,{children:"worker.storage.public_rpc.enabled"})," flag set to ",(0,r.jsx)(n.code,{children:"true"}),"."]}),(0,r.jsx)(n.p,{children:"Otherwise, external runtime clients wont be able to connect to any storage nodes."})]}),"\n",(0,r.jsx)(n.h2,{id:"mainnet-upgrade",children:"2020-11-18 (16:00 UTC) - Mainnet"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Block height"})," when Mainnet Beta network stops: ",(0,r.jsx)(n.strong,{children:"702000."})]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"We expect the Mainnet Beta network to reach this block height at around 2020-11-18 13:30 UTC."})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Upgrade window:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Start: ",(0,r.jsx)(n.strong,{children:"2020-11-18T16:00:00Z."})]}),"\n",(0,r.jsxs)(n.li,{children:["End: After nodes representing ",(0,r.jsx)(n.strong,{children:"2/3+ stake"})," do the upgrade."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"instructions",children:"Instructions"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Download ",(0,r.jsx)(n.a,{href:"/node/run-your-node/prerequisites/oasis-node",children:"Oasis Node"})," version ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/oasis-core/releases/tag/v20.12.2",children:"20.12.2"}),", while continuing to run version 20.10.x."]}),"\n",(0,r.jsx)(n.li,{children:"(optional) Use Oasis Node version 20.12.2 to dump network state at the specified block height. It will connect to the running version 20.10.x node."}),"\n",(0,r.jsxs)(n.li,{children:["Download the Mainnet genesis file published in the ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/mainnet-artifacts/releases/tag/2020-11-18",children:"2020-11-18 release"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["(optional) Verify the provided Mainnet genesis file by comparing it to network state dump. See instructions in the ",(0,r.jsx)(n.a,{href:"/node/run-your-node/maintenance/handling-network-upgrades#verify-genesis",children:"Handling Network Upgrades"})," guide."]}),"\n",(0,r.jsx)(n.li,{children:"Replace the old Mainnet Beta genesis file with the Mainnet genesis file."}),"\n",(0,r.jsx)(n.li,{children:"Stop your node."}),"\n",(0,r.jsx)(n.li,{children:"Remove the old 20.10.x version of Oasis Node."}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/node/run-your-node/maintenance/wiping-node-state#state-wipe-and-keep-node-identity",children:"Wipe state"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Update your node's configuration per instructions in ",(0,r.jsx)(n.a,{href:"/node/reference/upgrade-logs/mainnet#configuration-changes",children:"Configuration changes"})," below."]}),"\n",(0,r.jsx)(n.li,{children:"Start your node."}),"\n"]}),"\n",(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsxs)(n.p,{children:["This time, we recommend dumping the network state with the upgraded Oasis Node binary so that the genesis file will be in the ",(0,r.jsx)(n.a,{href:"/core/consensus/genesis#canonical-form",children:"canonical form"}),"."]}),(0,r.jsx)(n.p,{children:"The canonical form will make it easier to compare the obtained genesis file with the one provided by us."})]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["For more detailed instructions, see the ",(0,r.jsx)(n.a,{href:"/node/run-your-node/maintenance/handling-network-upgrades",children:"Handling Network Upgrades"})," guide."]})}),"\n",(0,r.jsx)(n.h3,{id:"configuration-changes-1",children:"Configuration changes"}),"\n",(0,r.jsxs)(n.p,{children:["Since we are upgrading to the Mainnet, we recommend you change your node's configuration and disable pruning of the consensus' state by removing the ",(0,r.jsx)(n.code,{children:"consensus.tendermint.abci.prune"})," key."]}),"\n",(0,r.jsx)(n.p,{children:"For example, this configuration:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"...\n\n# Consensus backend.\nconsensus:\n  # Setting this to true will mean that the node you're deploying will attempt\n  # to register as a validator.\n  validator: true\n\n  # Tendermint backend configuration.\n  tendermint:\n    abci:\n      prune:\n        strategy: keep_n\n        # Keep ~7 days of data since block production is ~1 block every 6 seconds.\n        # (7*24*3600/6 = 100800)\n        num_kept: 100800\n    core:\n      listen_address: tcp://0.0.0.0:26656\n\n    ...\n"})}),"\n",(0,r.jsx)(n.p,{children:"Becomes:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"...\n\n# Consensus backend.\nconsensus:\n  # Setting this to true will mean that the node you're deploying will attempt\n  # to register as a validator.\n  validator: true\n\n  # Tendermint backend configuration.\n  tendermint:\n    core:\n      listen_address: tcp://0.0.0.0:26656\n\n    ...\n"})}),"\n",(0,r.jsx)(n.h2,{id:"mainnet-beta-upgrade",children:"2020-10-01 - Mainnet Beta"}),"\n",(0,r.jsx)(n.h3,{id:"instructions-1",children:"Instructions"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Stop your node."}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/node/run-your-node/maintenance/wiping-node-state#state-wipe-and-keep-node-identity",children:"Wipe state"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Replace the old genesis file with the Mainnet Beta genesis file published in the ",(0,r.jsx)(n.a,{href:"https://github.com/oasisprotocol/mainnet-artifacts/releases/tag/2020-10-01",children:"2020-10-01 release"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Start your node."}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"You should keep using Oasis Core version 20.10."})}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["For more detailed instructions, see the ",(0,r.jsx)(n.a,{href:"/node/run-your-node/maintenance/handling-network-upgrades",children:"Handling Network Upgrades"})," guide."]})}),"\n",(0,r.jsx)(n.h2,{id:"mainnet-dry-run",children:"2020-09-22 - Mainnet Dry Run"}),"\n",(0,r.jsx)(n.h3,{id:"instructions-2",children:"Instructions"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"This is the initial deployment."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);