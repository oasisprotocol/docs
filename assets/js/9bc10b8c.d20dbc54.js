"use strict";(globalThis.webpackChunkdocs_oasis_io=globalThis.webpackChunkdocs_oasis_io||[]).push([[6723],{11470:(e,t,n)=>{n.d(t,{A:()=>k});var r=n(96540),a=n(34164),s=n(17559),i=n(23104),o=n(56347),l=n(205),c=n(57485),d=n(31682),h=n(70679);function p(e){return r.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function u(e){const{values:t,children:n}=e;return(0,r.useMemo)(()=>{const e=t??function(e){return p(e).map(({props:{value:e,label:t,attributes:n,default:r}})=>({value:e,label:t,attributes:n,default:r}))}(n);return function(e){const t=(0,d.XI)(e,(e,t)=>e.value===t.value);if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[t,n])}function m({value:e,tabValues:t}){return t.some(t=>t.value===e)}function g({queryString:e=!1,groupId:t}){const n=(0,o.W6)(),a=function({queryString:e=!1,groupId:t}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:e,groupId:t});return[(0,c.aZ)(a),(0,r.useCallback)(e=>{if(!a)return;const t=new URLSearchParams(n.location.search);t.set(a,e),n.replace({...n.location,search:t.toString()})},[a,n])]}function f(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,s=u(e),[i,o]=(0,r.useState)(()=>function({defaultValue:e,tabValues:t}){if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!m({value:e,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${t.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const n=t.find(e=>e.default)??t[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:s})),[c,d]=g({queryString:n,groupId:a}),[p,f]=function({groupId:e}){const t=function(e){return e?`docusaurus.tab.${e}`:null}(e),[n,a]=(0,h.Dv)(t);return[n,(0,r.useCallback)(e=>{t&&a.set(e)},[t,a])]}({groupId:a}),x=(()=>{const e=c??p;return m({value:e,tabValues:s})?e:null})();(0,l.A)(()=>{x&&o(x)},[x]);return{selectedValue:i,selectValue:(0,r.useCallback)(e=>{if(!m({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);o(e),d(e),f(e)},[d,f,s]),tabValues:s}}var x=n(92303);const j={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var y=n(74848);function b({className:e,block:t,selectedValue:n,selectValue:r,tabValues:s}){const o=[],{blockElementScrollPositionUntilNextRender:l}=(0,i.a_)(),c=e=>{const t=e.currentTarget,a=o.indexOf(t),i=s[a].value;i!==n&&(l(t),r(i))},d=e=>{let t=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const n=o.indexOf(e.currentTarget)+1;t=o[n]??o[0];break}case"ArrowLeft":{const n=o.indexOf(e.currentTarget)-1;t=o[n]??o[o.length-1];break}}t?.focus()};return(0,y.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":t},e),children:s.map(({value:e,label:t,attributes:r})=>(0,y.jsx)("li",{role:"tab",tabIndex:n===e?0:-1,"aria-selected":n===e,ref:e=>{o.push(e)},onKeyDown:d,onClick:c,...r,className:(0,a.A)("tabs__item",j.tabItem,r?.className,{"tabs__item--active":n===e}),children:t??e},e))})}function v({lazy:e,children:t,selectedValue:n}){const s=(Array.isArray(t)?t:[t]).filter(Boolean);if(e){const e=s.find(e=>e.props.value===n);return e?(0,r.cloneElement)(e,{className:(0,a.A)("margin-top--md",e.props.className)}):null}return(0,y.jsx)("div",{className:"margin-top--md",children:s.map((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==n}))})}function w(e){const t=f(e);return(0,y.jsxs)("div",{className:(0,a.A)(s.G.tabs.container,"tabs-container",j.tabList),children:[(0,y.jsx)(b,{...t,...e}),(0,y.jsx)(v,{...t,...e})]})}function k(e){const t=(0,x.A)();return(0,y.jsx)(w,{...e,children:p(e.children)},String(t))}},19365:(e,t,n)=>{n.d(t,{A:()=>i});n(96540);var r=n(34164);const a={tabItem:"tabItem_Ymn6"};var s=n(74848);function i({children:e,hidden:t,className:n}){return(0,s.jsx)("div",{role:"tabpanel",className:(0,r.A)(a.tabItem,n),hidden:t,children:e})}},21524:(e,t,n)=>{n.d(t,{A:()=>g});n(96540);var r=n(34164),a=n(28774),s=n(26972),i=n(53465),o=n(16654),l=(n(21312),n(51107));const c={cardContainer:"cardContainer_S8oU",cardTitle:"cardTitle_HoSo",cardDescription:"cardDescription_c27F"};var d=n(74848);function h({href:e,children:t}){return(0,d.jsx)(a.A,{href:e,className:(0,r.A)("card padding--lg",c.cardContainer),children:t})}function p({href:e,icon:t,title:n,description:a,customProps:s}){return(0,d.jsxs)(h,{href:e,children:[(0,d.jsx)(l.A,{as:"h3",className:(0,r.A)("text--truncate",c.cardTitle),title:n,children:n}),a&&(0,d.jsx)("p",{className:(0,r.A)("text--truncate",c.cardDescription),title:a,children:a}),s?.tags&&Array.isArray(s.tags)?(0,d.jsx)("div",{className:"pill",children:s.tags.map(e=>(0,d.jsx)("div",{className:"pills__item pills__item--active tag ",children:e},e))}):null]})}function u({item:e}){const t=(0,s.Nr)(e);!function(){const{selectMessage:e}=(0,i.W)()}();return t?(0,d.jsx)(p,{href:t,icon:"\ud83d\uddc3\ufe0f",title:e.label,description:e.description,customProps:e.customProps}):null}function m({item:e}){const t=(0,o.A)(e.href)?"\ud83d\udcc4\ufe0f":"\ud83d\udd17",n=(0,s.cC)(e.docId??void 0);return(0,d.jsx)(p,{href:e.href,icon:t,title:e.label,description:e.description??n?.description,customProps:e.customProps})}function g({item:e}){switch(e.type){case"link":return(0,d.jsx)(m,{item:e});case"category":return(0,d.jsx)(u,{item:e});default:throw new Error(`unknown item type ${JSON.stringify(e)}`)}}},28453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>o});var r=n(96540);const a={},s=r.createContext(a);function i(e){const t=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),r.createElement(s.Provider,{value:t},e.children)}},53465:(e,t,n)=>{n.d(t,{W:()=>c});var r=n(96540),a=n(44586);const s=["zero","one","two","few","many","other"];function i(e){return s.filter(t=>e.includes(t))}const o={locale:"en",pluralForms:i(["one","other"]),select:e=>1===e?"one":"other"};function l(){const{i18n:{currentLocale:e}}=(0,a.A)();return(0,r.useMemo)(()=>{try{return function(e){const t=new Intl.PluralRules(e);return{locale:e,pluralForms:i(t.resolvedOptions().pluralCategories),select:e=>t.select(e)}}(e)}catch(t){return console.error(`Failed to use Intl.PluralRules for locale "${e}".\nDocusaurus will fallback to the default (English) implementation.\nError: ${t.message}\n`),o}},[e])}function c(){const e=l();return{selectMessage:(t,n)=>function(e,t,n){const r=e.split("|");if(1===r.length)return r[0];r.length>n.pluralForms.length&&console.error(`For locale=${n.locale}, a maximum of ${n.pluralForms.length} plural forms are expected (${n.pluralForms.join(",")}), but the message contains ${r.length}: ${e}`);const a=n.select(t),s=n.pluralForms.indexOf(a);return r[Math.min(s,r.length-1)]}(n,t,e)}}},56116:(e,t,n)=>{n.d(t,{$:()=>i});var r=n(23025),a=n(44586);function s(e){for(const t of e){const e=t.href;e&&void 0===globalThis.sidebarItemsMap[e]&&(globalThis.sidebarItemsMap[e]=t),"category"===t.type&&s(t.items)}}function i(e){const{siteConfig:t,siteMetadata:n}=(0,a.A)(),i=(0,r.r)();if(!i)throw new Error("Unexpected: cant find docsVersion in current context");if(void 0===globalThis.sidebarItemsMap){globalThis.sidebarItemsMap={};for(const e in i.docsSidebars)s(i.docsSidebars[e])}if(void 0===globalThis.sidebarItemsMap[e]){if(console.log(`Item ${e} not found. Registered sidebar items:`),console.log(globalThis.sidebarItemsMap),"throw"==t.onBrokenMarkdownLinks)throw new Error(`Unexpected: sidebar item with href ${e} does not exist.`);return globalThis.sidebarItemsMap["/general/"]}return globalThis.sidebarItemsMap[e]}},63230:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>h,default:()=>g,frontMatter:()=>d,metadata:()=>r,toc:()=>u});const r=JSON.parse('{"id":"build/sapphire/quickstart","title":"Quickstart","description":"In this tutorial, you will build and deploy a unique dApp that requires","source":"@site/docs/build/sapphire/quickstart.mdx","sourceDirName":"build/sapphire","slug":"/build/sapphire/quickstart","permalink":"/build/sapphire/quickstart","draft":false,"unlisted":false,"editUrl":"https://github.com/oasisprotocol/sapphire-paratime/edit/main/docs/quickstart.mdx","tags":[],"version":"current","lastUpdatedAt":1760874442000,"frontMatter":{"sidebar_custom_props":{}},"sidebar":"developers","previous":{"title":"Sapphire ParaTime","permalink":"/build/sapphire/"},"next":{"title":"Network information","permalink":"/build/sapphire/network"}}');var a=n(74848),s=n(28453),i=n(11470),o=n(19365),l=n(21524),c=n(56116);const d={sidebar_custom_props:{tags:void 0}},h="Quickstart",p={},u=[{value:"Create a Sapphire-Native dApp",id:"create-a-sapphire-native-dapp",level:2},{value:"Init a new Hardhat project",id:"init-a-new-hardhat-project",level:3},{value:"Add the Sapphire Testnet to Hardhat",id:"add-the-sapphire-testnet-to-hardhat",level:3},{value:"Get some Sapphire Testnet tokens",id:"get-some-sapphire-testnet-tokens",level:3},{value:"Get the Contract",id:"get-the-contract",level:3},{value:"Vigil.sol, the interesting parts",id:"vigilsol-the-interesting-parts",level:4},{value:"Add the Tasks",id:"add-the-tasks",level:3},{value:"Run the Contract",id:"run-the-contract",level:3},{value:"All done!",id:"all-done",level:2},{value:"See also",id:"see-also",level:2}];function m(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components},{Details:n}=t;return n||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"quickstart",children:"Quickstart"})}),"\n",(0,a.jsx)("p",{style:{width:"100%"},children:(0,a.jsx)("iframe",{style:{margin:"auto",display:"block"},width:"560",height:"315",src:"https://www.youtube-nocookie.com/embed/-Qnsoo4loxg",title:"Tutorial: Create a Sapphire Native dApp",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0})}),"\n",(0,a.jsx)(t.p,{children:"In this tutorial, you will build and deploy a unique dApp that requires\nconfidentiality to work. By the end of the tutorial, you should feel\ncomfortable setting up your EVM development environment to target Sapphire,\nand know how and when to use confidentiality."}),"\n",(0,a.jsx)(t.p,{children:"The expected completion time of this tutorial is 15 minutes."}),"\n",(0,a.jsx)(t.h2,{id:"create-a-sapphire-native-dapp",children:"Create a Sapphire-Native dApp"}),"\n",(0,a.jsxs)(t.p,{children:["Porting an existing EVM app is cool, and will provide benefits such as\nprotection against MEV.\nHowever, starting from scratch with confidentiality in mind can unlock some\nreally novel dApps and provide a ",(0,a.jsx)(t.a,{href:"/build/sapphire/develop/",children:"higher level of security"}),"."]}),"\n",(0,a.jsxs)(t.p,{children:["One simple-but-useful dApp that takes advantage of confidentiality is a\n",(0,a.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Dead_man%27s_switch",children:"dead person's switch"})," that reveals a secret (let's say the encryption key to a\ndata trove) if the operator fails to re-up before too long.\nLet's make it happen!"]}),"\n",(0,a.jsx)(t.h3,{id:"init-a-new-hardhat-project",children:"Init a new Hardhat project"}),"\n",(0,a.jsxs)(t.p,{children:["We're going to use Hardhat with TypeScript which relies on NodeJS, but Sapphire\nshould be compatible with your dev environment of choice. See examples in\n",(0,a.jsx)(t.a,{href:"https://github.com/oasisprotocol/demo-starter-go",children:"Go"})," and\n",(0,a.jsx)(t.a,{href:"https://github.com/oasisprotocol/demo-starter-py",children:"Python"})," at the end of this chapter. Let us\nknow if things are not as expected!"]}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"Make & enter a new directory:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sh",children:"mkdir quickstart && cd quickstart\n"})}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"Create a TypeScript project and install the project dependencies:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sh",children:"npx hardhat init\n"})}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:["Add ",(0,a.jsx)(t.a,{href:"https://www.npmjs.com/package/@oasisprotocol/sapphire-hardhat",children:(0,a.jsx)(t.code,{children:"@oasisprotocol/sapphire-hardhat"})})," as dependency:"]}),"\n",(0,a.jsxs)(i.A,{groupId:"npm2yarn",children:[(0,a.jsx)(o.A,{value:"npm",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-shell",children:"npm install -D @oasisprotocol/sapphire-hardhat\n"})})}),(0,a.jsx)(o.A,{value:"pnpm",label:"pnpm",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-shell",children:"pnpm add -D @oasisprotocol/sapphire-hardhat\n"})})}),(0,a.jsx)(o.A,{value:"yarn",label:"Yarn",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-shell",children:"yarn add --dev @oasisprotocol/sapphire-hardhat\n"})})})]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(t.h3,{id:"add-the-sapphire-testnet-to-hardhat",children:"Add the Sapphire Testnet to Hardhat"}),"\n",(0,a.jsxs)(t.p,{children:["Open up your ",(0,a.jsx)(t.code,{children:"hardhat.config.ts"})," and import ",(0,a.jsx)(t.code,{children:"sapphire-hardhat"}),"."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-typescript",metastring:"{2}",children:'import { HardhatUserConfig } from "hardhat/config";\nimport "@oasisprotocol/sapphire-hardhat";\nimport "@nomicfoundation/hardhat-toolbox";\nimport "./tasks";\n\nconst accounts = process.env.PRIVATE_KEY ? [process.env.PRIVATE_KEY] : {\n  mnemonic: "test test test test test test test test test test test junk",\n  path: "m/44\'/60\'/0\'/0",\n  initialIndex: 0,\n  count: 20,\n  passphrase: "",\n};\n'})}),"\n",(0,a.jsxs)(t.p,{children:["By importing ",(0,a.jsx)(t.code,{children:"@oasisprotocol/sapphire-hardhat"}),", ",(0,a.jsx)(t.strong,{children:"any network config entry\ncorresponding to the Sapphire's chain ID will automatically be wrapped with\nSapphire specifics for encrypting and signing the transactions"}),"."]}),"\n",(0,a.jsx)(t.p,{children:"Next, let's add an account with a private key from an environment variable:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-typescript",metastring:"{6-12}",children:'import { HardhatUserConfig } from "hardhat/config";\nimport "@oasisprotocol/sapphire-hardhat";\nimport "@nomicfoundation/hardhat-toolbox";\nimport "./tasks";\n\nconst accounts = process.env.PRIVATE_KEY ? [process.env.PRIVATE_KEY] : {\n  mnemonic: "test test test test test test test test test test test junk",\n  path: "m/44\'/60\'/0\'/0",\n  initialIndex: 0,\n  count: 20,\n  passphrase: "",\n};\n'})}),"\n",(0,a.jsxs)(t.p,{children:["Finally, let's add the ",(0,a.jsx)(t.a,{href:"/build/sapphire/network",children:"Sapphire Testnet"})," network to the network property of\n",(0,a.jsx)(t.code,{children:"HardhatUserConfig"}),":"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-typescript",metastring:"{4-19}",children:'const config: HardhatUserConfig = {\n  solidity: "0.8.28",\n  networks: {\n    sapphire: {\n      url: "https://sapphire.oasis.io",\n      chainId: 0x5afe,\n      accounts,\n    },\n    "sapphire-testnet": {\n      url: "https://testnet.sapphire.oasis.io",\n      accounts,\n      chainId: 0x5aff,\n    },\n    "sapphire-localnet": {\n      // docker run -it -p8544-8548:8544-8548 ghcr.io/oasisprotocol/sapphire-localnet\n      url: "http://localhost:8545",\n      chainId: 0x5afd,\n      accounts,\n    },\n  },\n};\n'})}),"\n",(0,a.jsx)(t.h3,{id:"get-some-sapphire-testnet-tokens",children:"Get some Sapphire Testnet tokens"}),"\n",(0,a.jsxs)(t.p,{children:["Now for the fun part. As you have configured the Sapphire Test network, get\nsome native TEST tokens. Hit up the one and only ",(0,a.jsx)(t.a,{href:"https://faucet.testnet.oasis.io",children:"Oasis Testnet faucet"}),', select\n"Sapphire" and enter your wallet address. Submit the form and TEST be on your\nway.']}),"\n",(0,a.jsx)(t.h3,{id:"get-the-contract",children:"Get the Contract"}),"\n",(0,a.jsxs)(t.p,{children:["This is a Sapphire tutorial and you're already a Solidity expert, so let's not\nbore you with explaining the gritty details of the contract.\nStart by pasting ",(0,a.jsx)(t.code,{children:"Vigil.sol"})," into ",(0,a.jsx)(t.code,{children:"contracts/Vigil.sol"}),"."]}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:["Create a new file called ",(0,a.jsx)(t.code,{children:"Vigil.sol"})," under ",(0,a.jsx)(t.code,{children:"contracts/"}),":"]}),"\n",(0,a.jsx)(t.li,{children:"Paste the following contract into it:"}),"\n"]}),"\n",(0,a.jsxs)(n,{children:[(0,a.jsx)("summary",{children:" Vigil.sol contract "}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-solidity",children:'// SPDX-License-Identifier: MIT\npragma solidity ^0.8.9;\n\ncontract Vigil {\n    struct SecretMetadata {\n        address creator;\n        string name;\n        /// @notice How long (in seconds) the secret should remain so past the creator\'s last update.\n        uint256 longevity;\n    }\n\n    event SecretCreated(\n        address indexed creator,\n        string indexed name,\n        uint256 index\n    );\n\n    SecretMetadata[] public _metas;\n    bytes[] private _secrets;\n    /// @dev The unix timestamp at which the address was last seen.\n    mapping(address => uint256) public _lastSeen;\n\n    function createSecret(\n        string calldata name,\n        uint256 longevity,\n        bytes calldata secret\n    ) external {\n        _updateLastSeen();\n        _metas.push(\n            SecretMetadata({\n                creator: msg.sender,\n                name: name,\n                longevity: longevity\n            })\n        );\n        _secrets.push(secret);\n        emit SecretCreated(msg.sender, name, _metas.length - 1);\n    }\n\n    /// Reveal the secret at the specified index.\n    function revealSecret(uint256 index) external view returns (bytes memory) {\n        require(index < _metas.length, "no such secret");\n        address creator = _metas[index].creator;\n        uint256 expiry = _lastSeen[creator] + _metas[index].longevity;\n        require(block.timestamp >= expiry, "not expired");\n        return _secrets[index];\n    }\n\n    /// Return the time (in seconds since the epoch) at which the owner was last seen, or zero if never seen.\n    function getLastSeen(address owner) external view returns (uint256) {\n        return _lastSeen[owner];\n    }\n\n    function getMetas(uint256 offset, uint256 count)\n        external\n        view\n        returns (SecretMetadata[] memory)\n    {\n        if (offset >= _metas.length) return new SecretMetadata[](0);\n        uint256 c = offset + count <= _metas.length\n            ? count\n            : _metas.length - offset;\n        SecretMetadata[] memory metas = new SecretMetadata[](c);\n        for (uint256 i = 0; i < c; ++i) {\n            metas[i] = _metas[offset + i];\n        }\n        return metas;\n    }\n\n    function refreshSecrets() external {\n        _updateLastSeen();\n    }\n\n    function _updateLastSeen() internal {\n        _lastSeen[msg.sender] = block.timestamp;\n    }\n}\n'})})]}),"\n",(0,a.jsx)(t.h4,{id:"vigilsol-the-interesting-parts",children:"Vigil.sol, the interesting parts"}),"\n",(0,a.jsx)(t.p,{children:"The key state variables are:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-solidity",children:"    SecretMetadata[] public _metas;\n    bytes[] private _secrets;\n"})}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"_metas"})," is marked with ",(0,a.jsx)(t.code,{children:"public"})," visibility, so despite the state itself being\nencrypted and not readable directly, Solidity will generate a getter that will\ndo the decryption for you."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"_secrets"})," is ",(0,a.jsx)(t.code,{children:"private"})," and therefore truly secret; only the contract can\naccess the data contained in this mapping."]}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"And the methods we'll care most about are"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"createSecret"}),", which adds an entry to both ",(0,a.jsx)(t.code,{children:"_metas"})," and ",(0,a.jsx)(t.code,{children:"_secrets"}),"."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.code,{children:"revealSecret"}),", which acts as an access-controlled getter for the data\ncontained with ",(0,a.jsx)(t.code,{children:"_secrets"}),". Due to trusted execution and confidentiality, the\nonly way that the secret will get revealed is if execution proceeds all the\nway to the end of the function and does not revert."]}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"The rest of the methods are useful if you actually intended to use the contract,\nbut they demonstrate that developing for Sapphire is essentially the same as for\nEthereum. You can even write tests against the Hardhat network and use Hardhat\nplugins."}),"\n",(0,a.jsx)(t.h3,{id:"add-the-tasks",children:"Add the Tasks"}),"\n",(0,a.jsxs)(t.p,{children:["We will use ",(0,a.jsx)(t.a,{href:"https://hardhat.org/hardhat-runner/docs/guides/tasks",children:"Hardhat tasks"})," to automate the deployment and testing of the\nVigil contract."]}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:["Create a new file called ",(0,a.jsx)(t.code,{children:"index.ts"})," under ",(0,a.jsx)(t.code,{children:"tasks/"}),":"]}),"\n",(0,a.jsxs)(t.li,{children:["Paste the following tasks to the ",(0,a.jsx)(t.code,{children:"tasks/index.ts"}),":"]}),"\n"]}),"\n",(0,a.jsxs)(n,{children:[(0,a.jsx)("summary",{children:" tasks/index.ts "}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-typescript",children:'import { task } from "hardhat/config";\n\ntask("deploy").setAction(async (_args, hre) => {\n  const Vigil = await hre.ethers.getContractFactory("Vigil");\n  const vigil = await Vigil.deploy();\n  const vigilAddr = await vigil.waitForDeployment();\n\n  console.log(`Vigil address: ${vigilAddr.target}`);\n  return vigilAddr.target;\n});\n\ntask("create-secret")\n  .addParam("address", "contract address")\n  .setAction(async (args, hre) => {\n    const vigil = await hre.ethers.getContractAt("Vigil", args.address);\n\n    const tx = await vigil.createSecret(\n      "ingredient",\n      30 /* seconds */,\n      Buffer.from("brussels sprouts"),\n    );\n    console.log("Storing a secret in", tx.hash);\n  });\n\ntask("check-secret")\n  .addParam("address", "contract address")\n  .setAction(async (args, hre) => {\n    const vigil = await hre.ethers.getContractAt("Vigil", args.address);\n\n    try {\n      console.log("Checking the secret");\n      await vigil.revealSecret(0);\n      console.log("Uh oh. The secret was available!");\n      process.exit(1);\n    } catch (e: any) {\n      console.log("failed to fetch secret:", e.message);\n    }\n    console.log("Waiting...");\n\n    await new Promise((resolve) => setTimeout(resolve, 30_000));\n    console.log("Checking the secret again");\n    const secret = await vigil.revealSecret.staticCallResult(0); // Get the value.\n    console.log(\n      "The secret ingredient is",\n      Buffer.from(secret[0].slice(2), "hex").toString(),\n    );\n  });\n\ntask("full-vigil").setAction(async (_args, hre) => {\n  await hre.run("compile");\n\n  const address = await hre.run("deploy");\n\n  await hre.run("create-secret", { address });\n  await hre.run("check-secret", { address });\n});\n'})})]}),"\n",(0,a.jsxs)(t.ol,{start:"3",children:["\n",(0,a.jsxs)(t.li,{children:["Import the tasks inside ",(0,a.jsx)(t.code,{children:"hardhat.config.ts"}),":"]}),"\n"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-typescript",metastring:"{4}",children:'import { HardhatUserConfig } from "hardhat/config";\nimport "@oasisprotocol/sapphire-hardhat";\nimport "@nomicfoundation/hardhat-toolbox";\nimport "./tasks";\n\nconst accounts = process.env.PRIVATE_KEY ? [process.env.PRIVATE_KEY] : {\n  mnemonic: "test test test test test test test test test test test junk",\n  path: "m/44\'/60\'/0\'/0",\n  initialIndex: 0,\n  count: 20,\n  passphrase: "",\n};\n'})}),"\n",(0,a.jsx)(t.h3,{id:"run-the-contract",children:"Run the Contract"}),"\n",(0,a.jsxs)(t.p,{children:["And to wrap things up, we'll put ",(0,a.jsx)(t.code,{children:"Vigil"})," through its paces.\nFirst, let's see what's actually going on."]}),"\n",(0,a.jsx)(t.p,{children:"After deploying the contract, we can create a secret, check that it's not\nreadable, wait a bit, and then check that it has become readable.\nPretty cool if you ask me!"}),"\n",(0,a.jsx)(t.p,{children:"Anyway, make it happen by running"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-shell",children:'PRIVATE_KEY="0x..." npx hardhat full-vigil --network sapphire-testnet\n'})}),"\n",(0,a.jsx)(t.p,{children:"And if you see something like the following, you'll know you're well on the road\nto deploying confidential dApps on Sapphire."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:"Vigil deployed to: 0x74dC4879B152FDD1DDe834E9ba187b3e14f462f1\nStoring a secret in 0x13125d868f5fb3cbc501466df26055ea063a90014b5ccc8dfd5164dc1dd67543\nChecking the secret\nfailed to fetch secret: reverted: not expired\nWaiting...\nChecking the secret again\nThe secret ingredient is brussels sprouts\n"})}),"\n",(0,a.jsx)(t.h2,{id:"all-done",children:"All done!"}),"\n",(0,a.jsxs)(t.p,{children:["Congratulations, you made it through the Sapphire tutorial! If you want to dive\ndeeper, please check out the ",(0,a.jsx)(t.a,{href:"/build/sapphire/develop/",children:"develop"})," chapter and join the discussion on the\n",(0,a.jsx)(t.a,{href:"/get-involved/#social-media-channels",children:"#dev-central Discord channel"}),"."]}),"\n",(0,a.jsx)(t.p,{children:"Best of luck on your future forays into confidentiality!"}),"\n",(0,a.jsx)(t.admonition,{title:"Example: Hardhat",type:"info",children:(0,a.jsxs)(t.p,{children:["Visit the Sapphire ParaTime repository to download the ",(0,a.jsx)(t.a,{href:"https://github.com/oasisprotocol/sapphire-paratime/tree/main/examples/hardhat",children:"Hardhat"}),"\nexample of this quickstart."]})}),"\n",(0,a.jsx)(t.admonition,{title:"Example: Starter project",type:"info",children:(0,a.jsxs)(t.p,{children:["If your project involves building a web frontend, we recommend that you check\nout the official ",(0,a.jsx)(t.a,{href:"https://github.com/oasisprotocol/demo-starter",children:"Oasis starter"})," files."]})}),"\n",(0,a.jsx)(t.admonition,{title:"Example: Go and Python",type:"info",children:(0,a.jsxs)(t.p,{children:["Are you building your dApp in languages other than TypeScript? Check out the\nofficial ",(0,a.jsx)(t.a,{href:"https://github.com/oasisprotocol/demo-starter-go",children:"Oasis starter project for Go"})," and the ",(0,a.jsx)(t.a,{href:"https://github.com/oasisprotocol/demo-starter-py",children:"Oasis starter project for Python"}),"."]})}),"\n",(0,a.jsx)(t.h2,{id:"see-also",children:"See also"}),"\n",(0,a.jsx)(l.A,{item:(0,c.$)("/build/sapphire/develop/browser")}),"\n",(0,a.jsx)(l.A,{item:(0,c.$)("/node/run-your-node/paratime-client-node")}),"\n",(0,a.jsx)(l.A,{item:(0,c.$)("/node/web3")})]})}function g(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(m,{...e})}):m(e)}}}]);