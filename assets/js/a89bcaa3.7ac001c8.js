"use strict";(globalThis.webpackChunkdocs_oasis_io=globalThis.webpackChunkdocs_oasis_io||[]).push([[9689],{28453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>l});var a=s(96540);const o={},r=a.createContext(o);function t(e){const n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),a.createElement(r.Provider,{value:n},e.children)}},68211:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>i,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"adrs/0016-consensus-parameters-change-proposal","title":"ADR 0016: Consensus Parameters Change Proposal","description":"Component","source":"@site/docs/adrs/0016-consensus-parameters-change-proposal.md","sourceDirName":"adrs","slug":"/adrs/0016-consensus-parameters-change-proposal","permalink":"/adrs/0016-consensus-parameters-change-proposal","draft":false,"unlisted":false,"editUrl":"https://github.com/oasisprotocol/adrs/edit/main/0016-consensus-parameters-change-proposal.md","tags":[],"version":"current","lastUpdatedAt":1754295238000,"frontMatter":{"sidebar_custom_props":{}},"sidebar":"adrs","previous":{"title":"ADR 0015: Randomized Paratime Proposer Selection","permalink":"/adrs/0015-vrf-per-block-entropy"},"next":{"title":"ADR 0017: ParaTime Application Standard Proposal Process","permalink":"/adrs/0017-app-standards"}}');var o=s(74848),r=s(28453);const t={sidebar_custom_props:{tags:void 0}},l="ADR 0016: Consensus Parameters Change Proposal",i={},d=[{value:"Component",id:"component",level:2},{value:"Changelog",id:"changelog",level:2},{value:"Status",id:"status",level:2},{value:"Context",id:"context",level:2},{value:"Decision",id:"decision",level:2},{value:"Implementation",id:"implementation",level:2},{value:"New proposal",id:"new-proposal",level:3},{value:"Parameter changes",id:"parameter-changes",level:3},{value:"Submission",id:"submission",level:3},{value:"Execution",id:"execution",level:3},{value:"How to enable the new proposal",id:"how-to-enable-the-new-proposal",level:3},{value:"Consequences",id:"consequences",level:2},{value:"Positive",id:"positive",level:3},{value:"Negative",id:"negative",level:3},{value:"Neutral",id:"neutral",level:3},{value:"References",id:"references",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"adr-0016-consensus-parameters-change-proposal",children:"ADR 0016: Consensus Parameters Change Proposal"})}),"\n",(0,o.jsx)(n.h2,{id:"component",children:"Component"}),"\n",(0,o.jsx)(n.p,{children:"Oasis Core"}),"\n",(0,o.jsx)(n.h2,{id:"changelog",children:"Changelog"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"2022-09-15: Initial version"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"status",children:"Status"}),"\n",(0,o.jsx)(n.p,{children:"Proposed"}),"\n",(0,o.jsx)(n.h2,{id:"context",children:"Context"}),"\n",(0,o.jsx)(n.p,{children:"Currently consensus parameters can only be changed with an upgrade governance\nproposal which is effective but not very efficient. Upgrades require downtime\nduring which binaries need to be updated, nodes restarted and synced, consensus\nnetwork version has to be increased etc. We would like to avoid this cumbersome\nprocedure and change the parameters of a consensus module as fast and as simple\nas possible without affecting the performance of the consensus layer."}),"\n",(0,o.jsx)(n.h2,{id:"decision",children:"Decision"}),"\n",(0,o.jsx)(n.p,{children:"Implement governance proposal which changes consensus parameters only."}),"\n",(0,o.jsx)(n.h2,{id:"implementation",children:"Implementation"}),"\n",(0,o.jsx)(n.h3,{id:"new-proposal",children:"New proposal"}),"\n",(0,o.jsxs)(n.p,{children:["A new type of governance proposal named ",(0,o.jsx)(n.code,{children:"ChangeParametersProposal"})," should be\nadded to the consensus layer. The proposal should contain two non-empty fields:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["the name of the consensus ",(0,o.jsx)(n.code,{children:"Module"})," the changes should be applied to, and,"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["a CBOR-encoded document ",(0,o.jsx)(n.code,{children:"Changes"})," describing parameter changes."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-golang",children:'// ChangeParametersProposal is a consensus parameters change proposal.\ntype ChangeParametersProposal struct {\n  // Module identifies the consensus backend module to which changes should be\n  // applied.\n  Module string `json:"module"`\n  // Changes are consensus parameter changes that should be applied to\n  // the module.\n  Changes cbor.RawMessage `json:"changes"`\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Both fields should be validated before proposal submission to avoid having\ninvalid proposals with empty fields. A more in-depth validation should be done\nby consensus modules during submission to ensure that the encoded ",(0,o.jsx)(n.code,{children:"Changes"})," are\ncomplete and well-formed and that there is exactly one module to which changes\nwill be applied."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-golang",children:"// ValidateBasic performs a basic validation on the change parameters proposal.\nfunc (p *ChangeParametersProposal) ValidateBasic() error {\n  // Validate that both fields are set.\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["The new proposal should be added to the ",(0,o.jsx)(n.code,{children:"ProposalContent"}),". The extension should\nstill allow only one proposal at a time, so we must not forget to update\nthe code responsible for validation."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-golang",children:'type ProposalContent struct {\n  ...\n  ChangeParameters *ChangeParametersProposal `json:"change_parameters,omitempty"`\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"parameter-changes",children:"Parameter changes"}),"\n",(0,o.jsx)(n.p,{children:"Each consensus module should carefully scope which parameters are allowed to\nbe changed. For example, a governance module could allow changing only the gas\ncosts and the voting period, while the staking module would allow changing\nall parameters."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-golang",children:'// ConsensusParameterChanges define allowed governance consensus parameter\n// changes.\ntype ConsensusParameterChanges struct {\n  // GasCosts are the new gas costs.\n  GasCosts *transaction.Costs `json:"gas_costs,omitempty"`\n  // VotingPeriod is the new voting period.\n  VotingPeriod *beacon.EpochTime `json:"voting_period,omitempty"`\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["To prevent invalid proposals being submitted, ",(0,o.jsx)(n.code,{children:"ConsensusParameterChanges"}),"\nshould expose validation method which can be used to check if changes are\nvalid (e.g. changes are not empty, parameters have the right ranges)."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-golang",children:"// SanityCheck performs a sanity check on the consensus parameters changes.\nfunc (c *ConsensusParameterChanges) SanityCheck() error {\n  // Validate changes.\n}\n"})}),"\n",(0,o.jsx)(n.p,{children:"How changes are executed is up to the module implementation."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-golang",children:"// Apply applies changes to the given consensus parameters.\nfunc (c *ConsensusParameterChanges) Apply(params *ConsensusParameters) error {\n   // Apply changes.\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"submission",children:"Submission"}),"\n",(0,o.jsxs)(n.p,{children:["When a new ",(0,o.jsx)(n.code,{children:"ChangeParametersProposal"})," is submitted a basic validation is\nperformed first which checks whether the ",(0,o.jsx)(n.code,{children:"Module"})," name and ",(0,o.jsx)(n.code,{children:"Changes"})," are set\ncorrectly. Afterwards, a validation message is broadcasted to all modules\nrequesting them to validate the proposal. Only the module for which ",(0,o.jsx)(n.code,{children:"Changes"}),"\nare intended should act and reply to the message, other modules should silently\nignore it. In case no module replies, the proposal is immediately rejected\nas not being supported."]}),"\n",(0,o.jsxs)(n.p,{children:["The module should carefully examine the proposal, check whether the proposal\nis well-formed, ",(0,o.jsx)(n.code,{children:"Changes"})," are not empty and deserialize correctly to the\nexpected format, deserialized parameter changes are valid etc. If all checks\nsucceed, the module should respond with a confirmation message. Otherwise,\nan error describing why proposal is invalid should be returned as a response."]}),"\n",(0,o.jsx)(n.p,{children:"Note: Validation at this stage cannot always be complete as valid parameter\nvalues are not necessary independent of each other. If multiple proposals are\nbeing executed at the same time, the resulting parameters can be invalid even\nthough validation of each proposal passed. Therefore, another validation\nis required when the proposal is about to be executed."}),"\n",(0,o.jsx)(n.h3,{id:"execution",children:"Execution"}),"\n",(0,o.jsxs)(n.p,{children:["If ",(0,o.jsx)(n.code,{children:"ChangeParametersProposal"})," closes as accepted (vote passed), the governance\nmodule will execute the proposal by broadcasting a message containing\nthe proposal to all modules. Notification can be done using the same message\ndispatch mechanism as in the submission phase. Once messages are delivered,\nonly one module will act and try to apply ",(0,o.jsx)(n.code,{children:"Changes"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["That module should first fetch current consensus parameters, then apply\nproposed ",(0,o.jsx)(n.code,{children:"Changes"})," and finally validate the result. Validation of parameters\nis necessary as mentioned in the submission phase. If validation succeeds,\nthe consensus parameters are updated and proposal is marked as passed.\nOtherwise, the proposal is marked as failed and the proposed parameter\nchanges are discarded."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-golang",children:"// SanityCheck performs a sanity check on the consensus parameters.\nfunc (p *ConsensusParameters) SanityCheck() error {\n   // Validate parameters.\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"how-to-enable-the-new-proposal",children:"How to enable the new proposal"}),"\n",(0,o.jsx)(n.p,{children:"Adding a new proposal type is a consensus breaking change. To make it\nnon-breaking we introduce a new governance consensus parameter which disables\nthe new type by default and can be enabled via governance. When disabled,\nthe governance module will treat the new proposal type as invalid, thus not\nviolating the consensus."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-golang",children:'type ConsensusParameters struct {\n  ...\n  // EnableChangeParametersProposal is true iff change parameters proposals are\n  // allowed.\n  EnableChangeParametersProposal bool `json:"enable_change_parameters_proposal,omitempty"`\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"consequences",children:"Consequences"}),"\n",(0,o.jsx)(n.h3,{id:"positive",children:"Positive"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Agile and zero-downtime consensus parameter changes."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Separation of consensus parameter changes and consensus upgrades."}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"negative",children:"Negative"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Introduction of a new governance consensus parameter which enables new\nproposals in the upgrade handler. New parameters can always be considered\nas a minor disadvantage as they usually increase the complexity of the code."}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"neutral",children:"Neutral"}),"\n",(0,o.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,o.jsx)(n.p,{children:"No references."})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}}}]);