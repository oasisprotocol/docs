"use strict";(globalThis.webpackChunkdocs_oasis_io=globalThis.webpackChunkdocs_oasis_io||[]).push([[8607],{10715:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>l,frontMatter:()=>i,metadata:()=>t,toc:()=>u});const t=JSON.parse('{"id":"node/run-your-node/advanced/pruning","title":"Pruning State","description":"To reduce hardware requirements and improve the overall latency of the node,","source":"@site/docs/node/run-your-node/advanced/pruning.md","sourceDirName":"node/run-your-node/advanced","slug":"/node/run-your-node/advanced/pruning","permalink":"/node/run-your-node/advanced/pruning","draft":false,"unlisted":false,"editUrl":"https://github.com/oasisprotocol/docs/edit/main/docs/node/run-your-node/advanced/pruning.md","tags":[],"version":"current","lastUpdatedAt":1769514538000,"frontMatter":{"sidebar_custom_props":{}},"sidebar":"operators","previous":{"title":"Using State Sync for Quick Bootstrapping","permalink":"/node/run-your-node/advanced/sync-node-using-state-sync"},"next":{"title":"Copy State from One Node to the Other","permalink":"/node/run-your-node/advanced/copy-state-from-one-node-to-the-other"}}');var o=r(74848),s=r(28453);const i={sidebar_custom_props:{tags:void 0}},a="Pruning State",d={},u=[{value:"Consensus Pruning",id:"consensus-pruning",level:2},{value:"Suggested Pruning Configuration",id:"suggested-pruning-configuration",level:3},{value:"Late Pruning",id:"late-pruning",level:3},{value:"ParaTime Pruning",id:"paratime-pruning",level:2},{value:"Suggested Pruning Configuration",id:"suggested-pruning-configuration-1",level:3}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"pruning-state",children:"Pruning State"})}),"\n",(0,o.jsx)(n.p,{children:"To reduce hardware requirements and improve the overall latency of the node,\noperators are encouraged to prune their state (unless also serving historical\nstate)."}),"\n",(0,o.jsx)(n.p,{children:"As will be explained in the following sections, pruning should be configured from\nthe start, i.e. late changes to the pruning configuration may not be optimal for\nthe node's health."}),"\n",(0,o.jsx)(n.h2,{id:"consensus-pruning",children:"Consensus Pruning"}),"\n",(0,o.jsx)(n.p,{children:"To configure pruning of the consensus data amend your node's configuration with:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'# ... sections not relevant are omitted ...\nconsensus:\n    # ... sections not relevant are omitted ...\n    prune:\n        strategy: "keep_n"\n        num_kept:  <n>\n'})}),"\n",(0,o.jsxs)(n.p,{children:["where ",(0,o.jsx)(n.code,{children:"<n>"})," is the number of blocks and state versions that will be kept."]}),"\n",(0,o.jsx)(n.h3,{id:"suggested-pruning-configuration",children:"Suggested Pruning Configuration"}),"\n",(0,o.jsxs)(n.p,{children:["For normal node operation, the minimum requirements is ",(0,o.jsx)(n.code,{children:"n=250_000"}),". However,\nit is recommended to set it to ",(0,o.jsx)(n.code,{children:"n=400_000"}),". Assuming blocks are produced every 6\nseconds, the latter corresponds to preserving 1 month of the consensus data."]}),"\n",(0,o.jsxs)(n.p,{children:["Operators that are not resource-restrained and want to contribute to the overall\nnetwork health are encouraged to set ",(0,o.jsx)(n.code,{children:"n=5_000_000"})," (approximately 1 year of data)."]}),"\n",(0,o.jsx)(n.h3,{id:"late-pruning",children:"Late Pruning"}),"\n",(0,o.jsxs)(n.p,{children:["Due to the ",(0,o.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Log-structured_merge-tree",children:"LSM Tree"})," design of the underlying databases, enabling pruning after\nyour node has been running for a while, or changing configuration to retain less data,\nmay not work as expected."]}),"\n",(0,o.jsx)(n.p,{children:"To change pruning configuration operators must follow this steps:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Gracefuly shutdown the node (validators should take ",(0,o.jsx)(n.a,{href:"/node/run-your-node/maintenance/shutting-down-a-node",children:"special care"}),")."]}),"\n",(0,o.jsxs)(n.li,{children:["Configure pruning as described in the ",(0,o.jsx)(n.a,{href:"#consensus-pruning",children:"Consensus Pruning"})," section above."]}),"\n",(0,o.jsxs)(n.li,{children:["Run offline ",(0,o.jsx)(n.a,{href:"/core/oasis-node/cli#prune-experimental",children:"pruning command"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["Run the ",(0,o.jsx)(n.a,{href:"/core/oasis-node/cli#compact-experimental",children:"compaction command"}),"."]}),"\n",(0,o.jsx)(n.li,{children:"Start the node again."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"paratime-pruning",children:"ParaTime Pruning"}),"\n",(0,o.jsx)(n.p,{children:"To configure pruning of the ParaTime data amend your node's configuration with:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'# ... sections not relevant are omitted ...\nruntime:\n    # ... sections not relevant are omitted ...\n    prune:\n        strategy: "keep_last"\n        num_kept:  <n>\n'})}),"\n",(0,o.jsxs)(n.p,{children:["where ",(0,o.jsx)(n.code,{children:"<n>"})," is the number of ParaTime's state versions that will be kept."]}),"\n",(0,o.jsx)(n.h3,{id:"suggested-pruning-configuration-1",children:"Suggested Pruning Configuration"}),"\n",(0,o.jsxs)(n.p,{children:["ParaTime state is much larger than the consensus state. As a consequence, as the\nnumber of versions in the state database grows, pruning becomes slower and slower.\nFor this reason ",(0,o.jsx)(n.strong,{children:"ParaTime state pruning must be configured\nfrom the start or not configured at all"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["To configure ParaTime pruning it is recommended to set ",(0,o.jsx)(n.code,{children:"n=250_000"}),". The maximum value is\n",(0,o.jsx)(n.code,{children:"n=400_000"}),". If you need to preserve more data (e.g. nodes serving historical\nstate) you will have to keep the entire ParaTime's state from the genesis."]})]})}function l(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>a});var t=r(96540);const o={},s=t.createContext(o);function i(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);