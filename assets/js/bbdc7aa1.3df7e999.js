"use strict";(globalThis.webpackChunkdocs_oasis_io=globalThis.webpackChunkdocs_oasis_io||[]).push([[7910],{28453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>d});var i=s(96540);const a={},t=i.createContext(a);function r(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),i.createElement(t.Provider,{value:n},e.children)}},51881:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"build/rofl/features/appd","title":"appd REST API","description":"Each containerized app running in ROFL runs a special daemon (called","source":"@site/docs/build/rofl/features/appd.md","sourceDirName":"build/rofl/features","slug":"/build/rofl/features/appd","permalink":"/build/rofl/features/appd","draft":false,"unlisted":false,"editUrl":"https://github.com/oasisprotocol/oasis-sdk/edit/main/docs/rofl/features/appd.md","tags":[],"version":"current","lastUpdatedAt":1761563757000,"frontMatter":{"sidebar_custom_props":{}},"sidebar":"developers","previous":{"title":"rofl.yaml Manifest File","permalink":"/build/rofl/features/manifest"},"next":{"title":"Port Proxy","permalink":"/build/rofl/features/proxy"}}');var a=s(74848),t=s(28453);const r={sidebar_custom_props:{tags:void 0}},d="appd REST API",l={},c=[{value:"App Identifier",id:"app-identifier",level:2},{value:"Key Generation",id:"key-generation",level:2},{value:"Authenticated Transaction Submission",id:"authenticated-transaction-submission",level:2},{value:"Replica Metadata",id:"replica-metadata",level:2},{value:"Get Metadata",id:"get-metadata",level:3},{value:"Set Metadata",id:"set-metadata",level:3}];function o(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsxs)(n.h1,{id:"appd-rest-api",children:[(0,a.jsx)(n.code,{children:"appd"})," REST API"]})}),"\n",(0,a.jsxs)(n.p,{children:["Each containerized app running in ROFL runs a special daemon (called\n",(0,a.jsx)(n.code,{children:"rofl-appd"}),") that exposes additional functions via a simple HTTP REST API. In\norder to make it easier to isolate access, the API is exposed via a UNIX socket\nlocated at ",(0,a.jsx)(n.code,{children:"/run/rofl-appd.sock"})," which can be passed to containers via volumes."]}),"\n",(0,a.jsxs)(n.p,{children:["An example using the ",(0,a.jsx)(n.a,{href:"https://docs.docker.com/reference/compose-file/services/#short-syntax-5",children:"short syntax for Compose volumes"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"services:\n  mycontainer:\n    # ... other details omitted ...\n    volumes:\n      - /run/rofl-appd.sock:/run/rofl-appd.sock\n"})}),"\n",(0,a.jsx)(n.p,{children:"The following sections describe the available endpoints."}),"\n",(0,a.jsx)(n.admonition,{title:"UNIX sockets and HTTP headers",type:"info",children:(0,a.jsxs)(n.p,{children:["Although the communication with ",(0,a.jsx)(n.code,{children:"rofl-appd"})," is through UNIX sockets, the REST\nservice still uses the HTTP protocol. In place of a host name you can provide\nany name. In our examples, we stick to the ",(0,a.jsx)(n.code,{children:"http://localhost/<endpoint_path>"}),"\nformat."]})}),"\n",(0,a.jsx)(n.h2,{id:"app-identifier",children:"App Identifier"}),"\n",(0,a.jsx)(n.p,{children:"This endpoint can be used to retrieve the app ID."}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Endpoint:"})," ",(0,a.jsx)(n.code,{children:"/rofl/v1/app/id"})," (",(0,a.jsx)(n.code,{children:"GET"}),")"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Example response:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"rofl1qqn9xndja7e2pnxhttktmecvwzz0yqwxsquqyxdf\n"})}),"\n",(0,a.jsx)(n.h2,{id:"key-generation",children:"Key Generation"}),"\n",(0,a.jsx)(n.p,{children:"Each registered app automatically gets access to a decentralized on-chain key\nmanagement system."}),"\n",(0,a.jsx)(n.p,{children:"All generated keys can only be generated inside properly attested app instances\nand will remain the same even in case the app is deployed somewhere else or its\nstate is erased."}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Endpoint:"})," ",(0,a.jsx)(n.code,{children:"/rofl/v1/keys/generate"})," (",(0,a.jsx)(n.code,{children:"POST"}),")"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Example request:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "key_id": "demo key",\n  "kind": "secp256k1"\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Request fields:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"key_id"})," is used for domain separation of different keys (e.g. a different key\nid will generate a completely different key)."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"kind"})," defines what kind of key should be generated. The following values are\ncurrently supported:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"raw-256"})," to generate 256 bits of entropy."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"raw-386"})," to generate 384 bits of entropy."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"ed25519"})," to generate an Ed25519 private key."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"secp256k1"})," to generate a Secp256k1 private key."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Example response:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "key": "a54027bff15a8726b6d9f65383bff20db51c6f3ac5497143a8412a7f16dfdda9"\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:["The generated ",(0,a.jsx)(n.code,{children:"key"})," is returned as a hexadecimal string."]}),"\n",(0,a.jsx)(n.h2,{id:"authenticated-transaction-submission",children:"Authenticated Transaction Submission"}),"\n",(0,a.jsxs)(n.p,{children:["An app running in ROFL can also submit ",(0,a.jsx)(n.em,{children:"authenticated transactions"})," to the chain\nwhere it is registered at. The special feature of these transactions is that\nthey are signed by an ",(0,a.jsx)(n.strong,{children:"endorsed ephemeral key"})," and are therefore automatically\nauthenticated as coming from the app itself."]}),"\n",(0,a.jsxs)(n.p,{children:["This makes it possible to easily authenticate the transaction origin in smart\ncontracts by simply invoking an ",(0,a.jsx)(n.a,{href:"https://api.docs.oasis.io/sol/sapphire-contracts/contracts/Subcall.sol/library.Subcall.html#roflensureauthorizedorigin",children:"appropriate subcall"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-solidity",children:"Subcall.roflEnsureAuthorizedOrigin(roflAppID);\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Endpoint:"})," ",(0,a.jsx)(n.code,{children:"/rofl/v1/tx/sign-submit"})," (",(0,a.jsx)(n.code,{children:"POST"}),")"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Example request:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "tx": {\n    "kind": "eth",\n    "data": {\n      "gas_limit": 200000,\n      "to": "1234845aaB7b6CD88c7fAd9E9E1cf07638805b20",\n      "value": 0,\n      "data": "dae1ee1f00000000000000000000000000000000000000000000000000002695a9e649b2"\n    }\n  }\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Request fields:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"tx"})," describes the transaction content with different transaction kinds being\nsupported (as defined by the ",(0,a.jsx)(n.code,{children:"kind"})," field):"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Ethereum-compatible calls (",(0,a.jsx)(n.code,{children:"eth"}),") use standard fields (",(0,a.jsx)(n.code,{children:"gas_limit"}),", ",(0,a.jsx)(n.code,{children:"to"}),",\n",(0,a.jsx)(n.code,{children:"value"})," and ",(0,a.jsx)(n.code,{children:"data"}),") to define the transaction content."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Oasis SDK calls (",(0,a.jsx)(n.code,{children:"std"}),") support CBOR-serialized hex-encoded ",(0,a.jsx)(n.code,{children:"Transaction"}),"s\nto be specified."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"encrypt"})," is a boolean flag specifying whether the transaction should be\nencrypted. By default this is ",(0,a.jsx)(n.code,{children:"true"}),". Note that encryption is handled\ntransparently for the caller using an ephemeral key and any response is first\ndecrypted before being passed on."]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Example response:"})}),"\n",(0,a.jsxs)(n.p,{children:["Inside ",(0,a.jsx)(n.code,{children:"data"})," the JSON response contains a CBOR-serialized hex-encoded\n",(0,a.jsx)(n.a,{href:"https://api.docs.oasis.io/rust/oasis_runtime_sdk/types/transaction/enum.CallResult.html",children:"call result"}),". To investigate it you will need to deserialize it first."]}),"\n",(0,a.jsx)(n.p,{children:"For example:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Successful call result:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "data": "a1626f6b40"\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:["deserialized as ",(0,a.jsx)(n.code,{children:"{\"ok\": ''}"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Unsusccessful call result:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "data": "a1646661696ca364636f646508666d6f64756c656365766d676d6573736167657272657665727465643a20614a416f4c773d3d"\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:["deserialized as\n",(0,a.jsx)(n.code,{children:'{"fail": {"code": 8, "module": "evm", "message": "reverted: aJAoLw=="}}'}),"."]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"replica-metadata",children:"Replica Metadata"}),"\n",(0,a.jsxs)(n.p,{children:["Replica metadata allows apps to publish arbitrary key-value pairs that are\nincluded in the on-chain ROFL replica registration. This metadata is\nautomatically namespaced with ",(0,a.jsx)(n.code,{children:"net.oasis.app."})," when published on-chain."]}),"\n",(0,a.jsx)(n.h3,{id:"get-metadata",children:"Get Metadata"}),"\n",(0,a.jsx)(n.p,{children:"Retrieve all user-set metadata key-value pairs."}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Endpoint:"})," ",(0,a.jsx)(n.code,{children:"/rofl/v1/metadata"})," (",(0,a.jsx)(n.code,{children:"GET"}),")"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Example response:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "key_fingerprint": "a54027bff15a8726",\n  "version": "1.0.0"\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"set-metadata",children:"Set Metadata"}),"\n",(0,a.jsx)(n.p,{children:"Set metadata key-value pairs. This replaces all existing app-provided metadata\nand will trigger a registration refresh if the metadata has changed."}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Endpoint:"})," ",(0,a.jsx)(n.code,{children:"/rofl/v1/metadata"})," (",(0,a.jsx)(n.code,{children:"POST"}),")"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Example request:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "key_fingerprint": "a54027bff15a8726",\n  "version": "1.0.0"\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Note:"})," Metadata is validated against runtime-configured limits for the\nnumber of pairs, key size, and value size."]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}}}]);