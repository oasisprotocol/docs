"use strict";(globalThis.webpackChunkdocs_oasis_io=globalThis.webpackChunkdocs_oasis_io||[]).push([[7984],{28453:(e,s,r)=>{r.d(s,{R:()=>i,x:()=>o});var t=r(96540);const n={},a=t.createContext(n);function i(e){const s=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:i(e.components),t.createElement(a.Provider,{value:s},e.children)}},60647:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>t,toc:()=>h});const t=JSON.parse('{"id":"core/release-process","title":"Release Process","description":"The following steps should be followed when preparing a release.","source":"@site/docs/core/release-process.md","sourceDirName":"core","slug":"/core/release-process","permalink":"/core/release-process","draft":false,"unlisted":false,"editUrl":"https://github.com/oasisprotocol/oasis-core/edit/stable/24.2.x/docs/release-process.md","tags":[],"version":"current","lastUpdatedAt":1768997119000,"frontMatter":{"sidebar_custom_props":{}},"sidebar":"oasisCore","previous":{"title":"Processes","permalink":"/core/processes"},"next":{"title":"Versioning","permalink":"/core/versioning"}}');var n=r(74848),a=r(28453);const i={sidebar_custom_props:{tags:void 0}},o="Release Process",l={},h=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Tooling",id:"tooling",level:2},{value:"Preparing a Regular Release",id:"preparing-a-regular-release",level:2},{value:"Bump Protocol Versions",id:"bump-protocol-versions",level:3},{value:"Prepare the Change Log",id:"prepare-the-change-log",level:3},{value:"Tag Next Release",id:"tag-next-release",level:3},{value:"Ensure GitHub Release Was Published",id:"ensure-github-release-was-published",level:3},{value:"Create <code>stable/YY.MINOR.x</code> Branch",id:"create-stableyyminorx-branch",level:3},{value:"Preparing a Bugfix/Stable Release",id:"preparing-a-bugfixstable-release",level:2},{value:"Back-port Changes",id:"back-port-changes",level:3},{value:"Prepare Change Log for Bugfix/Stable Release",id:"prepare-change-log-for-bugfixstable-release",level:3},{value:"Tag Bugfix/Stable Release",id:"tag-bugfixstable-release",level:3},{value:"Ensure GitHub Release for Bugfix/Stable Release Was Published",id:"ensure-github-release-for-bugfixstable-release-was-published",level:3}];function c(e){const s={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.header,{children:(0,n.jsx)(s.h1,{id:"release-process",children:"Release Process"})}),"\n",(0,n.jsx)(s.p,{children:"The following steps should be followed when preparing a release."}),"\n",(0,n.jsx)(s.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,n.jsx)(s.p,{children:"Our release process relies on some tooling that needs to be available on a\nmaintainer's system:"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.a,{href:"https://www.python.org/",children:"Python"})," 3.6+."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.a,{href:"https://github.com/oasisprotocol/towncrier",children:"Oasis' towncrier fork"}),"."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.a,{href:"https://github.com/lgiordani/punch",children:"Punch"})," 2.0.x."]}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:["Most systems should already have ",(0,n.jsx)(s.a,{href:"https://www.python.org/",children:"Python"})," pre-installed."]}),"\n",(0,n.jsxs)(s.p,{children:["To install ",(0,n.jsx)(s.a,{href:"https://github.com/oasisprotocol/towncrier",children:"Oasis' towncrier fork"})," and ",(0,n.jsx)(s.a,{href:"https://github.com/lgiordani/punch",children:"Punch"}),", use ",(0,n.jsx)(s.a,{href:"https://pip.pypa.io/en/stable/",children:"pip"}),":"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"pip3 install --upgrade \\\n  https://github.com/oasisprotocol/towncrier/archive/oasis-master.tar.gz \\\n  punch.py~=2.0.0\n"})}),"\n",(0,n.jsxs)(s.p,{children:["You might want to install the packages to a ",(0,n.jsx)(s.a,{href:"https://packaging.python.org/tutorials/installing-packages/#creating-virtual-environments",children:"Python virtual environment"})," or\nvia so-called ",(0,n.jsx)(s.a,{href:"https://pip.pypa.io/en/stable/user_guide/#user-installs",children:"User install"})," (i.e. isolated to the current user)."]}),"\n",(0,n.jsx)(s.h2,{id:"tooling",children:"Tooling"}),"\n",(0,n.jsxs)(s.p,{children:["Our ",(0,n.jsx)(s.a,{href:"https://en.wikipedia.org/wiki/Make_(software)",children:"Make"})," tooling has some targets that automate parts of the release process\nand try to make it less error-prone:"]}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"changelog"}),": Bumps project's version with the ",(0,n.jsx)(s.a,{href:"https://github.com/lgiordani/punch",children:"Punch"})," utility and assembles\nthe ",(0,n.jsx)(s.a,{href:"https://github.com/oasisprotocol/oasis-core/tree/master/CHANGELOG.md",children:"Change Log"})," from the ",(0,n.jsx)(s.a,{href:"https://github.com/oasisprotocol/oasis-core/tree/master/.changelog/README.md",children:"Change Log Fragments"})," using the\n",(0,n.jsx)(s.a,{href:"https://github.com/oasisprotocol/towncrier",children:"towncrier"})," utility."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"release-tag"}),": After performing a bunch of sanity checks, it tags the git\norigin remote's release branch's ",(0,n.jsx)(s.code,{children:"HEAD"})," with the ",(0,n.jsx)(s.code,{children:"v<NEXT-VERSION>"})," tag and\npushes it to the remote."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"release-stable-branch"}),": Creates and pushes a stable branch for the current\nrelease."]}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:["Note that all above targets depend on the ",(0,n.jsx)(s.code,{children:"fetch-git"})," target which fetches the\nlatest changes (including tags) from the git origin remote to ensure the\ncomputed next version and other things are always up-to-date."]}),"\n",(0,n.jsxs)(s.p,{children:["The version of the Oasis Core's next release is computed automatically using\nthe ",(0,n.jsx)(s.a,{href:"https://github.com/lgiordani/punch",children:"Punch"})," utility according to the project's ",(0,n.jsx)(s.a,{href:"/core/versioning",children:"Versioning"})," scheme."]}),"\n",(0,n.jsxs)(s.p,{children:["The ",(0,n.jsx)(s.code,{children:"changelog"})," Make target checks the name of the branch on which the release\nis being made to know which part of the project's version to bump."]}),"\n",(0,n.jsx)(s.p,{children:"To customize the release process, one can set the following environment\nvariables:"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"GIT_ORIGIN_REMOTE"})," (default: ",(0,n.jsx)(s.code,{children:"origin"}),"): Name of the git remote pointing to\nthe canonical upstream git repository."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"RELEASE_BRANCH"})," (default: ",(0,n.jsx)(s.code,{children:"master"}),"): Name of the branch where to tag the next\nrelease."]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"preparing-a-regular-release",children:"Preparing a Regular Release"}),"\n",(0,n.jsx)(s.h3,{id:"bump-protocol-versions",children:"Bump Protocol Versions"}),"\n",(0,n.jsxs)(s.p,{children:["Before a release, make sure that the proper protocol versions were bumped\ncorrectly (see ",(0,n.jsx)(s.a,{href:"https://github.com/oasisprotocol/oasis-core/tree/master/go/common/version/version.go",children:(0,n.jsx)(s.code,{children:"go/common/version/version.go"})}),"). If not, make a pull request\nthat bumps the respective version(s) before proceeding with the release process."]}),"\n",(0,n.jsx)(s.h3,{id:"prepare-the-change-log",children:"Prepare the Change Log"}),"\n",(0,n.jsxs)(s.p,{children:["Before a release, all ",(0,n.jsx)(s.a,{href:"https://github.com/oasisprotocol/oasis-core/tree/master/.changelog/README.md",children:"Change Log fragments"})," should be assembled into a new\nsection of the ",(0,n.jsx)(s.a,{href:"https://github.com/oasisprotocol/oasis-core/tree/master/CHANGELOG.md",children:"Change Log"})," using the ",(0,n.jsx)(s.code,{children:"changelog"})," ",(0,n.jsx)(s.a,{href:"https://en.wikipedia.org/wiki/Make_(software)",children:"Make"})," target."]}),"\n",(0,n.jsxs)(s.p,{children:["Create a new branch, e.g. ",(0,n.jsx)(s.code,{children:"changelog"}),", and then run ",(0,n.jsx)(s.a,{href:"https://en.wikipedia.org/wiki/Make_(software)",children:"Make"}),":"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"git checkout -b changelog\nmake changelog\n"})}),"\n",(0,n.jsx)(s.p,{children:"Review the staged changes and make appropriate adjustment to the Change Log\n(e.g. re-order entries, make formatting/spelling fixes, ...)."}),"\n",(0,n.jsxs)(s.p,{children:["Replace the ",(0,n.jsx)(s.code,{children:"<VERSION>"})," strings in the protocol versions table just below the\nnext version's heading with appropriate protocol versions as defined in\n",(0,n.jsx)(s.a,{href:"https://github.com/oasisprotocol/oasis-core/tree/master/go/common/version/version.go",children:"go/common/version/version.go"})," file."]}),"\n",(0,n.jsx)(s.p,{children:"For example:"}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{style:{textAlign:"left"},children:"Protocol"}),(0,n.jsx)(s.th,{style:{textAlign:"center"},children:"Version"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{style:{textAlign:"left"},children:"Consensus"}),(0,n.jsx)(s.td,{style:{textAlign:"center"},children:"4.0.0"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{style:{textAlign:"left"},children:"Runtime Host"}),(0,n.jsx)(s.td,{style:{textAlign:"center"},children:"2.0.0"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{style:{textAlign:"left"},children:"Runtime Committee"}),(0,n.jsx)(s.td,{style:{textAlign:"center"},children:"2.0.0"})]})]})]}),"\n",(0,n.jsx)(s.p,{children:"After you are content with the changes, commit them, push them to the origin\nand make a pull request."}),"\n",(0,n.jsx)(s.p,{children:"Once the pull request had been reviewed and merged, proceed to the next step."}),"\n",(0,n.jsx)(s.h3,{id:"tag-next-release",children:"Tag Next Release"}),"\n",(0,n.jsxs)(s.p,{children:["To create a signed git tag from the latest commit in origin remote's ",(0,n.jsx)(s.code,{children:"master"}),"\nbranch, use:"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"make release-tag\n"})}),"\n",(0,n.jsx)(s.p,{children:"This command will perform a bunch of sanity checks to prevent common errors\nwhile tagging the next release."}),"\n",(0,n.jsx)(s.p,{children:"After those checks have passed, it will ask for confirmation before proceeding."}),"\n",(0,n.jsx)(s.h3,{id:"ensure-github-release-was-published",children:"Ensure GitHub Release Was Published"}),"\n",(0,n.jsxs)(s.p,{children:["After the tag with the next release is pushed to the ",(0,n.jsx)(s.a,{href:"https://github.com/oasisprotocol/oasis-core",children:"canonical git repository"}),",\nthe GitHub Actions ",(0,n.jsx)(s.a,{href:"https://github.com/oasisprotocol/oasis-core/tree/master/.github/workflows/release.yml",children:"Release manager workflow"})," is triggered which uses the\n",(0,n.jsx)(s.a,{href:"https://goreleaser.com/",children:"GoReleaser"})," tool to automatically build the binaries, prepare archives and\nchecksums, and publish a GitHub Release that accompanies the versioned git tag."]}),"\n",(0,n.jsxs)(s.p,{children:["Browse to ",(0,n.jsx)(s.a,{href:"https://github.com/oasisprotocol/oasis-core/releases",children:"Oasis Core's releases page"})," and make sure the new release is properly\npublished."]}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Initially the release will be published as a pre-release to allow for early\ntesting on Testnet. Once the release is ready for a wider audience on Mainnet it\nshould be explicitly changed to be a normal production release."})}),"\n",(0,n.jsxs)(s.h3,{id:"create-stableyyminorx-branch",children:["Create ",(0,n.jsx)(s.code,{children:"stable/YY.MINOR.x"})," Branch"]}),"\n",(0,n.jsx)(s.p,{children:"To prepare a new stable branch from the new release tag and push it to the\norigin remote, use:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"make release-stable-branch\n"})}),"\n",(0,n.jsx)(s.p,{children:"This command will perform sanity checks to prevent common errors."}),"\n",(0,n.jsx)(s.p,{children:"After those checks have passed, it will ask for confirmation before proceeding."}),"\n",(0,n.jsx)(s.h2,{id:"preparing-a-bugfixstable-release",children:"Preparing a Bugfix/Stable Release"}),"\n",(0,n.jsxs)(s.p,{children:["As mentioned in the ",(0,n.jsx)(s.a,{href:"/core/versioning",children:"Versioning"})," documentation, sometimes we will want to\nback-port some fixes (e.g. a security fix) and (backwards compatible) changes\nfrom an upcoming release and release them without also releasing all the other\n(potentially breaking) changes."]}),"\n",(0,n.jsxs)(s.p,{children:["Set the ",(0,n.jsx)(s.code,{children:"RELEASE_BRANCH"})," environment variable to the name of the stable branch\nof the ",(0,n.jsx)(s.code,{children:"YY.MINOR"})," release you want to back-port the changes to, e.g.\n",(0,n.jsx)(s.code,{children:"stable/21.2.x"}),", and export it:"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:'export RELEASE_BRANCH="stable/21.2.x"\n'})}),"\n",(0,n.jsx)(s.h3,{id:"back-port-changes",children:"Back-port Changes"}),"\n",(0,n.jsxs)(s.p,{children:["Create a new branch, e.g. ",(0,n.jsx)(s.code,{children:"backport-foo-${RELEASE_BRANCH#stable/}"}),", from the\n",(0,n.jsx)(s.code,{children:"${RELEASE_BRANCH}"})," branch:"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"git checkout -b backport-foo-${RELEASE_BRANCH#stable/} ${RELEASE_BRANCH}\n"})}),"\n",(0,n.jsxs)(s.p,{children:["After back-porting all the desired changes, push it to the origin and make a\npull request against the ",(0,n.jsx)(s.code,{children:"${RELEASE_BRANCH}"})," branch."]}),"\n",(0,n.jsx)(s.h3,{id:"prepare-change-log-for-bugfixstable-release",children:"Prepare Change Log for Bugfix/Stable Release"}),"\n",(0,n.jsxs)(s.p,{children:["As with a regular release, the back-ported changes should include the\ncorresponding ",(0,n.jsx)(s.a,{href:"https://github.com/oasisprotocol/oasis-core/tree/master/.changelog/README.md",children:"Change Log Fragments"})," that need to be assembled into a new\nsection of the ",(0,n.jsx)(s.a,{href:"https://github.com/oasisprotocol/oasis-core/tree/master/CHANGELOG.md",children:"Change Log"})," using the ",(0,n.jsx)(s.code,{children:"changelog"})," ",(0,n.jsx)(s.a,{href:"https://en.wikipedia.org/wiki/Make_(software)",children:"Make"})," target."]}),"\n",(0,n.jsxs)(s.p,{children:["Create a new branch, e.g. ",(0,n.jsx)(s.code,{children:"changelog-${RELEASE_BRANCH#stable/}"}),", from the\n",(0,n.jsx)(s.code,{children:"${RELEASE_BRANCH}"})," branch:"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"git checkout -b changelog-${RELEASE_BRANCH#stable/} ${RELEASE_BRANCH}\n"})}),"\n",(0,n.jsxs)(s.p,{children:["Then run ",(0,n.jsx)(s.a,{href:"https://en.wikipedia.org/wiki/Make_(software)",children:"Make"}),"'s ",(0,n.jsx)(s.code,{children:"changelog"})," target:"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"make changelog\n"})}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsxs)(s.em,{children:["NOTE: The ",(0,n.jsx)(s.code,{children:"changelog"})," Make target will bump the ",(0,n.jsx)(s.code,{children:"MICRO"})," part of the version\nautomatically."]})}),"\n",(0,n.jsxs)(s.p,{children:["Replace the ",(0,n.jsx)(s.code,{children:"<VERSION>"})," strings in the protocol versions table just below the\nnext version's heading with appropriate protocol versions as defined in\n",(0,n.jsx)(s.a,{href:"https://github.com/oasisprotocol/oasis-core/tree/master/go/common/version/version.go",children:"go/common/version/version.go"})," file."]}),"\n",(0,n.jsxs)(s.p,{children:["After reviewing the staged changes, commit them, push the changes to the origin\nand make a pull request against the ",(0,n.jsx)(s.code,{children:"${RELEASE_BRANCH}"})," branch."]}),"\n",(0,n.jsx)(s.p,{children:"Once the pull request had been reviewed and merged, proceed to the next step."}),"\n",(0,n.jsx)(s.h3,{id:"tag-bugfixstable-release",children:"Tag Bugfix/Stable Release"}),"\n",(0,n.jsxs)(s.p,{children:["As with a regular release, create a signed git tag from the latest commit in\norigin remote's release branch by running the ",(0,n.jsx)(s.code,{children:"release-tag"})," Make target:"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"make release-tag\n"})}),"\n",(0,n.jsx)(s.p,{children:"After the sanity checks have passed, it will ask for confirmation before\nproceeding."}),"\n",(0,n.jsx)(s.h3,{id:"ensure-github-release-for-bugfixstable-release-was-published",children:"Ensure GitHub Release for Bugfix/Stable Release Was Published"}),"\n",(0,n.jsxs)(s.p,{children:["Similar to a regular release, after the tag with the next release is pushed to\nthe ",(0,n.jsx)(s.a,{href:"https://github.com/oasisprotocol/oasis-core",children:"canonical git repository"}),", the GitHub Actions ",(0,n.jsx)(s.a,{href:"https://github.com/oasisprotocol/oasis-core/tree/master/.github/workflows/release.yml",children:"Release manager workflow"})," is\ntriggered which uses the ",(0,n.jsx)(s.a,{href:"https://goreleaser.com/",children:"GoReleaser"})," tool to automatically build a new release."]}),"\n",(0,n.jsxs)(s.p,{children:["Browse to ",(0,n.jsx)(s.a,{href:"https://github.com/oasisprotocol/oasis-core/releases",children:"Oasis Core's releases page"})," and make sure the new bugfix/stable\nrelease is properly published."]})]})}function d(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}}}]);