<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-node/run-your-node/prerequisites/set-up-tee" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Set up Trusted Execution Environment (TEE) | Oasis Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.oasis.io/node/run-your-node/prerequisites/set-up-tee"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Set up Trusted Execution Environment (TEE) | Oasis Documentation"><meta data-rh="true" name="description" content="Most Oasis ParaTimes and ROFLs are configured to run in a TEE. There are two"><meta data-rh="true" property="og:description" content="Most Oasis ParaTimes and ROFLs are configured to run in a TEE. There are two"><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://docs.oasis.io/node/run-your-node/prerequisites/set-up-tee"><link data-rh="true" rel="alternate" href="https://docs.oasis.io/node/run-your-node/prerequisites/set-up-tee" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.oasis.io/node/run-your-node/prerequisites/set-up-tee" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.e55d6d10.css">
<script src="/assets/js/runtime~main.296dd946.js" defer="defer"></script>
<script src="/assets/js/main.1fc431be.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><link rel="preload" as="image" href="/img/logo_dark.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Oasis Docs" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo_dark.svg" alt="Oasis Docs" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/build/">Build</a><a class="navbar__item navbar__link" href="/general/">Learn</a><a class="navbar__item navbar__link" href="/get-involved/">Get Involved</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/node/">Run Node</a><a class="navbar__item navbar__link" href="/core/">Develop Core</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/oasisprotocol" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" title="GitHub repository" aria-label="GitHub repository"></a><a href="https://oasis.net/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-www-link" title="Oasis website" aria-label="Oasis website"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/node/"><span title="Overview" class="linkLabel_WmDU">Overview</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link" href="/node/network/"><span title="Network Information" class="categoryLinkLabel_W154">Network Information</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/node/network/mainnet"><span title="Mainnet" class="linkLabel_WmDU">Mainnet</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/node/network/testnet"><span title="Testnet" class="linkLabel_WmDU">Testnet</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--active" href="/node/run-your-node/"><span title="Run Your Node" class="categoryLinkLabel_W154">Run Your Node</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/node/run-your-node/prerequisites"><span title="Prerequisites" class="categoryLinkLabel_W154">Prerequisites</span></a><button aria-label="Collapse sidebar category &#x27;Prerequisites&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/node/run-your-node/prerequisites/hardware-recommendations"><span title="Hardware Requirements" class="linkLabel_WmDU">Hardware Requirements</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/node/run-your-node/prerequisites/cloud-providers"><span title="Cloud Providers" class="linkLabel_WmDU">Cloud Providers</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/node/run-your-node/prerequisites/stake-requirements"><span title="Stake Requirements" class="linkLabel_WmDU">Stake Requirements</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/node/run-your-node/prerequisites/oasis-node"><span title="Install the Oasis Node" class="linkLabel_WmDU">Install the Oasis Node</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/node/run-your-node/prerequisites/system-configuration"><span title="System Configuration" class="linkLabel_WmDU">System Configuration</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/node/run-your-node/prerequisites/set-up-tee"><span title="Set up Trusted Execution Environment (TEE)" class="linkLabel_WmDU">Set up Trusted Execution Environment (TEE)</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/node/run-your-node/validator-node"><span title="Validator Node" class="linkLabel_WmDU">Validator Node</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/node/run-your-node/non-validator-node"><span title="Non-validator Node" class="linkLabel_WmDU">Non-validator Node</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/node/run-your-node/seed-node"><span title="Seed Node" class="linkLabel_WmDU">Seed Node</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/node/run-your-node/archive-node"><span title="Archive Node" class="linkLabel_WmDU">Archive Node</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/node/run-your-node/paratime-node"><span title="ParaTime Node" class="linkLabel_WmDU">ParaTime Node</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/node/run-your-node/paratime-client-node"><span title="ParaTime Client Node" class="categoryLinkLabel_W154">ParaTime Client Node</span></a><button aria-label="Expand sidebar category &#x27;ParaTime Client Node&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/node/run-your-node/rofl-node"><span title="ROFL Node" class="linkLabel_WmDU">ROFL Node</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/node/run-your-node/keymanager-node/"><span title="Key Manager Node" class="categoryLinkLabel_W154">Key Manager Node</span></a><button aria-label="Expand sidebar category &#x27;Key Manager Node&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/node/run-your-node/sentry-node"><span title="Sentry Node" class="linkLabel_WmDU">Sentry Node</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/node/run-your-node/maintenance"><span title="Maintenance" class="categoryLinkLabel_W154">Maintenance</span></a><button aria-label="Expand sidebar category &#x27;Maintenance&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/node/run-your-node/advanced"><span title="Advanced" class="categoryLinkLabel_W154">Advanced</span></a><button aria-label="Expand sidebar category &#x27;Advanced&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/node/run-your-node/troubleshooting"><span title="Troubleshooting" class="linkLabel_WmDU">Troubleshooting</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/node/web3"><span title="Web3 Gateway" class="linkLabel_WmDU">Web3 Gateway</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/node/grpc"><span title="gRPC Proxy" class="linkLabel_WmDU">gRPC Proxy</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/node/reference"><span title="Reference" class="categoryLinkLabel_W154">Reference</span></a><button aria-label="Expand sidebar category &#x27;Reference&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Set up Trusted Execution Environment (TEE)</h1></header>
<p>Most Oasis ParaTimes and ROFLs are configured to run in a TEE. There are two
kinds of Intel TEEs currently in use:</p>
<ul>
<li class=""><a href="https://www.intel.com/content/www/us/en/architecture-and-technology/software-guard-extensions.html" target="_blank" rel="noopener noreferrer" class="">Intel SGX</a> is required by the ParaTimes and <a class="" href="/build/rofl/workflow/init">ROFL SGX</a> apps.</li>
<li class=""><a href="https://www.intel.com/content/www/us/en/products/docs/accelerator-engines/trust-domain-extensions.html" target="_blank" rel="noopener noreferrer" class="">Intel TDX</a> is required by the <a class="" href="/build/rofl/workflow/init">ROFL TDX raw and container-based</a>
apps.</li>
</ul>
<p>To run SGX/TDX enclaves:</p>
<ol>
<li class="">your hardware must have SGX/TDX support,</li>
<li class="">you must have the latest BIOS updates installed,</li>
<li class="">you must have SGX/TDX enabled in your BIOS,</li>
<li class="">you must have the Linux kernel, drivers and software components properly
installed and running.</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="sgx">Software Guard Extensions (SGX)<a href="#sgx" class="hash-link" aria-label="Direct link to Software Guard Extensions (SGX)" title="Direct link to Software Guard Extensions (SGX)" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="sgx-bios-configuration">BIOS Configuration<a href="#sgx-bios-configuration" class="hash-link" aria-label="Direct link to BIOS Configuration" title="Direct link to BIOS Configuration" translate="no">​</a></h3>
<p>To enable Intel SGX on your hardware, you also need to configure the BIOS.
First, <strong>update the BIOS to the latest version with the latest microcode</strong> and
then proceed with BIOS configuration as shown below. Note that some settings may
not apply to your BIOS. In that case, configure only the relevant ones. Please
set the BIOS settings as follows:</p>
<ul>
<li class=""><strong>SGX</strong>: ENABLE</li>
<li class=""><strong>Hyper-Threading</strong>: DISABLE</li>
<li class=""><strong>Intel SpeedStep</strong>: DISABLE</li>
<li class=""><strong>Turbo Mode</strong>: DISABLE</li>
<li class=""><strong>CPU AES</strong>: ENABLE</li>
<li class=""><strong>SGX Auto MP Registration</strong>: ENABLE</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="ensure-clock-synchronization">Ensure Clock Synchronization<a href="#ensure-clock-synchronization" class="hash-link" aria-label="Direct link to Ensure Clock Synchronization" title="Direct link to Ensure Clock Synchronization" translate="no">​</a></h3>
<p>Due to additional sanity checks within runtime enclaves, you should ensure that
the node&#x27;s local clock is synchronized (e.g. using NTP). If it is off by more
than half a second you may experience unexpected runtime aborts.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="ensure-proper-sgx-device-permissions">Ensure Proper SGX Device Permissions<a href="#ensure-proper-sgx-device-permissions" class="hash-link" aria-label="Direct link to Ensure Proper SGX Device Permissions" title="Direct link to Ensure Proper SGX Device Permissions" translate="no">​</a></h3>
<p>Make sure that the user that is running the Oasis Node binary has access to the
SGX device (e.g. <code>/dev/sgx_enclave</code>). This can usually be achieved by adding
the user into the right group, for example in case the permissions of the SGX
device are as follows:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">crw-rw---- 1 root sgx 10, 125 Oct 28 09:28 /dev/sgx_enclave</span><br></span></code></pre></div></div>
<p>and the user running Oasis Node is <code>oasis</code>, you can do:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo adduser oasis sgx</span><br></span></code></pre></div></div>
<p>Failure to do so may result in the &quot;permission denied OS error 13&quot; during
runtime startup.</p>
<p>If you are planning to run your node from an interactive session, make sure to
log out for permissions to take effect.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="aesm-service">AESM Service<a href="#aesm-service" class="hash-link" aria-label="Direct link to AESM Service" title="Direct link to AESM Service" translate="no">​</a></h3>
<p>To allow execution of SGX enclaves, several <strong>Architectural Enclaves (AE)</strong> are
involved (i.e. Launch Enclave, Provisioning Enclave, Provisioning Certificate
Enclave, Quoting Enclave, Platform Services Enclaves).</p>
<p>Communication between application-spawned SGX enclaves and Intel-provided
Architectural Enclaves is through <strong>Application Enclave Service Manager
(AESM)</strong>. AESM runs as a daemon and provides a socket through which applications
can facilitate various SGX services such as launch approval, remote attestation
quote signing, etc.</p>
<p>Oasis node requires the use of DCAP attestation. To see if your system supports
it, run the following:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> cpuid -1  | grep &quot;SGX&quot;</span><br></span></code></pre></div></div>
<p>and look for the following line:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">      SGX_LC: SGX launch config supported      = true</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="dcap-attestation">DCAP Attestation<a href="#dcap-attestation" class="hash-link" aria-label="Direct link to DCAP Attestation" title="Direct link to DCAP Attestation" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="ubuntu-2204">Ubuntu 22.04+<a href="#ubuntu-2204" class="hash-link" aria-label="Direct link to Ubuntu 22.04+" title="Direct link to Ubuntu 22.04+" translate="no">​</a></h4>
<p>A convenient way to install the AESM service on Ubuntu 22.04 systems
is to use the Intel&#x27;s <a href="https://download.01.org/intel-sgx/sgx_repo/" target="_blank" rel="noopener noreferrer" class="">official Intel SGX APT repository</a>.</p>
<p>First add Intel SGX APT repository to your system:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -fsSL https://download.01.org/intel-sgx/sgx_repo/ubuntu/intel-sgx-deb.key | sudo gpg --dearmor -o /usr/share/keyrings/intel-sgx-deb.gpg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;deb [arch=amd64 signed-by=/usr/share/keyrings/intel-sgx-deb.gpg] https://download.01.org/intel-sgx/sgx_repo/ubuntu $(lsb_release -cs) main&quot; | sudo tee /etc/apt/sources.list.d/intel-sgx.list &gt; /dev/null</span><br></span></code></pre></div></div>
<p>And then install the <code>sgx-aesm-service</code>, <code>libsgx-aesm-ecdsa-plugin</code>, <code>libsgx-aesm-quote-ex-plugin</code> and <code>libsgx-dcap-default-qpl</code> packages:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install sgx-aesm-service libsgx-aesm-ecdsa-plugin libsgx-aesm-quote-ex-plugin libsgx-dcap-default-qpl</span><br></span></code></pre></div></div>
<p>The AESM service should be up and running. To confirm that, use:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl status aesmd.service</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="configuring-the-quote-provider">Configuring the Quote Provider<a href="#configuring-the-quote-provider" class="hash-link" aria-label="Direct link to Configuring the Quote Provider" title="Direct link to Configuring the Quote Provider" translate="no">​</a></h4>
<p>The Intel Quote Provider (<code>libsgx-dcap-default-qpl</code>) needs to be configured in
order to use either the Intel PCS, the PCCS of your cloud service provider, or
your own PCCS. The configuration file is located at <code>/etc/sgx_default_qcnl.conf</code>.</p>
<p>Make sure to always restart the <code>aesmd.service</code> after updating the
configuration, via:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl restart aesmd.service</span><br></span></code></pre></div></div>
<h5 class="anchor anchorTargetStickyNavbar_Vzrq" id="intel-pcs">Intel PCS<a href="#intel-pcs" class="hash-link" aria-label="Direct link to Intel PCS" title="Direct link to Intel PCS" translate="no">​</a></h5>
<p>Using the Intel PCS is the simplest and most generic way, but it may be less
reliable than using your own PCCS. Some cloud providers (see the <a href="#cloud-service-providers-pccs" class="">following section</a>)
also require you to use their PCCS.</p>
<p>To use Intel PCS update the <code>pccs_url</code> value in <code>/etc/sgx_default_qcnl.conf</code>
to the Intel PCS API URL:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//PCCS server address</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;pccs_url&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://api.trustedservices.intel.com/sgx/certification/v4/&quot;</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>In case there is an error in the QPL configuration file, attestation will refuse
to work and the AESM service may produce unhelpful errors like the following:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Couldn&#x27;t find the platform library. (null)</span><br></span></code></pre></div></div><p>The only thing that needs to be changed is the <code>pccs_url</code> value above. <strong>Do not
add any comments and/or modify punctuation as these could make the configuration
file invalid.</strong></p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_Vzrq" id="cloud-service-providers-pccs">Cloud Service Provider&#x27;s PCCS<a href="#cloud-service-providers-pccs" class="hash-link" aria-label="Direct link to Cloud Service Provider&#x27;s PCCS" title="Direct link to Cloud Service Provider&#x27;s PCCS" translate="no">​</a></h5>
<p>Some cloud providers require you to use their PCCS.</p>
<ul>
<li class="">
<p>Azure: See the <a href="https://learn.microsoft.com/en-us/azure/security/fundamentals/trusted-hardware-identity-management#how-do-i-use-intel-qpl-with-trusted-hardware-identity-management" target="_blank" rel="noopener noreferrer" class="">Azure documentation</a> for details on configuring the quote provider. The documentation
contains an example of an Intel QPL configuration file that can be used.</p>
</li>
<li class="">
<p>Alibaba Cloud: See the <a href="https://www.alibabacloud.com/help/en/ecs/user-guide/build-an-sgx-encrypted-computing-environment" target="_blank" rel="noopener noreferrer" class="">Alibaba Cloud documentation</a> for details on configuring the quote provider. The
documentation shows the required <code>sgx_default_qcnl.conf</code> changes.</p>
</li>
<li class="">
<p>IBM Cloud: See the <a href="https://cloud.ibm.com/docs/vpc?topic=vpc-about-attestation-sgx-dcap-vpc" target="_blank" rel="noopener noreferrer" class="">IBM Cloud documentation</a> for details on configuring the quote provider. The
documentation shows the required <code>sgx_default_qcnl.conf</code> changes.</p>
</li>
<li class="">
<p>Other cloud providers: If you are using a different cloud service provider, consult their
specific documentation for the appropriate PCCS configuration and guidance on configuring the quote provider, or
use one of the other PCCS options.</p>
</li>
</ul>
<h5 class="anchor anchorTargetStickyNavbar_Vzrq" id="own-pccs">Own PCCS<a href="#own-pccs" class="hash-link" aria-label="Direct link to Own PCCS" title="Direct link to Own PCCS" translate="no">​</a></h5>
<p>It is also possible to run PCCS yourself. Follow <a href="https://www.intel.com/content/www/us/en/developer/articles/guide/intel-software-guard-extensions-data-center-attestation-primitives-quick-install-guide.html" target="_blank" rel="noopener noreferrer" class="">official Intel instructions</a> on how to setup your own PCCS.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="dcap-attestation-docker">DCAP Attestation Docker<a href="#dcap-attestation-docker" class="hash-link" aria-label="Direct link to DCAP Attestation Docker" title="Direct link to DCAP Attestation Docker" translate="no">​</a></h4>
<p>Alternatively, an easy way to install and run the AESM service on a <a href="https://docs.docker.com/engine/" target="_blank" rel="noopener noreferrer" class="">Docker</a>-enabled
system is to use <a href="https://github.com/oasisprotocol/oasis-core/pkgs/container/aesmd" target="_blank" rel="noopener noreferrer" class="">our AESM container image</a>.</p>
<p>Executing the following command should (always) pull the latest version of our
AESMD Docker container, map the SGX devices and <code>/var/run/aesmd</code> directory
and ensure AESM is running in the background (also automatically started on boot):</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker run \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --pull always \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --detach \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --restart always \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --device /dev/sgx_enclave \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --device /dev/sgx_provision \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --volume /var/run/aesmd:/var/run/aesmd \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --name aesmd \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ghcr.io/oasisprotocol/aesmd-dcap:master</span><br></span></code></pre></div></div>
<p>By default, the Intel Quote Provider in the docker container is configured to use the Intel PCS endpoint.
To override the Intel Quote Provider configuration within the container mount your own custom configuration using
the <code>volume</code> flag.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker run \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --pull always \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --detach \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --restart always \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --device /dev/sgx_enclave \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --device /dev/sgx_provision \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --volume /var/run/aesmd:/var/run/aesmd \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --volume /etc/sgx_default_qcnl.conf:/etc/sgx_default_qcnl.conf \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --name aesmd \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ghcr.io/oasisprotocol/aesmd-dcap:master</span><br></span></code></pre></div></div>
<p>The default Intel Quote Provider config is available in <a href="https://github.com/intel/SGXDataCenterAttestationPrimitives/blob/master/QuoteGeneration/qcnl/linux/sgx_default_qcnl.conf" target="_blank" rel="noopener noreferrer" class="">Intel SGX Github repository</a>.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="multi-socket-systems">Multi-socket Systems<a href="#multi-socket-systems" class="hash-link" aria-label="Direct link to Multi-socket Systems" title="Direct link to Multi-socket Systems" translate="no">​</a></h4>
<p>Note that platform provisioning for multi-socket systems (e.g. systems with
multiple CPUs) is more complex, especially if one is using a hypervisor and
running SGX workloads inside guest VMs. In this case additional provisioning may
be required to be performed on the host.</p>
<p>Note that the system must be booted in UEFI mode for provisioning to work as the
provisioning process uses UEFI variables to communicate with the BIOS. In
addition the <strong>SGX Auto MP Registration</strong> BIOS configuration setting should be
set to <em>enabled</em>.</p>
<h5 class="anchor anchorTargetStickyNavbar_Vzrq" id="ubuntu-2204-1">Ubuntu 22.04+<a href="#ubuntu-2204-1" class="hash-link" aria-label="Direct link to Ubuntu 22.04+" title="Direct link to Ubuntu 22.04+" translate="no">​</a></h5>
<p>To provision and register your multi-socket system you need to install the Intel
SGX Multi-Package Registration Agent Service as follows (assuming Intel&#x27;s SGX
apt repository has been added as discussed above):</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install sgx-ra-service</span><br></span></code></pre></div></div>
<p>After boot, the log in <code>/var/log/mpa_registration.log</code> should indicate
successful registration. If an error is reported, make sure that you have
enabled SGX Auto MP Registration in the BIOS as mentioned above. You can also
perform re-provisioning by rebooting and setting the <strong>SGX Factory Reset</strong>
option to <em>enabled</em>.</p>
<h5 class="anchor anchorTargetStickyNavbar_Vzrq" id="vmware-vsphere-80">VMware vSphere 8.0+<a href="#vmware-vsphere-80" class="hash-link" aria-label="Direct link to VMware vSphere 8.0+" title="Direct link to VMware vSphere 8.0+" translate="no">​</a></h5>
<p>In order to enable SGX remote attestation on VMware vSphere-based systems,
please follow <a href="https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-vcenter-esxi-management/GUID-F16476FD-3B66-462F-B7FB-A456BEDC3549.html" target="_blank" rel="noopener noreferrer" class="">the vSphere guide</a>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="migrate-from-epid-attestation-to-dcap-attestation">Migrate from EPID Attestation to DCAP Attestation<a href="#migrate-from-epid-attestation-to-dcap-attestation" class="hash-link" aria-label="Direct link to Migrate from EPID Attestation to DCAP Attestation" title="Direct link to Migrate from EPID Attestation to DCAP Attestation" translate="no">​</a></h3>
<p>EPID attestation will be discontinued in 2025 and will no longer be available on
any processors. All nodes using EPID attestation must migrate to DCAP
attestation.</p>
<p>For transitioning to the DCAP attestation, follow these steps:</p>
<ol>
<li class="">See if your system <a href="#aesm-service" class="">supports DCAP attestation</a>. If your hardware does not
support DCAP attestation, you&#x27;ll need to migrate your node to newer hardware.</li>
<li class="">Transition to DCAP attestation:</li>
</ol>
<ul>
<li class="">In case you are running AESM service on Docker follow <a href="#dcap-attestation-docker" class="">these instructions</a>.</li>
<li class="">Otherwise manually configure AESM service to use DCAP attestation:<!-- -->
<ol>
<li class="">Remove any leftover EPID attestation packages. If running on Ubuntu 22.04 run
the following command:</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  sudo apt remove libsgx-aesm-launch-plugin libsgx-aesm-epid-plugin</span><br></span></code></pre></div></div>
<ol start="2">
<li class="">Configure AESM service to use <a href="#dcap-attestation" class="">DCAP attestation</a></li>
<li class="">Restart the AESM service. If running on Ubuntu 22.04 run the following
command:</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl restart aesmd.service</span><br></span></code></pre></div></div>
</li>
</ul>
<ol start="3">
<li class=""><a href="#configuring-the-quote-provider" class="">Configure the Quote Provider</a>.</li>
<li class="">Use the <a href="#check-sgx-setup" class="">attestation tool</a> to test if your settings are correct.</li>
<li class="">Restart your compute node and verify that node is <code>ready</code>.</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="check-sgx-setup">Check SGX Setup<a href="#check-sgx-setup" class="hash-link" aria-label="Direct link to Check SGX Setup" title="Direct link to Check SGX Setup" translate="no">​</a></h3>
<p>To test if your settings are correct, you may use the [Oasis attestation
tool][attestation-tool] (<a href="https://github.com/oasisprotocol/tools/releases" target="_blank" rel="noopener noreferrer" class="">binary</a>) for testing remote attestation against Intel SGX&#x27;s
development server.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="tdx">Trust Domain Extensions (TDX)<a href="#tdx" class="hash-link" aria-label="Direct link to Trust Domain Extensions (TDX)" title="Direct link to Trust Domain Extensions (TDX)" translate="no">​</a></h2>
<p>Before proceeding with the TDX installation, <strong>make sure you followed the SGX
installation steps above and you have a working SGX environment</strong>!</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="tdx-bios-configuration">BIOS configuration<a href="#tdx-bios-configuration" class="hash-link" aria-label="Direct link to BIOS configuration" title="Direct link to BIOS configuration" translate="no">​</a></h3>
<ul>
<li class=""><strong>SGX</strong>: ENABLE</li>
<li class=""><strong>SGX memory</strong>: at least 256MB</li>
<li class=""><strong>SGX Auto MP Registration</strong>: ENABLE</li>
<li class=""><strong>Hyper-Threading</strong>: DISABLE</li>
<li class=""><strong>Intel SpeedStep</strong>: DISABLE</li>
<li class=""><strong>SecureBoot</strong>: DISABLE</li>
<li class=""><strong>All Internal Graphics</strong>: DISABLE</li>
<li class=""><strong>Turbo Mode</strong>: DISABLE</li>
<li class=""><strong>CPU AES</strong>: ENABLE</li>
<li class=""><strong>TDX</strong>: ENABLE</li>
<li class=""><strong>Memory Encryption (TME)</strong>: ENABLE</li>
<li class=""><strong>Total Memory Encryption Bypass</strong>: ENABLE</li>
<li class=""><strong>Total Memory Encryption Multi-Tenant (TME-MT)</strong>: ENABLE</li>
<li class=""><strong>TME-MT memory integrity</strong>: DISABLE</li>
<li class=""><strong>TDX Secure Arbitration Mode Loader (SEAM Loader)</strong>: ENABLE</li>
<li class=""><strong>TME-MT/TDX key split</strong>: non-zero value</li>
<li class=""><strong>ACPI S3 and deeper power states</strong>: DISABLED</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="host-os-setup">Host OS setup<a href="#host-os-setup" class="hash-link" aria-label="Direct link to Host OS setup" title="Direct link to Host OS setup" translate="no">​</a></h3>
<p>The following section contains summarized instructions for setting up an
environment for running ROFL node and other TDX services on Ubuntu 24.04 or
later. Check out the official <a href="https://github.com/canonical/tdx" target="_blank" rel="noopener noreferrer" class="">Canonical TDX repository</a> for details.</p>
<ol>
<li class="">
<p>Add the following TDX PPAs to your APT sources and the keyring:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo add-apt-repository ppa:kobuk-team/tdx-release</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo add-apt-repository ppa:kobuk-team/tdx-attestation-release</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt update</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Install the TDX quote generation service and QEMU for running
guest virtual machines:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install tdx-qgs qemu-utils qemu-system-x86</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Install a special TDX-enabled Linux kernel:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install linux-image-intel</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Disable ACPI S3 (add kernel parameter: <code>nohibernate</code>):</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sed -i -E &quot;s/GRUB_CMDLINE_LINUX=\&quot;(.*)\&quot;/GRUB_CMDLINE_LINUX=\&quot;\1 nohibernate\&quot;/g&quot; /etc/default/grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">update-grub</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Make sure the non-root user running Oasis-node is a member of <code>sgx</code>,
<code>sgx_prv</code> and <code>kvm</code> groups on host (access to <code>/dev/sgx*</code>, <code>/dev/kvm*</code> and
<code>/dev/*vsock*</code> devices).</p>
</li>
<li class="">
<p>Reboot your system and select the new <code>-intel</code> kernel.</p>
</li>
</ol>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>If you don&#x27;t have access to the grub selector during machine startup, you can
also detect and set the correct default kernel by executing the script below
with elevated privileges:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export KERNEL_RELEASE=$(apt show &quot;linux-image-intel&quot; 2&gt;&amp;1 | gawk &#x27;match($0, /Depends:.* linux-image-([^, ]+)/, a) {print a[1]}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [ -z &quot;${KERNEL_RELEASE}&quot; ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;ERROR : unable to determine kernel release&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    exit 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MID=$(awk &#x27;/Advanced options for Ubuntu/{print $(NF-1)}&#x27; /boot/grub/grub.cfg | cut -d\&#x27; -f2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KID=$(awk &quot;/with Linux $KERNEL_RELEASE/&quot;&#x27;{print $(NF-1)}&#x27; /boot/grub/grub.cfg | cut -d\&#x27; -f2 | head -n1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &gt; /etc/default/grub.d/99-tdx-kernel.cfg &lt;&lt;EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GRUB_DEFAULT=saved</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GRUB_SAVEDEFAULT=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">grub-editenv /boot/grub/grubenv set saved_entry=&quot;${MID}&gt;${KID}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">update-grub</span><br></span></code></pre></div></div></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="check-tdx-setup">Check TDX Setup<a href="#check-tdx-setup" class="hash-link" aria-label="Direct link to Check TDX Setup" title="Direct link to Check TDX Setup" translate="no">​</a></h3>
<p>To check whether your system is ready to launch TDX VMs, you should see an
output like this:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo dmesg | grep -i tdx</span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[    1.368184] virt/tdx: BIOS enabled: private KeyID range [32, 64)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[    1.368188] virt/tdx: Disable ACPI S3. Turn off TDX in the BIOS to use ACPI S3.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[    9.483666] virt/tdx: TDX module: attributes 0x0, vendor_id 0x8086, major_version 1, minor_version 5, build_date 20240725, build_num 784</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[    9.483672] virt/tdx: CMR: [0x100000, 0x77800000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[    9.483674] virt/tdx: CMR: [0x100000000, 0x3ffe000000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   10.587167] virt/tdx: 1042424 KB allocated for PAMT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   10.587173] virt/tdx: module initialized</span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ls -al /dev/*kvm*</span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">crw-rw---- 1 root kvm 10, 232 Apr 10 09:56 /dev/kvm</span><br></span></code></pre></div></div>
<p>If any of the above is missing, then the following debug tools may help you:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apt install msr-tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/canonical/tdx &amp;&amp; ./tdx/system-report.sh</span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">### Model specific registers (MSRs)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MK_TME_ENABLED bit: 1 (expected value: 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SEAM_RR bit: 1 (expected value: 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NUM_TDX_PRIV_KEYS: 20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SGX_AND_MCHECK_STATUS: 0 (expected value: 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Production platform: Production (expected value: Production)</span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo rdmsr 0x503</span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">0  # 0 if SGX in production mode</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="troubleshooting">Troubleshooting<a href="#troubleshooting" class="hash-link" aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting" translate="no">​</a></h2>
<p>See <a class="" href="/node/run-your-node/troubleshooting#tee">the TEE troubleshooting section</a> for a list of
most common errors and solutions.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/oasisprotocol/docs/edit/main/docs/node/run-your-node/prerequisites/set-up-tee.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-10-30T23:42:34.000Z" itemprop="dateModified">Oct 30, 2025</time></b></span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/node/run-your-node/prerequisites/system-configuration"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">System Configuration</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/node/run-your-node/validator-node"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Validator Node</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#sgx" class="table-of-contents__link toc-highlight">Software Guard Extensions (SGX)</a><ul><li><a href="#sgx-bios-configuration" class="table-of-contents__link toc-highlight">BIOS Configuration</a></li><li><a href="#ensure-clock-synchronization" class="table-of-contents__link toc-highlight">Ensure Clock Synchronization</a></li><li><a href="#ensure-proper-sgx-device-permissions" class="table-of-contents__link toc-highlight">Ensure Proper SGX Device Permissions</a></li><li><a href="#aesm-service" class="table-of-contents__link toc-highlight">AESM Service</a></li><li><a href="#dcap-attestation" class="table-of-contents__link toc-highlight">DCAP Attestation</a></li><li><a href="#migrate-from-epid-attestation-to-dcap-attestation" class="table-of-contents__link toc-highlight">Migrate from EPID Attestation to DCAP Attestation</a></li><li><a href="#check-sgx-setup" class="table-of-contents__link toc-highlight">Check SGX Setup</a></li></ul></li><li><a href="#tdx" class="table-of-contents__link toc-highlight">Trust Domain Extensions (TDX)</a><ul><li><a href="#tdx-bios-configuration" class="table-of-contents__link toc-highlight">BIOS configuration</a></li><li><a href="#host-os-setup" class="table-of-contents__link toc-highlight">Host OS setup</a></li><li><a href="#check-tdx-setup" class="table-of-contents__link toc-highlight">Check TDX Setup</a></li></ul></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Tools</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://explorer.oasis.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Explorer</a></li><li class="footer__item"><a href="https://wallet.oasis.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Wallet</a></li><li class="footer__item"><a href="https://github.com/oasisprotocol/cli" target="_blank" rel="noopener noreferrer" class="footer__link-item">CLI</a></li><li class="footer__item"><a href="https://status.oasis.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Status</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Build</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://faucet.testnet.oasis.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Testnet Faucet</a></li><li class="footer__item"><a href="https://playground.oasis.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Playground</a></li><li class="footer__item"><a href="https://api.docs.oasis.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">API</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Node</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/node/network/mainnet">Mainnet</a></li><li class="footer__item"><a class="footer__link-item" href="/node/network/testnet">Testnet</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://oasis.io/discord" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://t.me/oasisprotocolcommunity" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram</a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UC35UFPcZ2F1wjPxhPrSsESQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube</a></li><li class="footer__item"><a href="https://github.com/oasisprotocol" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
<p xmlns:cc="http://creativecommons.org/ns#">Copyright © 2025
by <a rel="cc:attributionURL dct:creator" property="cc:attributionName" href="https://oasis.net">
Oasis Protocol Foundation</a>. We <a href="https://oasisprotocol.org/privacy-policy" target="_blank" rel="noopener noreferrer">respect your privacy</a>.
Unless otherwise specified, all text and images on this website are licensed
under <a href="http://creativecommons.org/licenses/by/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">
CC BY 4.0<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="/img/cc.svg"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="/img/by.svg"></a>.
This does not include the Oasis software and the code examples, both of which are
licensed under <a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">
Apache 2.0</a>. Built with &#x2665; and Docusaurus.</p></div></div></div></footer><!--$--><!--/$--></div>
</body>
</html>